<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‘å…¨ä¼æ¥­ - ç”Ÿç”¢ç®¡ç†å·¥å…·å…¨é›†</title>
    <!-- å¼•å…¥ FontAwesome ç”¨æ–¼å°èˆªåœ–ç¤º -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* å…¨å±€é‡ç½® */
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #f1f5f9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* å…§å®¹å®¹å™¨ï¼šæ¸›å»åº•éƒ¨å°èˆªçš„é«˜åº¦ */
        #main-container {
            width: 100%;
            height: calc(100% - 64px); /* é ç•™åº•éƒ¨å°èˆªé«˜åº¦ */
            position: relative;
        }

        /* Iframe æ¨£å¼ï¼šå¡«æ»¿å®¹å™¨ï¼Œé è¨­éš±è— */
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease;
            background-color: #fff;
        }

        /* æ¿€æ´»çš„ Iframe */
        iframe.active {
            opacity: 1;
            visibility: visible;
            z-index: 10;
        }

        /* åº•éƒ¨å°èˆªåˆ— */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 64px;
            background-color: #1e293b; /* Slate-800 */
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 50;
            padding-bottom: env(safe-area-inset-bottom); /* é©é… iPhone åº•éƒ¨æ©«æ¢ */
        }

        /* å°èˆªæŒ‰éˆ• */
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #94a3b8; /* Slate-400 */
            text-decoration: none;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            border-top: 3px solid transparent;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
            transition: transform 0.2s;
        }

        /* æ¿€æ´»çš„å°èˆªæŒ‰éˆ• */
        .nav-item.active {
            color: #38bdf8; /* Sky-400 */
            background-color: #0f172a; /* Slate-900 */
            border-top-color: #38bdf8;
        }

        .nav-item.active i {
            transform: translateY(-2px);
        }

        .nav-item:active {
            background-color: #334155;
        }

        /* ç”¨æ–¼å­˜æ”¾åŸå§‹ä»£ç¢¼çš„éš±è—å€åŸŸ */
        .source-code { display: none; }
    </style>
</head>
<body>

    <!-- ä¸»å…§å®¹å€ï¼šå‹•æ…‹è¼‰å…¥ Iframe -->
    <div id="main-container">
        <!-- Iframes will be injected here by JavaScript -->
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <nav id="bottom-nav">
        <div class="nav-item active" onclick="switchTab(0)">
            <i class="fa-solid fa-chart-pie"></i>
            <span>æ©Ÿå°ç”¢èƒ½</span>
        </div>
        <div class="nav-item" onclick="switchTab(1)">
            <i class="fa-solid fa-industry"></i>
            <span>ç”Ÿç”¢é ä¼°</span>
        </div>
        <div class="nav-item" onclick="switchTab(2)">
            <i class="fa-solid fa-file-invoice-dollar"></i>
            <span>å ±åƒ¹åˆ†æ</span>
        </div>
        <div class="nav-item" onclick="switchTab(3)">
            <i class="fa-solid fa-users"></i>
            <span>äººåŠ›æˆæœ¬</span>
        </div>
        <div class="nav-item" onclick="switchTab(4)">
            <i class="fa-solid fa-cubes"></i>
            <span>è³‡æå…¬å¼</span>
        </div>
    </nav>

    <!-- 
        ä»¥ä¸‹ Textarea å­˜æ”¾åŸå§‹ HTML ä»£ç¢¼ 
        ä½¿ç”¨ Textarea æ˜¯ç‚ºäº†ç¢ºä¿æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ã€æ›è¡Œå’Œè…³æœ¬æ¨™ç±¤éƒ½èƒ½åŸå°ä¸å‹•åœ°ä¿å­˜
        é€™æ˜¯æœ€å®‰å…¨çš„ã€Œä¸€å­—ä¸æ¼ã€åˆä½µæ–¹å¼
    -->

    <!-- 1. æ©Ÿå°ç”¢èƒ½è©•ä¼° -->
    <textarea id="code-0" class="source-code">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‘å…¨ä¼æ¥­ - å–®ä¸€å°„å‡ºæ©Ÿç”¢èƒ½æ¨¡æ“¬å™¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        
        /* é‡å°è§¸æ§å„ªåŒ–çš„è¼¸å…¥æ¡†æ¨£å¼ */
        .touch-input {
            font-size: 1.125rem; /* text-lg */
            padding: 0.75rem;     /* p-3 */
            height: 3rem;         /* h-12 */
        }

        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem; /* åŠ å¤§é»æ“Šå€åŸŸ */
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: #fff;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            font-size: 1rem; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px; /* åŠ ç²—æ»‘æ¡¿ */
            background: #e5e7eb;
            border-radius: 5px;
            outline: none;
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px; /* åŠ å¤§æ»‘å¡Š */
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Table styles optimized for space */
        .product-table th { 
            font-size: 0.875rem; 
            font-weight: 700;
            color: #374151; 
            background-color: #f3f4f6; 
            padding: 1rem; 
            text-align: left; 
            white-space: nowrap;
        }
        .product-table td { 
            padding: 0.75rem; 
            border-bottom: 1px solid #e5e7eb; 
            vertical-align: middle; 
        }
        .product-table tr:last-child td { border-bottom: none; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 pb-10">
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- Header -->
        <header class="bg-slate-800 text-white shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-server text-2xl text-teal-400"></i>
                    <div>
                        <h1 class="text-lg font-bold tracking-wide">ç‘å…¨ä¼æ¥­ | å–®ä¸€å°„å‡ºæ©Ÿæ¨¡æ“¬</h1>
                        <p class="text-xs text-slate-400 hidden md:block">å–®æ©Ÿç”¢èƒ½è² è·åˆ†æ (Single Machine Loading)</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="hidden md:block text-right">
                        <p class="text-xs md:text-sm bg-slate-700 px-3 py-1 rounded-full"><i class="fa-solid fa-cogs text-teal-300"></i> {{ scenarioText }}</p>
                    </div>
                    <button @click="exportCSV" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-lg shadow-md text-sm font-bold flex items-center gap-2 active:scale-95 transition">
                        <i class="fa-solid fa-file-export"></i>
                        <span class="hidden sm:inline">åŒ¯å‡ºå ±è¡¨</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-2 md:px-4 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Panel: Settings & Products -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Section 1: Machine & Shift Settings -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <h2 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2 flex justify-between items-center">
                        <span><i class="fa-solid fa-industry mr-2 text-teal-600"></i>å·¥å» é«”åˆ¶è¨­å®š</span>
                    </h2>

                    <!-- Machine Name Input (New) -->
                    <div class="mb-5 bg-blue-50 p-3 rounded-lg border border-blue-100">
                        <div class="input-group">
                            <label class="text-blue-800"><i class="fa-solid fa-tag mr-1"></i>æ©Ÿå°åç¨± / ç·¨è™Ÿ</label>
                            <input type="text" v-model="global.machineName" class="font-bold text-lg text-blue-900 placeholder-blue-300 border-blue-200 focus:border-blue-500" placeholder="ä¾‹å¦‚ï¼š450T-A01">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="input-group">
                            <label>ç­åˆ¥é«”åˆ¶</label>
                            <select v-model.number="global.shifts">
                                <option :value="1">å–®ç­åˆ¶ (8H)</option>
                                <option :value="2">å…©ç­åˆ¶ (16H)</option>
                                <option :value="3" class="text-red-500">ä¸‰ç­åˆ¶ (24H)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>å·¥ä½œå¤©æ•¸ (ä¸å«å‡æ—¥)</label>
                            <input type="number" inputmode="decimal" v-model.number="global.workingDays" min="15" max="31">
                        </div>
                    </div>

                    <!-- Batch & Mold Change Settings -->
                    <div class="grid grid-cols-2 gap-4 mb-4 bg-orange-50 p-4 rounded-lg border border-orange-100">
                        <div class="input-group">
                            <label class="text-orange-900">ç”Ÿç”¢æ‰¹é‡ (PCS)</label>
                            <input type="number" inputmode="decimal" v-model.number="global.batchSize" step="100" class="border-orange-300 focus:border-orange-500 font-bold text-orange-800">
                        </div>
                        <div class="input-group">
                            <label class="text-orange-900">æ›æ¨¡æ™‚é–“ (åˆ†)</label>
                            <input type="number" inputmode="decimal" v-model.number="global.moldChangeMins" step="1" class="border-orange-300 focus:border-orange-500 font-bold text-orange-800">
                        </div>
                    </div>

                    <div class="mb-4 pt-2">
                        <label class="text-sm font-bold text-gray-700 mb-2 block">å…¨å» å¹³å‡ä¸è‰¯ç‡ (Defect Rate)</label>
                        <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-lg border">
                            <input type="range" v-model.number="global.defectRate" min="0" max="10" step="0.1" class="slider-thumb flex-grow">
                            <span class="w-20 text-center font-bold text-teal-600 text-lg bg-white py-1 rounded border">{{ global.defectRate }}%</span>
                        </div>
                    </div>

                    <!-- Overtime & Extra Days -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 space-y-4">
                        <h3 class="text-blue-900 font-bold text-base border-b border-blue-200 pb-2 mb-2">
                            <i class="fa-solid fa-business-time mr-1"></i> ç”¢èƒ½æ“´å……æ‡‰è®Š
                        </h3>
                        
                        <!-- Daily Overtime Slider -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-sm font-bold text-blue-800">1. æ¯æ—¥å»¶é•·å·¥æ™‚</label>
                                <span class="text-sm font-bold text-white bg-blue-600 px-3 py-1 rounded-full shadow-sm">+ {{ global.overtime }} H</span>
                            </div>
                            <input type="range" v-model.number="global.overtime" min="0" max="4" step="0.5" class="slider-thumb w-full">
                            <div class="flex justify-between text-xs text-blue-400 mt-1 font-mono">
                                <span>0H</span>
                                <span>2H</span>
                                <span>4H</span>
                            </div>
                        </div>

                        <!-- Extra Days Slider -->
                        <div class="pt-2">
                            <div class="flex justify-between mb-2">
                                <label class="text-sm font-bold text-blue-800">2. å‡æ—¥åŠ ç­å¤©æ•¸</label>
                                <span class="text-sm font-bold text-white bg-indigo-500 px-3 py-1 rounded-full shadow-sm">+ {{ global.extraWorkDays }} å¤©</span>
                            </div>
                            <input type="range" v-model.number="global.extraWorkDays" min="0" max="8" step="1" class="slider-thumb w-full">
                            <div class="flex justify-between text-xs text-blue-400 mt-1 font-mono">
                                <span>0å¤©</span>
                                <span>4å¤©</span>
                                <span>8å¤©</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Product Mix (Enlarged & Widened) -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden">
                    <div class="p-5 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                        <h2 class="text-xl font-bold text-slate-800"><i class="fa-solid fa-list-check mr-2 text-teal-600"></i>ç”Ÿç”¢æ’ç¨‹æ¸…å–®</h2>
                        <button @click="addProduct" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg shadow-md transition flex items-center gap-2 font-bold active:scale-95">
                            <i class="fa-solid fa-plus"></i> æ–°å¢ç”¢å“
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <!-- Added min-w-[700px] to force horizontal scroll instead of squeezing -->
                        <table class="w-full product-table min-w-[700px]">
                            <thead>
                                <tr>
                                    <th class="w-12 text-center">#</th>
                                    <th class="min-w-[160px]">ç”¢å“åç¨±</th>
                                    <th class="w-32 text-right">æœˆéœ€æ±‚(PCS)</th>
                                    <th class="w-20 text-center text-xs text-gray-500">æ›æ¨¡</th>
                                    <th class="w-28 text-right">é€±æœŸ(ç§’)</th>
                                    <th class="w-16"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(prod, index) in products" :key="index" class="group hover:bg-teal-50 transition-colors duration-150">
                                    <td class="text-center text-gray-400 font-bold text-lg">{{ index + 1 }}</td>
                                    <td>
                                        <input type="text" v-model="prod.name" class="w-full bg-transparent border-b-2 border-transparent focus:border-teal-500 outline-none transition px-2 py-3 text-lg font-medium text-gray-700 placeholder-gray-300" placeholder="è¼¸å…¥åç¨±">
                                    </td>
                                    <td>
                                        <input type="number" inputmode="decimal" v-model.number="prod.quantity" class="touch-input w-full border border-gray-300 rounded-lg text-right focus:border-teal-500 focus:ring-2 focus:ring-teal-200 outline-none font-mono font-bold text-blue-600 shadow-sm" placeholder="0">
                                    </td>
                                    <td class="text-center text-gray-500 font-mono text-sm">
                                        {{ prod.quantity > 0 ? Math.ceil(prod.quantity / global.batchSize) : 0 }}æ¬¡
                                    </td>
                                    <td>
                                        <input type="number" inputmode="decimal" v-model.number="prod.cycleTime" class="touch-input w-full border border-gray-300 rounded-lg text-right focus:border-teal-500 focus:ring-2 focus:ring-teal-200 outline-none font-mono font-bold text-gray-700 shadow-sm" placeholder="0">
                                    </td>
                                    <td class="text-center">
                                        <button @click="removeProduct(index)" class="p-3 text-gray-300 hover:text-red-500 transition rounded-full hover:bg-red-50 active:bg-red-100">
                                            <i class="fa-solid fa-trash-can text-xl"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr v-if="products.length === 0">
                                    <td colspan="6" class="text-center py-12 text-gray-400 italic">
                                        <div class="flex flex-col items-center gap-2">
                                            <i class="fa-regular fa-folder-open text-4xl mb-2 opacity-50"></i>
                                            <span>æ¸…å–®æ˜¯ç©ºçš„</span>
                                            <span class="text-sm opacity-75">é»æ“Šå³ä¸Šæ–¹ã€Œæ–°å¢ç”¢å“ã€æŒ‰éˆ•é–‹å§‹</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 bg-gray-50 text-right text-sm text-gray-600 border-t flex justify-between items-center font-medium">
                         <span><i class="fa-solid fa-box mr-1"></i>æ‰¹é‡è¨­å®š: {{ global.batchSize }} pcs</span>
                         <span>å…± {{ products.length }} é … | é ä¼°æ›æ¨¡: <strong class="text-orange-600 text-lg mx-1">{{ results.totalMoldChanges }}</strong> æ¬¡</span>
                    </div>
                </div>

            </div>

            <!-- Right Panel: Analysis Dashboard -->
            <div class="lg:col-span-7 flex flex-col gap-6">
                
                <!-- Main KPI: Loading Rate -->
                <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg border border-gray-200 p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-6 opacity-5 pointer-events-none">
                        <i class="fa-solid fa-chart-pie text-9xl text-black"></i>
                    </div>

                    <h3 class="text-gray-500 font-bold mb-2 uppercase tracking-widest text-sm flex items-center gap-2">
                        <span>æ©Ÿå°ç¸½è² è·ç‡ (Total Loading)</span>
                        <span v-if="global.machineName" class="text-blue-600 bg-blue-50 px-2 py-0.5 rounded border border-blue-100 normal-case shadow-sm flex items-center">
                            <i class="fa-solid fa-tag text-xs mr-1"></i>{{ global.machineName }}
                        </span>
                    </h3>
                    <div class="flex items-baseline gap-4 mb-6">
                        <span class="text-6xl md:text-7xl font-extrabold tracking-tight drop-shadow-sm" :class="loadingColor">{{ results.loadingPercentage }}<span class="text-3xl text-gray-400">%</span></span>
                        
                        <div class="flex flex-col">
                            <span class="px-3 py-1.5 rounded-lg font-bold text-sm shadow-sm inline-flex items-center gap-2 transition-colors" 
                                :class="results.isOverloaded ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'">
                                <i class="fa-solid" :class="results.isOverloaded ? 'fa-triangle-exclamation' : 'fa-check-circle'"></i>
                                {{ results.isOverloaded ? 'ç”¢èƒ½ä¸è¶³' : 'ç”¢èƒ½å……è¶³' }}
                            </span>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-6 mb-2 overflow-hidden shadow-inner">
                        <div class="h-full rounded-full transition-all duration-700 ease-out shadow-sm relative overflow-hidden" 
                             :class="loadingBarColor" 
                             :style="{ width: Math.min(results.loadingPercentage, 100) + '%' }">
                             <div class="absolute inset-0 bg-white opacity-20" style="background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent); background-size: 1rem 1rem;"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between text-xs font-bold text-gray-400 mt-2 px-1">
                        <span>0% (é–’ç½®)</span>
                        <span>85% (ç†æƒ³ä¸Šé™)</span>
                        <span>100% (æ¥µé™)</span>
                    </div>
                </div>

                <!-- Detailed Time Analysis Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-blue-500 hover:shadow-md transition">
                        <p class="text-xs text-gray-500 font-bold mb-1 uppercase">ç¸½å¯ç”¨å·¥æ™‚</p>
                        <p class="text-3xl font-bold text-gray-800">{{ formatNumber(results.availableHours) }} <span class="text-sm font-normal text-gray-400">Hrs</span></p>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-teal-500 hover:shadow-md transition">
                        <p class="text-xs text-gray-500 font-bold mb-1 uppercase">ç”Ÿç”¢é‹è½‰éœ€</p>
                        <p class="text-3xl font-bold text-gray-800">{{ formatNumber(results.productionHours) }} <span class="text-sm font-normal text-gray-400">Hrs</span></p>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-orange-500 hover:shadow-md transition relative group">
                        <p class="text-xs text-gray-500 font-bold mb-1 uppercase">æ›æ¨¡ç¸½æè€—</p>
                        <p class="text-3xl font-bold text-gray-800">{{ formatNumber(results.setupHours) }} <span class="text-sm font-normal text-gray-400">Hrs</span></p>
                         <div class="absolute top-2 right-2 text-xs font-bold bg-orange-100 text-orange-600 px-2 py-1 rounded">
                            {{ results.totalMoldChanges }} æ¬¡
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 hover:shadow-md transition" :class="results.remainingHours >= 0 ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'">
                        <p class="text-xs font-bold mb-1 uppercase" :class="results.remainingHours >= 0 ? 'text-green-600' : 'text-red-600'">å‰©é¤˜ / é€æ”¯</p>
                        <p class="text-3xl font-bold" :class="results.remainingHours >= 0 ? 'text-green-700' : 'text-red-700'">
                            {{ results.remainingHours >= 0 ? '+' : '' }}{{ formatNumber(results.remainingHours) }}
                        </p>
                    </div>
                </div>

                <!-- Strategy Advice Panel -->
                <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 flex-grow">
                    <h3 class="font-bold text-slate-800 mb-5 flex items-center text-lg border-b pb-3">
                        <i class="fa-solid fa-user-tie text-slate-600 mr-3 text-xl"></i> é¡§å•åˆ†æèˆ‡å»ºè­°
                    </h3>
                    
                    <div v-if="results.loadingPercentage > 100" class="space-y-4 animate-pulse-slow">
                        <div class="p-4 bg-red-50 border-l-4 border-red-500 text-red-900 rounded-r-lg shadow-sm">
                            <div class="flex items-start gap-3">
                                <i class="fa-solid fa-circle-exclamation text-xl mt-1"></i>
                                <div>
                                    <strong class="text-lg block mb-1">ç”¢èƒ½åš´é‡çˆ†è¡¨ (Overload)</strong>
                                    ç›®å‰çš„è¨‚å–®éœ€æ±‚å·²è¶…éæ©Ÿå°æ¥µé™ï¼Œå³ä½¿åŠ ç­ä¹Ÿç„¡æ³•å®Œæˆã€‚
                                </div>
                            </div>
                        </div>
                        <ul class="list-disc pl-6 text-base text-slate-700 space-y-2 marker:text-red-500">
                            <li><strong>æ›æ¨¡å½±éŸ¿ï¼š</strong> ç”±æ–¼æ¯ <span class="font-mono bg-gray-100 px-1 rounded font-bold">{{ global.batchSize }}</span> PCS å°±æ›ä¸€æ¬¡æ¨¡ï¼Œæœ¬æœˆå…±éœ€æ›æ¨¡ <strong>{{ results.totalMoldChanges }}</strong> æ¬¡ï¼Œæ¶ˆè€—äº† {{ results.setupHours }} å°æ™‚ã€‚</li>
                            <li><strong>æ”¹å–„å°ç­– 1ï¼š</strong> è«‹å˜—è©¦å°‡ã€Œç”Ÿç”¢æ‰¹é‡ã€èª¿é«˜è‡³ 800 æˆ– 1000 PCSï¼Œè§€å¯Ÿæ›æ¨¡æè€—æ˜¯å¦é™ä½ã€‚</li>
                            <li><strong>æ”¹å–„å°ç­– 2ï¼š</strong> è‹¥ç„¡æ³•å¢åŠ æ‰¹é‡ï¼ˆå› åº«å­˜ç©ºé–“ä¸è¶³ï¼‰ï¼Œå‰‡å¿…é ˆé–‹å•Ÿå‡æ—¥åŠ ç­æˆ–è€ƒæ…®å¤–åŒ…ã€‚</li>
                        </ul>
                    </div>

                    <div v-else-if="results.loadingPercentage > 85" class="space-y-4">
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-900 rounded-r-lg shadow-sm">
                            <div class="flex items-start gap-3">
                                <i class="fa-solid fa-triangle-exclamation text-xl mt-1"></i>
                                <div>
                                    <strong class="text-lg block mb-1">é«˜é¢¨éšªè­¦æˆ’å€ (High Risk)</strong>
                                    æ©Ÿå°å¹¾ä¹æ»¿è¼‰ ({{ results.loadingPercentage }}%)ã€‚ä»»ä½•ç•°å¸¸éƒ½æœƒå°è‡´äº¤æœŸå»¶é²ã€‚
                                </div>
                            </div>
                        </div>
                        <ul class="list-disc pl-6 text-base text-slate-700 space-y-2 marker:text-yellow-500">
                            <li><strong>æ›æ¨¡é »ç‡ï¼š</strong> æœ¬æœˆé è¨ˆæ›æ¨¡ <strong>{{ results.totalMoldChanges }}</strong> æ¬¡ã€‚é »ç¹æ›æ¨¡æ˜¯ç”¢èƒ½æ®ºæ‰‹ã€‚</li>
                            <li><strong>SMED å»ºè­°ï¼š</strong> è‹¥èƒ½å°‡å–®æ¬¡æ›æ¨¡æ™‚é–“å¾ {{ global.moldChangeMins }} åˆ†é˜ç¸®çŸ­è‡³ {{ (global.moldChangeMins * 0.75).toFixed(0) }} åˆ†é˜ï¼Œå³å¯é‡‹æ”¾æ›´å¤šç·©è¡ã€‚</li>
                        </ul>
                    </div>

                    <div v-else class="space-y-4">
                        <div class="p-4 bg-green-50 border-l-4 border-green-500 text-green-900 rounded-r-lg shadow-sm">
                            <div class="flex items-start gap-3">
                                <i class="fa-solid fa-thumbs-up text-xl mt-1"></i>
                                <div>
                                    <strong class="text-lg block mb-1">ç”¢èƒ½å¥åº· (Healthy)</strong>
                                    å³ä½¿è€ƒæ…®äº†é »ç¹æ›æ¨¡çš„æè€—ï¼Œç›®å‰çš„é…ç½®ä»ç„¶æ¸¸åˆƒæœ‰é¤˜ã€‚
                                </div>
                            </div>
                        </div>
                        <ul class="list-disc pl-6 text-base text-slate-700 space-y-2 marker:text-green-500">
                            <li><strong>ç‹€æ…‹ï¼š</strong> æœ¬æœˆé è¨ˆæ›æ¨¡ {{ results.totalMoldChanges }} æ¬¡ï¼Œæ¶ˆè€— {{ results.setupHours }} å°æ™‚ï¼Œä½†ä»æœ‰ {{ results.remainingHours }} å°æ™‚çš„ç©ºæª”ã€‚</li>
                        </ul>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        const { createApp, reactive, computed } = Vue;

        createApp({
            setup() {
                // Global Machine/Factory Settings
                const global = reactive({
                    machineName: '',     // New: Machine Name
                    shifts: 1,           // Default to 1 shift
                    workingDays: 22,
                    hoursPerShift: 8,    // Fixed standard
                    overtime: 0,         // Overtime per shift
                    extraWorkDays: 0,    // Extra work days
                    moldChangeMins: 40,  // User specified default
                    batchSize: 400,      // New: Batch size constraint
                    defectRate: 3.0      // Global defect rate
                });

                // Product List - DEFAULT 3 EMPTY SLOTS
                const products = reactive([
                    { name: '', quantity: null, cycleTime: null },
                    { name: '', quantity: null, cycleTime: null },
                    { name: '', quantity: null, cycleTime: null }
                ]);

                // Methods
                const addProduct = () => {
                    products.push({ name: '', quantity: null, cycleTime: null });
                };

                const removeProduct = (index) => {
                    products.splice(index, 1);
                };

                const exportCSV = () => {
                    // 1. Prepare Data Headers
                    let csvContent = "\uFEFF"; // BOM for Excel UTF-8
                    const dateStr = new Date().toLocaleDateString('zh-TW');
                    
                    csvContent += `ç‘å…¨ä¼æ¥­ - å–®ä¸€å°„å‡ºæ©Ÿç”¢èƒ½æ¨¡æ“¬å ±å‘Š\n`;
                    csvContent += `å ±å‘Šæ—¥æœŸ, ${dateStr}\n`;
                    csvContent += `æ©Ÿå°åç¨±/ç·¨è™Ÿ, ${global.machineName || 'æœªå‘½åæ©Ÿå°'}\n\n`; // Include Machine Name

                    // 2. Summary Section
                    const res = results.value;
                    csvContent += `[æ¨¡æ“¬çµæœæ‘˜è¦]\n`;
                    csvContent += `æ©Ÿå°ç¸½è² è·ç‡, ${res.loadingPercentage}%\n`;
                    csvContent += `è©•ä¼°ç‹€æ…‹, ${res.isOverloaded ? 'ç”¢èƒ½ä¸è¶³' : 'ç”¢èƒ½å……è¶³'}\n`;
                    csvContent += `å¯ç”¨ç¸½å·¥æ™‚, ${res.availableHours} Hrs\n`;
                    csvContent += `ç”Ÿç”¢é‹è½‰éœ€, ${res.productionHours} Hrs\n`;
                    csvContent += `æ›æ¨¡ç¸½æè€—, ${res.setupHours} Hrs\n`;
                    csvContent += `å·¥æ™‚é¤˜è£•/é€æ”¯, ${res.remainingHours} Hrs\n`;
                    csvContent += `é ä¼°ç¸½æ›æ¨¡æ¬¡æ•¸, ${res.totalMoldChanges} æ¬¡\n\n`;

                    // 3. Settings Section
                    csvContent += `[å·¥å» é«”åˆ¶è¨­å®š]\n`;
                    csvContent += `ç­åˆ¥é«”åˆ¶, ${global.shifts} ç­åˆ¶\n`;
                    csvContent += `å·¥ä½œå¤©æ•¸, ${global.workingDays} å¤©\n`;
                    csvContent += `æ¯æ—¥åŠ ç­, ${global.overtime} H\n`;
                    csvContent += `å‡æ—¥åŠ ç­, ${global.extraWorkDays} å¤©\n`;
                    csvContent += `ç”Ÿç”¢æ‰¹é‡, ${global.batchSize} PCS\n`;
                    csvContent += `æ›æ¨¡æ™‚é–“, ${global.moldChangeMins} åˆ†\n`;
                    csvContent += `é ä¼°ä¸è‰¯ç‡, ${global.defectRate} %\n\n`;

                    // 4. Products Table
                    csvContent += `[è©³ç´°ç”Ÿç”¢æ’ç¨‹]\n`;
                    csvContent += `ç”¢å“åç¨±, æœˆéœ€æ±‚(PCS), é€±æœŸ(ç§’), é ä¼°æ›æ¨¡(æ¬¡), æ·¨ç”Ÿç”¢å·¥æ™‚(H)\n`;
                    
                    products.forEach(p => {
                        if (p.name || p.quantity) {
                            const name = p.name || 'æœªå‘½åç”¢å“';
                            const qty = p.quantity || 0;
                            const cycle = p.cycleTime || 0;
                            const changes = qty > 0 ? Math.ceil(qty / global.batchSize) : 0;
                            
                            // Calculate net run time (rough estimate for csv)
                            let netHours = 0;
                            if (qty > 0 && cycle > 0) {
                                const inputQty = qty / (1 - (global.defectRate / 100));
                                netHours = (inputQty * cycle / 3600).toFixed(2);
                            }

                            // CSV escape for names with commas
                            const safeName = name.includes(',') ? `"${name}"` : name;
                            csvContent += `${safeName}, ${qty}, ${cycle}, ${changes}, ${netHours}\n`;
                        }
                    });

                    // 5. Trigger Download
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement("a");
                    const url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", `ç‘å…¨ç”¢èƒ½æ¨¡æ“¬_${global.machineName || 'æœªå‘½å'}_${new Date().toISOString().slice(0,10)}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };

                // Computed Logic
                const results = computed(() => {
                    // 1. Available Time (Hours)
                    const totalDays = global.workingDays + global.extraWorkDays;
                    const dailyHours = global.shifts * (global.hoursPerShift + global.overtime);
                    const availableHours = totalDays * dailyHours;

                    // 2. Production Time & Setup Logic
                    let totalRunSeconds = 0;
                    let totalMoldChanges = 0;

                    products.forEach(p => {
                        if (p.quantity > 0) {
                            // Run Time
                            if (p.cycleTime > 0) {
                                const requiredInputQty = p.quantity / (1 - (global.defectRate / 100));
                                totalRunSeconds += requiredInputQty * p.cycleTime;
                            }
                            
                            // Setup Time Logic (Based on Batch Size)
                            // If quantity is 3520 and batch is 400:
                            // runs = ceil(3520 / 400) = 9 runs
                            const runs = Math.ceil(p.quantity / global.batchSize);
                            totalMoldChanges += runs;
                        }
                    });

                    const productionHours = totalRunSeconds / 3600;
                    
                    // Total Setup Hours = Total Changes * Mins per change
                    const setupMinutes = totalMoldChanges * global.moldChangeMins;
                    const setupHours = setupMinutes / 60;

                    // 4. Total Required
                    const totalRequiredHours = productionHours + setupHours;

                    // 5. Loading %
                    const loadingPercentage = availableHours > 0 
                        ? (totalRequiredHours / availableHours) * 100 
                        : 0;

                    return {
                        availableHours: parseFloat(availableHours.toFixed(1)),
                        productionHours: parseFloat(productionHours.toFixed(1)),
                        setupHours: parseFloat(setupHours.toFixed(1)),
                        totalRequiredHours: parseFloat(totalRequiredHours.toFixed(1)),
                        loadingPercentage: parseFloat(loadingPercentage.toFixed(1)),
                        remainingHours: parseFloat((availableHours - totalRequiredHours).toFixed(1)),
                        isOverloaded: totalRequiredHours > availableHours,
                        totalMoldChanges // Expose for UI
                    };
                });

                // Helper for advice
                const longestCycleProduct = computed(() => {
                    if (products.length === 0) return null;
                    return [...products].sort((a,b) => b.cycleTime - a.cycleTime)[0];
                });

                // UI Classes
                const loadingColor = computed(() => {
                    if (results.value.loadingPercentage > 100) return 'text-red-600';
                    if (results.value.loadingPercentage > 85) return 'text-orange-500';
                    return 'text-teal-600';
                });

                const loadingBarColor = computed(() => {
                    if (results.value.loadingPercentage > 100) return 'bg-red-500';
                    if (results.value.loadingPercentage > 85) return 'bg-orange-400';
                    return 'bg-teal-500';
                });

                const scenarioText = computed(() => {
                    const totalD = global.workingDays + global.extraWorkDays;
                    const dailyH = (global.hoursPerShift + global.overtime) * global.shifts;
                    return `${global.shifts}ç­åˆ¶ / æ—¥åš ${dailyH}H / æœˆåš ${totalD}å¤©`;
                });

                const formatNumber = (num) => new Intl.NumberFormat('en-US').format(num);

                return {
                    global,
                    products,
                    addProduct,
                    removeProduct,
                    results,
                    loadingColor,
                    loadingBarColor,
                    scenarioText,
                    longestCycleProduct,
                    formatNumber,
                    exportCSV
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
    </textarea>

    <!-- 2. ç”Ÿç”¢é ä¼°å·¥å…· -->
    <textarea id="code-1" class="source-code">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‘å…¨ä¼æ¥­ - ç”Ÿç”¢èˆ‡ç‰©æµè‡ªå‹•é ä¼°ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f1f5f9; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        label { display: block; font-size: 0.9rem; font-weight: 800; color: #475569; margin-bottom: 0.5rem; }
        input, select { 
            width: 100%; 
            padding: 1.1rem 0.5rem; 
            border: 2px solid #e2e8f0; 
            border-radius: 14px; 
            font-size: 1.3rem; 
            font-weight: 800; 
            color: #1e293b; 
            text-align: center;
            background-color: #fff;
        }
        input:focus, select:focus { border-color: #3b82f6; outline: none; background-color: #f8fafc; }
        .tab-btn { padding: 1.2rem; font-weight: 900; border-bottom: 5px solid transparent; transition: all 0.2s; color: #94a3b8; }
        .tab-btn.active { border-bottom-color: #3b82f6; color: #3b82f6; background-color: #fff; }
        .dashboard-card { transition: transform 0.2s; }
        .dashboard-card:active { transform: scale(0.98); }
        .section-title { font-size: 1.3rem; font-weight: 900; color: #0f172a; border-left: 8px solid #3b82f6; padding-left: 12px; margin: 24px 0 16px 0; }
        .tag-blue { background: #dbeafe; color: #1e40af; padding: 2px 10px; border-radius: 6px; font-size: 12px; font-weight: 800; }
    </style>
</head>
<body class="p-4 md:p-8 pb-32">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-black text-slate-800 tracking-tighter">ç”Ÿç”¢èˆ‡ç‰©æµæ™ºæ…§é ä¼°å„€è¡¨æ¿</h1>
            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Ruiquan Smart Factory Management</p>
        </div>

        <!-- å£¹ã€ç”Ÿç”¢æ•ˆèƒ½æ ¸å¿ƒè¨­å®š -->
        <div class="section-title flex justify-between items-center">
            <span>å£¹ã€ç”Ÿç”¢æ ¸å¿ƒè¨­å®š</span>
            <span class="text-xs bg-blue-500 text-white px-3 py-1 rounded-full animate-pulse">ç²¾ç¢ºè¨ˆç®—ä¸­</span>
        </div>
        
        <div class="card p-6 mb-6 border-t-4 border-slate-800">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label>æ¨¡æ¬¡ç§’æ•¸ (Cycle Time)</label>
                    <input type="number" id="cycleTime" value="60" step="0.1">
                </div>
                <div>
                    <label>æ¯æ¨¡ç©´æ•¸ (Cavities)</label>
                    <input type="number" id="cavities" value="1">
                </div>
            </div>
            <div class="mt-4">
                <label>ä¼‘æ¯/åœæ©Ÿæ™‚é–“ (åˆ†)</label>
                <input type="number" id="breakMinutes" value="60">
            </div>
        </div>

        <!-- æ¨¡å¼é¸æ“‡ -->
        <div class="flex bg-slate-200 rounded-t-2xl overflow-hidden mb-0">
            <button id="tabA" onclick="switchMode('A')" class="tab-btn active flex-1">ç®—é ä¼°ç”¢é‡</button>
            <button id="tabB" onclick="switchMode('B')" class="tab-btn flex-1">ç®—å®Œå·¥æ™‚é–“</button>
        </div>

        <!-- è¼¸å…¥é¢æ¿ -->
        <div class="card p-6 rounded-t-none mb-8">
            <!-- é–‹å§‹æ™‚é–“ -->
            <div class="mb-8 pb-6 border-b-2 border-dashed border-slate-100">
                <div class="flex justify-between items-center mb-4">
                    <label class="!mb-0 text-blue-600 font-black">ã€é–‹å§‹ç”Ÿç”¢åŸºæº–ã€‘</label>
                    <button onclick="setNow()" class="text-xs font-black bg-blue-600 text-white px-6 py-2 rounded-full shadow-lg hover:bg-blue-700 active:scale-95">å¡«å…¥ç¾åœ¨æ™‚é–“</button>
                </div>
                <div class="grid grid-cols-12 gap-3">
                    <div class="col-span-6">
                        <label class="text-[10px] text-slate-400 font-black uppercase">ç”Ÿç”¢æ—¥æœŸ</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="col-span-3">
                        <label class="text-[10px] text-slate-400 font-black uppercase">å°æ™‚</label>
                        <select id="startH"></select>
                    </div>
                    <div class="col-span-3">
                        <label class="text-[10px] text-slate-400 font-black uppercase">åˆ†é˜</label>
                        <select id="startM"></select>
                    </div>
                </div>
            </div>

            <!-- A é¢æ¿ -->
            <div id="panelA" class="space-y-4">
                <label class="text-blue-600 font-black">ã€ç›®æ¨™çµæŸæ™‚é–“é»ã€‘</label>
                <div class="grid grid-cols-12 gap-3">
                    <div class="col-span-6">
                        <label class="text-[10px] text-slate-400 font-black uppercase">æ—¥æœŸ</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="col-span-3">
                        <label class="text-[10px] text-slate-400 font-black uppercase">å°æ™‚</label>
                        <select id="endH"></select>
                    </div>
                    <div class="col-span-3">
                        <label class="text-[10px] text-slate-400 font-black uppercase">åˆ†é˜</label>
                        <select id="endM"></select>
                    </div>
                </div>
            </div>

            <!-- B é¢æ¿ -->
            <div id="panelB" class="hidden space-y-4">
                <label class="text-emerald-600 font-black">ã€é è¨ˆç”Ÿç”¢æ•¸é‡ç›®æ¨™ã€‘</label>
                <input type="number" id="targetQty" value="160" class="text-5xl text-emerald-600 py-8 border-emerald-200 bg-emerald-50/50">
            </div>
        </div>

        <!-- è¦–è¦ºåŒ–çµæœæˆ°æƒ…å®¤ -->
        <div id="resArea" class="space-y-4 mb-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- ç”¢å‡ºå¡ç‰‡ -->
                <div class="card p-6 bg-gradient-to-br from-blue-600 to-blue-700 text-white shadow-xl dashboard-card">
                    <div class="flex justify-between items-start">
                        <span class="text-xs font-black opacity-80 uppercase tracking-widest">ç†è«–ç¸½ç”¢å‡º</span>
                        <span class="tag-blue">PRODUCTION</span>
                    </div>
                    <div class="flex items-baseline mt-4">
                        <div class="text-6xl font-black" id="resQty">0</div>
                        <span class="ml-2 text-sm font-bold opacity-70">PCS</span>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20 text-xs font-medium opacity-80">
                        ä¾æ“šæ¨¡æ¬¡ç§’æ•¸ç›´æ¥è¨ˆç®—ä¹‹ç²¾ç¢ºå€¼
                    </div>
                </div>

                <!-- äº¤æœŸå¡ç‰‡ -->
                <div class="card p-6 bg-gradient-to-br from-emerald-600 to-emerald-700 text-white shadow-xl dashboard-card">
                    <div class="flex justify-between items-start">
                        <span class="text-xs font-black opacity-80 uppercase tracking-widest">é è¨ˆå®Œå·¥äº¤æœŸ</span>
                        <span class="bg-emerald-400/30 px-2 py-1 rounded text-[10px] font-black">ESTIMATED</span>
                    </div>
                    <div class="mt-4">
                        <div class="text-5xl font-black" id="resTime">--:--</div>
                        <div class="text-sm font-bold mt-1 opacity-80" id="resDate">--</div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20 text-xs font-medium opacity-80">
                        ä»»å‹™ç¸½è€—æ™‚ï¼š<span id="resTotalDur">0.0</span> å°æ™‚ (å«ä¼‘æ¯)
                    </div>
                </div>
            </div>
            
            <!-- æ•¸æ“šæ˜ç´°å¡ -->
            <div class="card p-4 bg-slate-800 text-slate-300 flex justify-between items-center px-8">
                <div class="text-center">
                    <div class="text-[10px] font-black opacity-60 uppercase">ç´”ç”Ÿç”¢å·¥æ™‚</div>
                    <div class="text-xl font-bold text-white"><span id="resEffDur">0.0</span> <small class="text-[10px]">hr</small></div>
                </div>
                <div class="h-8 w-px bg-slate-600"></div>
                <div class="text-center">
                    <div class="text-[10px] font-black opacity-60 uppercase">æ¯æ™‚ç”¢å‡ºç‡</div>
                    <div class="text-xl font-bold text-blue-400"><span id="resHourly">0</span> <small class="text-[10px]">P/h</small></div>
                </div>
            </div>
        </div>

        <!-- è²³ã€å®¹å™¨é€±è½‰éœ€æ±‚é ä¼° -->
        <div class="section-title">è²³ã€å®¹å™¨éœ€æ±‚èˆ‡ç‰©æµé ä¼°</div>
        <div class="card p-6 space-y-6 border-t-8 border-amber-500">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label>æ¯æœˆç¸½å‡ºè²¨éœ€æ±‚ (PCS)</label>
                    <input type="number" id="monthQty" value="3520">
                </div>
                <div>
                    <label>æœˆé å®šå·¥ä½œå¤© (å¤©)</label>
                    <input type="number" id="workDays" value="22">
                </div>
            </div>
            
            <div class="bg-amber-50 p-5 rounded-2xl border-2 border-amber-100 flex justify-between items-center shadow-inner">
                <span class="text-sm font-black text-amber-800">ğŸ“Š æ¯æ—¥ç›®æ¨™å‡ºè²¨é‡ï¼š</span>
                <span class="text-3xl font-black text-amber-600"><span id="resDailyQty">160</span> <small class="text-sm font-bold">PCS/æ—¥</small></span>
            </div>

            <div class="pt-4 space-y-6">
                <div>
                    <label class="text-slate-500 flex justify-between font-black">
                        é€±è½‰å¤©æ•¸è¨­å®š <span class="text-xs opacity-60">(0 ç‚ºå–®æ—¥é‡)</span>
                    </label>
                    <input type="number" id="safetyDays" value="0" class="!bg-slate-50 border-amber-200">
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <span class="bg-amber-100 text-amber-800 px-3 py-1 rounded text-[12px] font-black uppercase">å» å…§è‡ªè£½ (ç®±)</span>
                        <label class="text-[10px] font-bold text-slate-400">æ”¶å®¹æ•¸ (PCS/ç®±)</label>
                        <input type="number" id="internalCap" value="8">
                        <div class="bg-slate-900 text-white p-4 rounded-xl text-center shadow-lg">
                            <div class="text-[10px] font-bold opacity-60 uppercase">éœ€æ±‚ç¸½æ•¸</div>
                            <div class="text-3xl font-black text-amber-400" id="resInternalBoxes">0</div>
                            <div class="text-[10px] font-bold opacity-60">ç®±</div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <span class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded text-[12px] font-black uppercase">å®¢æˆ¶å°ˆç”¨ (ç®±)</span>
                        <label class="text-[10px] font-bold text-slate-400">æ”¶å®¹æ•¸ (PCS/ç®±)</label>
                        <input type="number" id="externalCap" value="160">
                        <div class="bg-slate-800 text-white p-4 rounded-xl text-center shadow-lg">
                            <div class="text-[10px] font-bold opacity-60 uppercase">éœ€æ±‚ç¸½æ•¸</div>
                            <div class="text-3xl font-black text-emerald-400" id="resExternalBoxes">0</div>
                            <div class="text-[10px] font-bold opacity-60">ç®±</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <p class="text-[10px] text-center text-slate-400 mt-12 font-black tracking-[0.2em] uppercase">Ruiquan Enterprise Internal Management System</p>
    </div>

    <script>
        // --- ä¸‹æ‹‰é¸å–®åˆå§‹åŒ– ---
        function populateSelects() {
            const hSelects = [document.getElementById('startH'), document.getElementById('endH')];
            const mSelects = [document.getElementById('startM'), document.getElementById('endM')];
            hSelects.forEach(s => { for(let i=0; i<24; i++) { let opt = document.createElement('option'); opt.value = i; opt.text = i.toString().padStart(2, '0'); s.add(opt); } });
            mSelects.forEach(s => { for(let i=0; i<60; i++) { let opt = document.createElement('option'); opt.value = i; opt.text = i.toString().padStart(2, '0'); s.add(opt); } });
        }

        // --- å…¨åŸŸè®Šæ•¸èˆ‡ç›£è½ ---
        let currentMode = 'A';

        function attachListeners() {
            const allInputs = document.querySelectorAll('input, select');
            allInputs.forEach(input => {
                input.addEventListener('input', runAllCalculations);
                input.addEventListener('change', runAllCalculations);
            });
        }

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('panelA').classList.toggle('hidden', mode !== 'A');
            document.getElementById('panelB').classList.toggle('hidden', mode !== 'B');
            document.getElementById('tabA').classList.toggle('active', mode === 'A');
            document.getElementById('tabB').classList.toggle('active', mode === 'B');
            runAllCalculations();
        }

        function setNow() {
            const now = new Date();
            document.getElementById('startDate').valueAsDate = now;
            document.getElementById('startH').value = now.getHours();
            document.getElementById('startM').value = now.getMinutes();
            
            const later = new Date(now.getTime() + 8 * 60 * 60 * 1000);
            document.getElementById('endDate').valueAsDate = later;
            document.getElementById('endH').value = later.getHours();
            document.getElementById('endM').value = later.getMinutes();
            runAllCalculations();
        }

        function getD(prefix) {
            const dateStr = document.getElementById(prefix + 'Date').value;
            if(!dateStr) return null;
            const h = parseInt(document.getElementById(prefix + 'H').value);
            const m = parseInt(document.getElementById(prefix + 'M').value);
            const d = new Date(dateStr);
            d.setHours(h, m, 0, 0);
            return d;
        }

        function runAllCalculations() {
            const ct = parseFloat(document.getElementById('cycleTime').value) || 1;
            const cav = parseInt(document.getElementById('cavities').value) || 1;
            const brk = parseFloat(document.getElementById('breakMinutes').value) || 0;

            if (currentMode === 'A') {
                const start = getD('start');
                const end = getD('end');
                if (start && end && end > start) {
                    const totalMin = (end - start) / 1000 / 60;
                    const effMin = Math.max(0, totalMin - brk);
                    const qty = Math.floor((effMin * 60) / ct) * cav;
                    
                    updateProductionUI(qty, end, totalMin, effMin);
                }
            } else {
                const start = getD('start');
                const target = parseInt(document.getElementById('targetQty').value) || 0;
                if (start && target > 0) {
                    const prodSec = Math.ceil(target / cav) * ct;
                    const prodMin = prodSec / 60;
                    const totalMin = prodMin + brk;
                    const end = new Date(start.getTime() + totalMin * 60 * 1000);
                    
                    updateProductionUI(target, end, totalMin, prodMin);
                }
            }
            calcContainers();
        }

        function updateProductionUI(qty, endTime, totalMin, effMin) {
            document.getElementById('resQty').innerText = qty.toLocaleString();
            document.getElementById('resTime').innerText = endTime.toTimeString().slice(0,5);
            document.getElementById('resDate').innerText = (endTime.getMonth()+1) + "/" + endTime.getDate();
            document.getElementById('resTotalDur').innerText = (totalMin / 60).toFixed(1);
            document.getElementById('resEffDur').innerText = (effMin / 60).toFixed(1);
            document.getElementById('resHourly').innerText = Math.round(qty / (totalMin/60)) || 0;
        }

        function calcContainers() {
            const month = parseFloat(document.getElementById('monthQty').value) || 0;
            const days = parseFloat(document.getElementById('workDays').value) || 1;
            const iCap = parseInt(document.getElementById('internalCap').value) || 1;
            const eCap = parseInt(document.getElementById('externalCap').value) || 1;
            const safety = parseFloat(document.getElementById('safetyDays').value) || 0;

            const dailyQty = Math.ceil(month / days);
            document.getElementById('resDailyQty').innerText = dailyQty.toLocaleString();

            const cycleMultiplier = safety <= 0 ? 1 : (1 + safety);
            
            const iTotal = Math.ceil((dailyQty / iCap) * cycleMultiplier);
            const eTotal = Math.ceil((dailyQty / eCap) * cycleMultiplier);

            document.getElementById('resInternalBoxes').innerText = iTotal;
            document.getElementById('resExternalBoxes').innerText = eTotal;
        }

        window.onload = function() {
            populateSelects();
            setNow();
            attachListeners();
            runAllCalculations();
        };
    </script>
</body>
</html>
    </textarea>

    <!-- 3. ç‘å…¨ä¼æ¥­å ±åƒ¹åˆ†ææ”¹å–„å·¥å…· -->
    <textarea id="code-2" class="source-code">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‘å…¨ä¼æ¥­å ±åƒ¹åˆ†ææ”¹å–„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@500;700&display=swap');
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .transition-all { transition-duration: 200ms; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, Fragment, useEffect } = React;

        // --- å…¨åŸŸåƒè€ƒè³‡æ–™ ---
        const MACHINE_RATES_REF = [
            { id: 'none', tonnage: 'è‡ªå®šç¾©', rate: 0 },
            { id: '351', tonnage: '100T', rate: 3.00 },
            { id: '012', tonnage: '210T', rate: 5.13 },
            { id: '011', tonnage: '250T', rate: 6.00 },
            { id: '401', tonnage: '400T', rate: 7.20 },
            { id: '502a', tonnage: '450T', rate: 8.00 },
            { id: '501', tonnage: '550T', rate: 8.60 },
            { id: '601', tonnage: '600T', rate: 11.00 },
            { id: '102', tonnage: '800T', rate: 13.00 },
            { id: '121', tonnage: '1300T', rate: 18.00 },
            { id: '151', tonnage: '1500T', rate: 20.00 },
            { id: '221', tonnage: '2200T', rate: 33.00 },
            { id: '312', tonnage: '2700T', rate: 43.66 },
            { id: '321', tonnage: '3200T', rate: 51.04 },
        ];

        const generateId = () => Math.random().toString(36).substring(2, 9);

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Calculator: <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 4v4h4V6H6zm6 0v4h4V6h-4zm-6 6v4h4v-4H6zm6 0v4h4v-4h-4zm-6 6v2h10v-2H6z"/>,
                Plus: <path d="M12 5v14M5 12h14"/>,
                Trash2: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6"/>,
                TrendingUp: <path d="m22 7-8.5 8.5-5-5L2 17M16 7h6v6"/>,
                Layers: <path d="M12 2 2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>,
                Users: <Fragment><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /></Fragment>,
                Cpu: <path d="M4 4h16v16H4zM9 9h6v6H9zM15 2v2M9 2v2M20 15h2M20 9h2M15 20v2M9 20v2M2 15h2M2 9h2"/>,
                Table: <path d="M3 3h18v18H3zM3 9h18M3 15h18M9 3v18"/>,
                Info: <Fragment><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></Fragment>,
                Zap: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />,
                ArrowRight: <path d="M5 12h14M12 5l7 7-7 7" />,
                Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4M7 10l5 5 5-5M12 15V3"/>,
                Tag: <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82zM7 7h.01"/>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const ComparisonInput = ({ originalValue, improvedValue, unit, onChangeOriginal, onChangeImproved, savingValue = 0 }) => {
            const ov = parseFloat(originalValue) || 0;
            const iv = parseFloat(improvedValue) || 0;
            
            const diff = ov > 0 ? (((iv - ov) / ov) * 100).toFixed(1) : 0;
            const isLoss = iv > ov; 
            const hasValue = originalValue !== '' && improvedValue !== '';

            return (
                <div className="mt-4" onClick={(e) => e.stopPropagation()}>
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-white p-4 rounded-2xl border-2 border-slate-100 shadow-sm focus-within:border-blue-400 transition-all text-left">
                            <label className="text-xs font-black text-slate-400 block mb-1.5 uppercase tracking-wider">åŸæœ¬åŸºæº– ({unit})</label>
                            <input 
                                type="number" 
                                inputMode="decimal"
                                placeholder="0"
                                className="w-full font-mono text-slate-600 bg-transparent text-2xl font-bold outline-none" 
                                value={originalValue} 
                                onChange={(e) => onChangeOriginal(e.target.value)} 
                            />
                        </div>
                        <div className={`p-4 rounded-2xl border-2 shadow-sm transition-all focus-within:border-emerald-500 text-left ${hasValue ? (isLoss ? 'bg-red-50 border-red-200' : 'bg-emerald-50 border-emerald-200') : 'bg-white border-slate-100'}`}>
                            <label className={`text-xs font-black block mb-1.5 uppercase tracking-wider ${hasValue ? (isLoss ? 'text-red-600' : 'text-emerald-600') : 'text-slate-400'}`}>æ”¹å–„ç›®æ¨™ ({unit})</label>
                            <div className="flex items-center gap-1">
                                <input 
                                    type="number" 
                                    inputMode="decimal"
                                    placeholder="0"
                                    className={`w-full font-mono bg-transparent text-2xl font-bold outline-none ${hasValue ? (isLoss ? 'text-red-700' : 'text-emerald-700') : 'text-slate-700'}`} 
                                    value={improvedValue} 
                                    onChange={(e) => onChangeImproved(e.target.value)} 
                                />
                                {hasValue && ov > 0 && (
                                    <span className={`text-xs font-black px-2.5 py-1 rounded-full border bg-white whitespace-nowrap ${isLoss ? 'text-red-500 border-red-100' : 'text-emerald-500 border-emerald-100'}`}>
                                        {isLoss ? `+${diff}%` : `${diff}%`}
                                    </span>
                                )}
                            </div>
                        </div>
                    </div>
                    {hasValue && (
                        <div className="mt-3 text-right">
                            <span className={`text-xs font-bold px-3 py-1.5 rounded-xl border italic shadow-sm text-[13px] ${isLoss ? 'text-red-600 bg-red-50 border-red-100' : 'text-blue-600 bg-blue-50 border-blue-100'}`}>
                                {isLoss ? 'é ä¼°æˆæœ¬å¢åŠ ï¼š' : 'é ä¼°å–®ä½ç¯€çœï¼š'}NT$ {Math.abs(savingValue).toFixed(3)}
                            </span>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [productName, setProductName] = useState('');
            const [monthlyQty, setMonthlyQty] = useState('');

            const [materialConfigs, setMaterialConfigs] = useState([{ id: 'm1', label: 'ææ–™é…ç½® 1', weight: '', improvedWeight: '', unitPrice: '' }]);
            const [bomConfigs, setBomConfigs] = useState([{ id: 'b1', label: 'BOM é…ç½®', price: '', improvedPrice: '' }]);
            const [machineConfigs, setMachineConfigs] = useState([{ id: 'c1', tonnage: '1500T', label: 'ä¸»ç”Ÿç”¢é…ç½®', rate: '20.00', cavities: 1, cycleTime: '', improvedCycleTime: '' }]);
            const [assyConfigs, setAssyConfigs] = useState([{ id: 'a1', label: 'çµ„è£é…ç½®', peopleCount: 1, secPerPerson: '', improvedSecPerPerson: '', ratePerSec: 0.05 }]);

            const [selectedMatId, setSelectedMatId] = useState('m1');
            const [selectedBomId, setSelectedBomId] = useState('b1');
            const [selectedMchId, setSelectedMchId] = useState('c1');
            const [selectedAsyId, setSelectedAsyId] = useState('a1');

            useEffect(() => {
                if (materialConfigs.length > 0 && !materialConfigs.find(m => m.id === selectedMatId)) setSelectedMatId(materialConfigs[0].id);
                if (bomConfigs.length > 0 && !bomConfigs.find(b => b.id === selectedBomId)) setSelectedBomId(bomConfigs[0].id);
                if (machineConfigs.length > 0 && !machineConfigs.find(m => m.id === selectedMchId)) setSelectedMchId(machineConfigs[0].id);
                if (assyConfigs.length > 0 && !assyConfigs.find(a => a.id === selectedAsyId)) setSelectedAsyId(assyConfigs[0].id);
            }, [materialConfigs, bomConfigs, machineConfigs, assyConfigs]);

            // è¨ˆç®—ç¯€çœé‡‘é¡çš„å‡½æ•¸ - ç§»è‡³ App å±¤ç´šé˜²æ­¢ ReferenceError
            const getCardSaving = (type, item) => {
                if (type === 'A') {
                    const w1 = parseFloat(item.weight) || 0;
                    const w2 = parseFloat(item.improvedWeight) || 0;
                    const p = parseFloat(item.unitPrice) || 0;
                    return (((w1 - w2) / 1000 * p) * 1.03 * 1.05);
                }
                if (type === 'B') {
                    const p1 = parseFloat(item.price) || 0;
                    const p2 = parseFloat(item.improvedPrice) || 0;
                    return ((p1 - p2) * 1.03);
                }
                if (type === 'MCH') {
                    const s1 = parseFloat(item.cycleTime) || 0;
                    const s2 = parseFloat(item.improvedCycleTime) || 0;
                    const r = parseFloat(item.rate) || 0;
                    const c = parseFloat(item.cavities) || 1;
                    return (((s1 - s2) / 60 * (r / c)) * 1.03 * 1.07);
                }
                if (type === 'ASY') {
                    const s1 = parseFloat(item.secPerPerson) || 0;
                    const s2 = parseFloat(item.improvedSecPerPerson) || 0;
                    const p = parseFloat(item.peopleCount) || 1;
                    const r = parseFloat(item.ratePerSec) || 0;
                    return (((s1 - s2) * p * r) * 1.03 * 1.07);
                }
                return 0;
            };

            const calculateDetails = (mat, bom, mch, asy, isImproved = false) => {
                const weight = parseFloat(isImproved ? mat?.improvedWeight : mat?.weight) || 0;
                const unitPrice = parseFloat(mat?.unitPrice) || 0;
                const bomSum = parseFloat(isImproved ? bom?.improvedPrice : bom?.price) || 0;
                const cycleTime = parseFloat(isImproved ? mch?.improvedCycleTime : mch?.cycleTime) || 0;
                const machineRate = parseFloat(mch?.rate) || 0;
                const assySec = parseFloat(isImproved ? asy?.improvedSecPerPerson : asy?.secPerPerson) || 0;
                const assyRate = parseFloat(asy?.ratePerSec) || 0;
                const cavityFactor = parseFloat(mch?.cavities) || 1;
                const people = parseFloat(asy?.peopleCount) || 1;

                const matBase = (weight / 1000) * unitPrice;
                const totalA = matBase * 1.03 * 1.05;
                const totalB = bomSum * 1.03;
                const injBase = (machineRate / cavityFactor) * (cycleTime / 60);
                const assyBase = (people * assySec) * assyRate;
                const totalC = (injBase + assyBase) * 1.03 * 1.07;

                return { A: totalA, B: totalB, C: totalC, total: totalA + totalB + totalC };
            };

            const comparison = useMemo(() => {
                const mat = materialConfigs.find(m => m.id === selectedMatId) || materialConfigs[0];
                const bom = bomConfigs.find(b => b.id === selectedBomId) || bomConfigs[0];
                const mch = machineConfigs.find(m => m.id === selectedMchId) || machineConfigs[0];
                const asy = assyConfigs.find(a => a.id === selectedAsyId) || assyConfigs[0];

                const current = calculateDetails(mat, bom, mch, asy, false);
                const improved = calculateDetails(mat, bom, mch, asy, true);
                const mQty = parseFloat(monthlyQty) || 0;

                return {
                    current, improved,
                    savingPerUnit: current.total - improved.total,
                    monthlySaving: (current.total - improved.total) * mQty,
                    configNames: { 
                        mat: mat?.label || 'æœªè¨­å®š', 
                        bom: bom?.label || 'æœªè¨­å®š',
                        mch: mch ? `${mch.tonnage} ${mch.label}` : 'æœªè¨­å®š', 
                        asy: asy?.label || 'æœªè¨­å®š' 
                    }
                };
            }, [materialConfigs, bomConfigs, machineConfigs, assyConfigs, selectedMatId, selectedBomId, selectedMchId, selectedAsyId, monthlyQty]);

            const updateField = (setter, id, field, value) => {
                setter(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };

            const handleExport = () => {
                const now = new Date().toLocaleString();
                let csv = '\uFEFFå ±åƒ¹åˆ†ææ”¹å–„å ±è¡¨\n';
                csv += `å°ˆæ¡ˆåç¨±,${productName || 'æœªå‘½åå°ˆæ¡ˆ'}\n`;
                csv += `æ¯æœˆé ä¼°é‡,${monthlyQty || 0} PCS\n`;
                csv += `é¸å®šçµ„åˆ,${comparison.configNames.mat} / ${comparison.configNames.bom} / ${comparison.configNames.mch}\n\n`;
                csv += 'æˆæœ¬é …ç›®,åŸºæº–å–®åƒ¹ (NT$),æ”¹å–„æˆæœ (NT$),å–®ä½ç›ˆè™§ (NT$)\n';
                csv += `A.ææ–™è²»,${comparison.current.A.toFixed(3)},${comparison.improved.A.toFixed(3)},${(comparison.current.A - comparison.improved.A).toFixed(3)}\n`;
                csv += `B.éƒ¨å“è²»,${comparison.current.B.toFixed(3)},${comparison.improved.B.toFixed(3)},${(comparison.current.B - comparison.improved.B).toFixed(3)}\n`;
                csv += `C.åŠ å·¥çµ„è£,${comparison.current.C.toFixed(3)},${comparison.improved.C.toFixed(3)},${(comparison.current.C - comparison.improved.C).toFixed(3)}\n`;
                csv += `æœ€çµ‚å–®åƒ¹,${comparison.current.total.toFixed(3)},${comparison.improved.total.toFixed(3)},${comparison.savingPerUnit.toFixed(3)}\n\n`;
                csv += `æœˆåº¦é ä¼°ç¸½ç›ˆè™§æ•ˆç›Š (NT$),,,${comparison.monthlySaving.toFixed(0)}\n`;

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `ç‘å…¨å ±åƒ¹åˆ†æ_${productName || 'æœªå‘½å'}.csv`;
                link.click();
            };

            return (
                <div className="min-h-screen bg-[#f8fafc] p-4 lg:p-10 font-sans text-slate-900 pb-10 text-left">
                    <div className="max-w-[1600px] mx-auto">
                        
                        <header className="mb-8 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 border-b border-slate-200 pb-6 text-left">
                            <div className="flex-1 w-full lg:w-auto">
                                <div className="inline-flex items-center gap-2 mb-3 text-blue-600 font-extrabold uppercase tracking-[0.2em] text-[10px] bg-blue-50 px-4 py-1 rounded-full border border-blue-100">
                                    <Icon name="Calculator" size={14} /> <span>Cost Precision Analysis System</span>
                                </div>
                                <div className="flex flex-col md:flex-row md:items-center gap-4">
                                    <h1 className="text-2xl md:text-3xl font-black text-slate-900 tracking-tighter uppercase whitespace-nowrap">ç‘å…¨ä¼æ¥­å ±åƒ¹åˆ†ææ”¹å–„</h1>
                                    <div className="flex items-center gap-2 bg-white px-4 py-2 rounded-2xl border-2 border-slate-100 shadow-sm focus-within:border-blue-400 transition-all flex-1 min-w-[200px]">
                                        <Icon name="Tag" size={18} className="text-blue-300" />
                                        <input 
                                            type="text" 
                                            placeholder="è«‹è¼¸å…¥ç”¢å“åç¨±" 
                                            className="w-full font-bold outline-none text-slate-800 bg-transparent text-lg text-left"
                                            value={productName}
                                            onChange={(e) => setProductName(e.target.value)}
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="flex flex-wrap items-center gap-4 w-full lg:w-auto justify-end">
                                <div className="bg-white p-4 rounded-[2rem] shadow-lg border-2 border-slate-50 flex items-center gap-4 min-w-[180px]">
                                    <div className="flex-1 text-left">
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Monthly Qty</label>
                                        <div className="flex items-center gap-2">
                                            <input 
                                                type="number" 
                                                inputMode="numeric" 
                                                placeholder="è«‹è¼¸å…¥" 
                                                className="w-full text-2xl font-mono font-black text-blue-600 outline-none bg-transparent" 
                                                value={monthlyQty} 
                                                onChange={(e) => {
                                                    const clean = e.target.value.replace(/^0+/, '');
                                                    setMonthlyQty(clean === '' ? '' : clean);
                                                }} 
                                            />
                                            <span className="text-slate-300 font-black text-xs uppercase tracking-tighter">Pcs</span>
                                        </div>
                                    </div>
                                    <Icon name="TrendingUp" className="text-blue-200" size={24} />
                                </div>
                                <button 
                                    onClick={handleExport} 
                                    className="bg-slate-900 hover:bg-slate-800 text-white rounded-xl px-6 py-3 flex items-center gap-2 font-bold transition-all shadow-md active:scale-95 text-xs h-[48px] uppercase tracking-widest"
                                >
                                    <Icon name="Download" size={16} /> <span>åŒ¯å‡ºå ±è¡¨</span>
                                </button>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12 items-start text-left text-left">
                            
                            {/* A. ææ–™å€ */}
                            <section>
                                <div className="flex justify-between items-center mb-4 px-2">
                                    <h2 className="text-[13px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
                                        <div className="w-1.5 h-4 bg-emerald-500 rounded-full"></div> A.ææ–™éƒ¨å“è²»æ”¹å–„å„ªåŒ–
                                    </h2>
                                    <button onClick={() => setMaterialConfigs([...materialConfigs, { id: generateId(), label: `æ–°é…ç½®`, weight: '', improvedWeight: '', unitPrice: '' }])} className="text-[10px] bg-white border border-slate-200 px-3 py-1.5 rounded-full font-black shadow-sm">+ æ–°å¢</button>
                                </div>
                                <div className="space-y-4">
                                    {materialConfigs.map((m) => (
                                        <div key={m.id} onClick={() => setSelectedMatId(m.id)} className={`group p-6 rounded-[2.5rem] border-4 transition-all cursor-pointer relative ${selectedMatId === m.id ? 'border-emerald-500 bg-white shadow-xl scale-[1.02]' : 'bg-white/50 border-white hover:border-slate-200'}`}>
                                            <div className="flex justify-between items-start mb-2 pr-10">
                                                <input type="text" className="bg-transparent font-black text-lg outline-none text-slate-800 border-b-2 border-transparent focus:border-emerald-300 w-full" onClick={(e)=>e.stopPropagation()} value={m.label} onChange={(e) => updateField(setMaterialConfigs, m.id, 'label', e.target.value)} />
                                                <div className="flex items-center gap-1 bg-slate-50 px-3 py-1 rounded-xl border border-slate-200 shrink-0" onClick={(e)=>e.stopPropagation()}>
                                                    <span className="text-[10px] font-black text-slate-400">NT$</span>
                                                    <input type="number" inputMode="decimal" placeholder="0" className="w-10 bg-transparent text-center font-mono font-black text-sm text-slate-700 outline-none" value={m.unitPrice} onChange={(e) => updateField(setMaterialConfigs, m.id, 'unitPrice', e.target.value)} />
                                                    <span className="text-[10px] font-black text-slate-400">/kg</span>
                                                </div>
                                            </div>
                                            <ComparisonInput originalValue={m.weight} improvedValue={m.improvedWeight} unit="g" onChangeOriginal={(v)=>updateField(setMaterialConfigs, m.id, 'weight', v)} onChangeImproved={(v)=>updateField(setMaterialConfigs, m.id, 'improvedWeight', v)} savingValue={getCardSaving('A', m)} />
                                            <button onClick={(e) => { e.stopPropagation(); setMaterialConfigs(prev => prev.filter(x => x.id !== m.id)); }} className="absolute top-6 right-6 text-slate-300 hover:text-red-500 p-1 transition-all"><Icon name="Trash2" size={18}/></button>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            {/* B. BOM å€ */}
                            <section>
                                <div className="flex justify-between items-center mb-4 px-2">
                                    <h2 className="text-[13px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2 text-left">
                                        <div className="w-1.5 h-4 bg-blue-500 rounded-full text-left"></div> B.æ§‹æˆéƒ¨å“è²»æ”¹å–„å„ªåŒ–
                                    </h2>
                                    <button onClick={() => setBomConfigs([...bomConfigs, { id: generateId(), label: `BOMé…ç½®`, price: '', improvedPrice: '' }])} className="text-[10px] bg-white border border-slate-200 px-3 py-1.5 rounded-full font-black shadow-sm">+ æ–°å¢</button>
                                </div>
                                <div className="space-y-4">
                                    {bomConfigs.map((b) => (
                                        <div key={b.id} onClick={() => setSelectedBomId(b.id)} className={`group p-6 rounded-[2.5rem] border-4 transition-all cursor-pointer relative ${selectedBomId === b.id ? 'border-blue-500 bg-white shadow-xl scale-[1.02]' : 'bg-white/50 border-white hover:border-slate-200'}`}>
                                            <div className="flex justify-between items-start mb-2 pr-10 text-left">
                                                <input type="text" className="bg-transparent font-black text-lg outline-none text-slate-800 border-b-2 border-transparent focus:border-blue-300 w-full" onClick={(e)=>e.stopPropagation()} value={b.label} onChange={(e) => updateField(setBomConfigs, b.id, 'label', e.target.value)} />
                                            </div>
                                            <ComparisonInput originalValue={b.price} improvedValue={b.improvedPrice} unit="NT$" onChangeOriginal={(v)=>updateField(setBomConfigs, b.id, 'price', v)} onChangeImproved={(v)=>updateField(setBomConfigs, b.id, 'improvedPrice', v)} savingValue={getCardSaving('B', b)} />
                                            <button onClick={(e) => { e.stopPropagation(); setBomConfigs(prev => prev.filter(x => x.id !== b.id)); }} className="absolute top-6 right-6 text-slate-300 hover:text-red-500 p-1 transition-all"><Icon name="Trash2" size={18}/></button>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            {/* C. åŠ å·¥å€ */}
                            <section>
                                <div className="flex justify-between items-center mb-4 px-2">
                                    <h2 className="text-[13px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
                                        <div className="w-1.5 h-4 bg-orange-500 rounded-full"></div> C.åŠ å·¥è²»æ”¹å–„å„ªåŒ–
                                    </h2>
                                    <button onClick={() => setMachineConfigs([...machineConfigs, { id: generateId(), tonnage: 'è‡ªå®šç¾©', label: `ç”Ÿç”¢ç·š`, rate: '', cavities: 1, cycleTime: '', improvedCycleTime: '' }])} className="text-[10px] bg-white border border-slate-200 px-3 py-1.5 rounded-full font-black shadow-sm">+ æ–°å¢</button>
                                </div>
                                <div className="space-y-6">
                                    {machineConfigs.map((m) => (
                                        <div key={m.id} onClick={()=>setSelectedMchId(m.id)} className={`group p-6 rounded-[2.5rem] border-4 transition-all cursor-pointer relative overflow-hidden ${selectedMchId === m.id ? 'border-orange-500 bg-white shadow-xl scale-[1.02]' : 'bg-white/50 border-white hover:border-slate-200'}`}>
                                            <div className="flex flex-wrap items-center gap-3 mb-4 pr-10 text-left" onClick={(e)=>e.stopPropagation()}>
                                                <select className="font-black text-orange-600 bg-orange-50 rounded-2xl px-3 py-1.5 outline-none text-xs border border-orange-100 cursor-pointer" value={m.tonnage} onChange={(e) => { const ref = MACHINE_RATES_REF.find(r => r.tonnage === e.target.value); updateField(setMachineConfigs, m.id, 'tonnage', ref.tonnage); updateField(setMachineConfigs, m.id, 'rate', ref.rate.toString()); }}>
                                                    {MACHINE_RATES_REF.map(ref => <option key={ref.id} value={ref.tonnage}>{ref.tonnage}</option>)}
                                                </select>
                                                <input type="text" className="bg-transparent font-black text-lg outline-none text-slate-700 flex-1 min-w-[80px]" value={m.label} onChange={(e) => updateField(setMachineConfigs, m.id, 'label', e.target.value)}/>
                                                <div className="flex flex-wrap items-center gap-2 shrink-0 text-left">
                                                    <div className="flex items-center gap-1 bg-slate-50 px-3 py-1.5 rounded-xl border border-slate-200">
                                                        <span className="text-[10px] font-black text-slate-400">NT$</span>
                                                        <input type="number" inputMode="decimal" placeholder="0" className="w-14 bg-transparent text-center font-mono font-black text-sm text-orange-600 outline-none" value={m.rate} onChange={(e) => updateField(setMachineConfigs, m.id, 'rate', e.target.value)} />
                                                        <span className="text-[10px] font-black text-slate-400">/åˆ†</span>
                                                    </div>
                                                    <div className="flex items-center gap-1 bg-blue-50 px-3 py-1.5 rounded-xl border border-blue-100 text-left">
                                                        <span className="text-[10px] font-black text-blue-400 uppercase">Cav</span>
                                                        <input type="number" inputMode="numeric" className="w-6 bg-transparent text-center font-black text-blue-600 text-sm outline-none" value={m.cavities} onChange={(e)=>updateField(setMachineConfigs, m.id, 'cavities', e.target.value)} />
                                                    </div>
                                                </div>
                                            </div>
                                            <ComparisonInput originalValue={m.cycleTime} improvedValue={m.improvedCycleTime} unit="ç§’ (S)" onChangeOriginal={(v)=>updateField(setMachineConfigs, m.id, 'cycleTime', v)} onChangeImproved={(v)=>updateField(setMachineConfigs, m.id, 'improvedCycleTime', v)} savingValue={getCardSaving('MCH', m)} />
                                            <button onClick={(e) => { e.stopPropagation(); setMachineConfigs(prev => prev.filter(x => x.id !== m.id)); }} className="absolute top-6 right-6 text-slate-300 hover:text-red-500 p-1 transition-all"><Icon name="Trash2" size={18}/></button>
                                        </div>
                                    ))}

                                    <div className="border-t border-slate-200 pt-6 mt-4 text-left">
                                        <div className="flex justify-between items-center mb-4 px-2 text-left">
                                            <h3 className="text-xs font-black text-purple-600 uppercase tracking-widest flex items-center gap-2"><Icon name="Users" size={16}/> çµ„è£å·¥æ™‚å„ªåŒ–</h3>
                                            <button onClick={() => setAssyConfigs([...assyConfigs, { id: generateId(), label: `é…ç½®`, peopleCount: 1, secPerPerson: '', improvedSecPerPerson: '', ratePerSec: 0.05 }])} className="text-[10px] bg-white border border-slate-200 px-3 py-1.5 rounded-full font-black shadow-sm">+ æ–°å¢</button>
                                        </div>
                                        {assyConfigs.map((a) => (
                                            <div key={a.id} onClick={()=>setSelectedAsyId(a.id)} className={`group p-6 rounded-[2.5rem] border-4 transition-all cursor-pointer relative mb-4 ${selectedAsyId === a.id ? 'border-purple-500 bg-white shadow-xl scale-[1.02]' : 'bg-white/50 border-white hover:border-slate-200'}`}>
                                                <div className="flex flex-wrap items-center justify-between gap-3 mb-3 pr-10 text-left" onClick={(e)=>e.stopPropagation()}>
                                                    <input type="text" className="bg-transparent font-black text-lg outline-none text-slate-800 flex-1" value={a.label} onChange={(e) => updateField(setAssyConfigs, a.id, 'label', e.target.value)}/>
                                                    <div className="flex gap-2 shrink-0">
                                                        <div className="flex items-center gap-1 bg-purple-50 px-3 py-1.5 rounded-xl border border-purple-100 text-left">
                                                            <span className="text-[10px] font-black text-purple-400">P</span>
                                                            <input type="number" inputMode="numeric" className="w-6 bg-transparent text-center font-black text-purple-700 text-sm outline-none" value={a.peopleCount} onChange={(e)=>updateField(setAssyConfigs, a.id, 'peopleCount', e.target.value)}/>
                                                        </div>
                                                        <div className="flex items-center gap-1 bg-slate-50 px-3 py-1.5 rounded-xl border border-slate-200 text-left text-left">
                                                            <span className="text-[10px] font-black text-slate-400">NT$</span>
                                                            <input type="number" step="0.01" inputMode="decimal" className="w-16 bg-transparent text-center font-mono font-black text-sm text-blue-600 outline-none" value={a.ratePerSec} onChange={(e) => updateField(setAssyConfigs, a.id, 'ratePerSec', e.target.value)} />
                                                            <span className="text-[10px] font-black text-slate-400">/ç§’</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <ComparisonInput originalValue={a.secPerPerson} improvedValue={a.improvedSecPerPerson} unit="ç§’ (S)" onChangeOriginal={(v)=>updateField(setAssyConfigs, a.id, 'secPerPerson', v)} onChangeImproved={(v)=>updateField(setAssyConfigs, a.id, 'improvedSecPerPerson', v)} savingValue={getCardSaving('ASY', a)} />
                                                <button onClick={(e) => { e.stopPropagation(); setAssyConfigs(prev => prev.filter(x => x.id !== a.id)); }} className="absolute top-6 right-6 text-slate-300 hover:text-red-500 p-1 transition-all"><Icon name="Trash2" size={18}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </section>
                        </div>

                        {/* --- ç²¾ç°¡ç‰ˆå¸¸é§å ±è¡¨ (æ‰‹æ©Ÿç«¯å„ªåŒ–) --- */}
                        <div className="bg-slate-900 rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-800 mb-8">
                            <div className="p-8 bg-gradient-to-br from-slate-800 to-slate-900 border-b border-slate-800 flex flex-col md:flex-row justify-between items-center gap-6">
                                <div className="flex items-center gap-5 text-left">
                                    <div className="bg-blue-500/10 p-4 rounded-2xl border border-blue-500/20">
                                        <Icon name="Zap" size={32} className="text-blue-400 drop-shadow-[0_0_10px_rgba(96,165,250,0.6)]" />
                                    </div>
                                    <div className="text-left text-left text-left">
                                        <h2 className="text-2xl font-black text-white tracking-tighter uppercase mb-1 italic">æ”¹å–„æˆæœåˆ†æ</h2>
                                        <div className="flex flex-wrap gap-2 text-left">
                                            <div className="text-[9px] font-black text-slate-400 bg-slate-800 px-3 py-1 rounded-full border border-slate-700 uppercase tracking-widest">{productName || 'å°ˆæ¡ˆåç¨±'}</div>
                                            <div className="text-[9px] font-black text-slate-400 bg-slate-800 px-3 py-1 rounded-full border border-slate-700 uppercase tracking-widest">{comparison.configNames.mch}</div>
                                        </div>
                                    </div>
                                </div>
                                <div className="text-center md:text-right">
                                    <div className="text-[10px] font-black text-green-400 uppercase tracking-widest mb-1 text-left md:text-right">Monthly Saving Potential</div>
                                    <div className={`text-4xl md:text-6xl font-mono font-black tracking-tighter drop-shadow-lg ${comparison.monthlySaving >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        NT$ {comparison.monthlySaving.toLocaleString(undefined, {maximumFractionDigits:0})}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="overflow-x-auto text-left">
                                <table className="w-full text-right border-collapse min-w-0 text-left text-left text-left">
                                    <thead>
                                        <tr className="bg-slate-900/50 text-[9px] text-slate-500 font-black uppercase border-b border-slate-800 tracking-widest text-left">
                                            <th className="p-5 text-left">é …ç›®</th>
                                            <th className="p-5 text-right">åŸºæº– (Original)</th>
                                            <th className="p-5 text-green-400 text-right">ç›®æ¨™ (Improved)</th>
                                            <th className="p-5 text-blue-400 text-right">å–®ä»¶ç›ˆè™§</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-xs divide-y divide-slate-800 font-mono text-white/80 text-left">
                                        <tr className="hover:bg-slate-800/20 text-left">
                                            <td className="p-5 text-left text-left">A. ææ–™è²»</td>
                                            <td className="p-5 text-right">{comparison.current.A.toFixed(3)}</td>
                                            <td className="p-5 text-green-300 font-bold text-right">{comparison.improved.A.toFixed(3)}</td>
                                            <td className={`p-5 font-bold text-right ${(comparison.current.A - comparison.improved.A) >= 0 ? 'text-blue-400' : 'text-red-400'}`}>{(comparison.current.A - comparison.improved.A).toFixed(3)}</td>
                                        </tr>
                                        <tr className="hover:bg-slate-800/20 text-left text-left">
                                            <td className="p-5 text-left text-left">B. éƒ¨å“è²»</td>
                                            <td className="p-5 text-right">{comparison.current.B.toFixed(3)}</td>
                                            <td className="p-5 text-green-300 font-bold text-right">{comparison.improved.B.toFixed(3)}</td>
                                            <td className={`p-5 font-bold text-right ${(comparison.current.B - comparison.improved.B) >= 0 ? 'text-blue-400' : 'text-red-400'}`}>{(comparison.current.B - comparison.improved.B).toFixed(3)}</td>
                                        </tr>
                                        <tr className="hover:bg-slate-800/20 text-left text-left">
                                            <td className="p-5 text-left text-left">C. åŠ å·¥çµ„è£</td>
                                            <td className="p-5 text-right">{comparison.current.C.toFixed(3)}</td>
                                            <td className="p-5 text-green-300 font-bold text-right">{comparison.improved.C.toFixed(3)}</td>
                                            <td className={`p-5 font-bold text-right ${(comparison.current.C - comparison.improved.C) >= 0 ? 'text-blue-400' : 'text-red-400'}`}>{(comparison.current.C - comparison.improved.C).toFixed(3)}</td>
                                        </tr>
                                        <tr className="bg-blue-500/5 border-t-2 border-slate-700">
                                            <td className="p-6 text-left">
                                                <div className="font-black text-white text-base uppercase leading-none">æœ€çµ‚å–®åƒ¹å°æ¯”</div>
                                            </td>
                                            <td className="p-6 font-bold text-right">{comparison.current.total.toFixed(3)}</td>
                                            <td className="p-6 text-green-400 font-black text-2xl italic text-right">{comparison.improved.total.toFixed(3)}</td>
                                            <td className={`p-6 font-black text-2xl underline decoration-2 underline-offset-4 text-right ${comparison.savingPerUnit >= 0 ? 'text-blue-400 decoration-blue-500/50' : 'text-red-400 decoration-red-500/50'}`}>
                                                {comparison.savingPerUnit.toFixed(3)}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* --- å…¬å¼æ‘˜è¦ (ç²¾ç°¡ç‰ˆ) --- */}
                        <div className="p-8 bg-white rounded-[2.5rem] border-2 border-slate-100 text-[10px] text-slate-400 grid grid-cols-1 md:grid-cols-2 gap-8 shadow-sm text-left font-medium text-left">
                             <div className="text-left font-medium text-left">
                                <h4 className="font-black text-slate-800 mb-4 flex items-center gap-3 uppercase tracking-widest text-xs leading-none"><Icon name="Info" size={16} className="text-blue-500"/> æ ¸ç®—å…¬å¼æ‘˜è¦</h4>
                                <ul className="space-y-3 list-none text-left font-semibold text-left">
                                    <li className="text-left">A. ææ–™è²»æ”¹å–„ï¼š[(é‡é‡/1000 Ã— å–®åƒ¹) Ã— 1.03æè€—] Ã— 1.05åˆ©æ½¤</li>
                                    <li className="text-left">B. éƒ¨å“è²»æ”¹å–„ï¼š(BOMå–®åƒ¹ç¸½å’Œ) Ã— 1.03æè€— (è¦å®šä¸è¨ˆåˆ©æ½¤)</li>
                                    <li className="text-left">C. åŠ å·¥è²»æ”¹å–„ï¼š[(å°„å‡ºå–®åƒ¹ + çµ„è£å–®åƒ¹) Ã— 1.03æè€—] Ã— 1.07åˆ©æ½¤</li>
                                </ul>
                             </div>
                             <div className="bg-slate-50 p-6 rounded-[2rem] border border-slate-100 flex items-center italic text-slate-500 leading-relaxed text-left text-left">
                                 <p className="text-left text-left">
                                     <span className="text-blue-600 font-black uppercase block mb-1">ä½¿ç”¨æé†’ï¼š</span>
                                     æ”¹å–„ç›®æ¨™è‹¥é«˜æ–¼åŸºæº–å€¼ï¼Œç™¾åˆ†æ¯”èˆ‡å–®ä½ç›ˆè™§å°‡ä»¥ç´…è‰²æ¨™ç¤ºã€‚å ±è¡¨å€å¡Šå·²é‡å°æ‰‹æ©Ÿå¯¬åº¦é€²è¡Œå£“ç¸®è¨­è¨ˆï¼Œç¢ºä¿æ ¸å¿ƒæ•¸æ“šä¸€å±å…§å¯å®Œæ•´è®€å–ã€‚
                                 </p>
                             </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
    </textarea>

    <!-- 4. äººåŠ›æˆæœ¬è¨ˆç®— -->
    <textarea id="code-3" class="source-code">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ç‘å…¨äººåŠ›æˆæœ¬æ±ºç­–æ¨¡æ“¬å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1.2rem; }
        .tab-active { background-color: #2563eb; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="p-4 md:p-10 text-slate-800">
    <div class="max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-6">
            <div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tight italic">2026 ç‘å…¨äººåŠ›æˆæœ¬æ¨¡æ“¬å™¨</h1>
                <p class="text-blue-600 font-medium mt-1">äºŒä»£æ¥ç­å°ˆç”¨ï¼šå«è‡ªè¨‚å¹´çµ‚ä¹‹ã€ŒçœŸå¯¦å°æ™‚æˆæœ¬ã€ç²¾ç®—</p>
            </div>
            <!-- Staff Type Switcher -->
            <div class="inline-flex p-1.5 bg-slate-200 rounded-2xl shadow-inner w-full md:w-auto">
                <button id="btnMigrant" onclick="setStaffType('migrant')" class="flex-1 md:px-8 py-3 rounded-xl text-sm font-bold transition-all duration-200 tab-active">å¤–ç±ç§»å·¥</button>
                <button id="btnLocal" onclick="setStaffType('local')" class="flex-1 md:px-8 py-3 rounded-xl text-sm font-bold transition-all duration-200 text-slate-500">æœ¬ç±å‹å·¥</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Side: Inputs -->
            <div class="lg:col-span-7 space-y-6">
                
                <!-- 1. è–ªè³‡èˆ‡çé‡‘è¨­å®š -->
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-2 h-full bg-blue-600"></div>
                    <h2 class="text-lg font-bold mb-6 flex items-center text-slate-700">
                        <span class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mr-3 text-sm italic font-black">01</span>
                        è–ªè³‡èˆ‡å¹´çµ‚è¨­å®š
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-xs font-black text-slate-400 uppercase mb-2 tracking-widest">æ¯æœˆå¯¦ç™¼è–ªè³‡ (åŠ ç­åŸºæº–)</label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                                <input type="number" id="actualSalary" value="29500" oninput="calculateAll()" class="w-full pl-10 pr-4 py-4 bg-slate-50 border-2 border-transparent rounded-2xl text-2xl font-black text-slate-900 focus:bg-white focus:border-blue-500 transition-all outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-black text-slate-400 uppercase mb-2 tracking-widest text-orange-600">å¹´çµ‚çé‡‘ (ç›´æ¥å¡«å…¥é‡‘é¡)</label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-orange-400 font-bold">$</span>
                                <input type="number" id="bonusAmount" value="29500" oninput="calculateAll()" class="w-full pl-10 pr-4 py-4 bg-orange-50/30 border-2 border-orange-100 rounded-2xl text-2xl font-black text-orange-600 focus:bg-white focus:border-orange-500 transition-all outline-none">
                            </div>
                            <p class="text-[10px] text-orange-400 mt-2 italic">â€» æ­¤é‡‘é¡å°‡æ”¤æåˆ°å¹´åº¦æ™‚è–ªä¸­</p>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-black text-slate-400 uppercase mb-2 tracking-widest">æŠ•ä¿ç´šè· (å½±éŸ¿æ³•å®šè¦è²»)</label>
                            <select id="insuranceGrade" onchange="updateInsuranceCosts()" class="w-full p-4 bg-slate-50 border-2 border-transparent rounded-2xl text-lg font-bold text-slate-700 focus:bg-white focus:border-blue-500 transition-all outline-none cursor-pointer shadow-inner">
                                <!-- JS Populated -->
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 2. ä¼æ¥­è² æ“”æ˜ç´° -->
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                    <h2 class="text-lg font-bold mb-6 flex items-center text-slate-700">
                        <span class="w-8 h-8 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center mr-3 text-sm italic font-black">02</span>
                        ä¼æ¥­æ³•å®šè² æ“” (æ¯æœˆ)
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-slate-600 text-sm">
                        <div class="p-5 rounded-2xl bg-slate-50 border border-slate-100 shadow-sm">
                            <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">å‹ä¿è²» (é›‡ä¸»)</label>
                            <p class="text-[10px] font-bold text-blue-500 mb-2" id="displayLaborRate">~8.05%</p>
                            <div class="flex items-baseline font-black">
                                <span class="text-xs text-slate-400 mr-1">$</span>
                                <input type="number" id="feeLabor" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none text-slate-700">
                            </div>
                        </div>
                        <div class="p-5 rounded-2xl bg-slate-50 border border-slate-100 shadow-sm">
                            <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">å¥ä¿è²» (é›‡ä¸»)</label>
                            <p class="text-[10px] font-bold text-slate-400 mb-2">~4.84%</p>
                            <div class="flex items-baseline font-black">
                                <span class="text-xs text-slate-400 mr-1">$</span>
                                <input type="number" id="feeHealth" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none text-slate-700">
                            </div>
                        </div>
                        <div id="pensionContainer" class="p-5 rounded-2xl border transition-all duration-300">
                            <label class="block text-[10px] font-black uppercase mb-1" id="pensionLabel">å‹é€€é‡‘ (6%)</label>
                            <p class="text-[10px] font-bold mb-2" id="pensionDesc">åƒ…æœ¬ç±é©ç”¨</p>
                            <div class="flex items-baseline font-black">
                                <span class="text-xs mr-1 opacity-50">$</span>
                                <input type="number" id="feePension" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none">
                            </div>
                        </div>
                        <div id="stabilityContainer" class="p-5 rounded-2xl border transition-all duration-300 shadow-sm">
                            <label class="block text-[10px] font-black uppercase mb-1" id="stabilityLabel">å°±æ¥­å®‰å®šè²»</label>
                            <p class="text-[10px] font-bold mb-2" id="stabilityDesc">å¤–å‹å°ˆç”¨</p>
                            <div class="flex items-baseline font-black">
                                <span class="text-xs mr-1 opacity-50">$</span>
                                <input type="number" id="feeStability" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none text-slate-700">
                            </div>
                        </div>
                        <div class="p-5 rounded-2xl bg-blue-50/50 border border-blue-100 shadow-sm">
                            <label class="block text-[10px] font-black text-blue-600 uppercase mb-1 font-black">è·ç½ä¿éšª (å‹•æ…‹)</label>
                            <p class="text-[10px] font-bold text-blue-400 mb-2">è²»ç‡ ~0.24%</p>
                            <div class="flex items-baseline font-black text-blue-700">
                                <span class="text-xs mr-1 opacity-50">$</span>
                                <input type="number" id="feeAccident" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. åŠ ç­è¨­å®š -->
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                    <h2 class="text-lg font-bold mb-6 flex items-center text-slate-700">
                        <span class="w-8 h-8 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center mr-3 text-sm italic font-black">03</span>
                        å‡ºå‹¤èˆ‡åŠ ç­é…ç½® (ç‘å…¨å…¬å¼: 1.33 / 1.66)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-orange-50/50 p-6 rounded-2xl border border-orange-100 shadow-sm">
                            <label class="block text-xs font-black text-orange-600 uppercase mb-4 tracking-widest">å¹³æ—¥åŠ ç­ (æœˆåŸºæº– 22å¤©)</label>
                            <div class="flex items-center space-x-4">
                                <div class="flex-1">
                                    <span class="text-[10px] text-orange-400 font-bold uppercase">å¤©æ•¸</span>
                                    <input type="number" id="otDays" value="22" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-orange-200 font-bold outline-none text-center">
                                </div>
                                <div class="flex-1">
                                    <span class="text-[10px] text-orange-400 font-bold uppercase">æ¯æ—¥å°æ™‚</span>
                                    <input type="number" id="otHours" value="1" step="0.5" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-orange-200 font-bold outline-none text-center">
                                </div>
                            </div>
                        </div>
                        <div class="bg-red-50/50 p-6 rounded-2xl border border-red-100 shadow-sm">
                            <label class="block text-xs font-black text-red-600 uppercase mb-4 tracking-widest">å‡æ—¥åŠ ç­ (8å°æ™‚/æ—¥)</label>
                            <div class="flex items-center space-x-4">
                                <div class="flex-1">
                                    <span class="text-[10px] text-red-400 font-bold uppercase">å¤©æ•¸</span>
                                    <input type="number" id="holidayDays" value="0" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-red-200 font-bold outline-none text-center">
                                </div>
                                <div class="flex-1">
                                    <span class="text-[10px] text-red-400 font-bold uppercase">æ™‚æ•¸</span>
                                    <input type="number" id="holidayHours" value="8" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-red-200 font-bold outline-none text-center">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Result Dashboard -->
            <div class="lg:col-span-5 space-y-6">
                <!-- Annual Dashboard -->
                <div class="bg-blue-600 rounded-[2.5rem] p-10 text-white shadow-2xl relative overflow-hidden group">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl transition-all duration-700"></div>
                    <div class="relative z-10 text-center">
                        <p class="text-blue-100 text-[10px] font-black uppercase tracking-[0.4em] mb-4 underline decoration-blue-400 underline-offset-4">Annual Enterprise Total (ä¸€æ•´å¹´)</p>
                        <div class="flex items-baseline justify-center">
                            <span class="text-2xl font-bold text-blue-200 mr-2">$</span>
                            <div class="text-6xl font-black tracking-tighter" id="displayAnnualCost">0</div>
                        </div>
                        <div class="mt-6 flex justify-between items-center text-xs text-blue-100 bg-white/10 p-4 rounded-2xl border border-white/20">
                             <span class="font-bold uppercase tracking-widest">å¹´çµ‚çé‡‘ç¸½é¡ï¼š</span>
                             <span class="font-black text-2xl text-white" id="displayYearEndAmount">$0</span>
                        </div>
                    </div>
                </div>

                <!-- Monthly Dashboard -->
                <div class="bg-slate-900 rounded-[2.5rem] p-10 text-white shadow-2xl sticky top-10 border border-slate-800 overflow-hidden relative">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-600/10 rounded-full blur-3xl"></div>
                    
                    <div class="relative z-10">
                        <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.4em] mb-4 tracking-[0.2em]">Management Decision Board</p>
                        <div class="flex items-baseline mb-8">
                            <span class="text-3xl font-bold text-slate-600 mr-2">$</span>
                            <div class="text-5xl font-black tracking-tighter" id="displayTotalCost">0</div>
                        </div>

                        <div class="grid grid-cols-1 gap-6 mb-8 pt-8 border-t border-slate-800">
                            <!-- çœŸå¯¦å ±åƒ¹åŸºæº– -->
                            <div class="flex items-center justify-between text-blue-400 group">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full bg-blue-500 mr-3 animate-pulse"></div>
                                    <span class="text-sm font-black">å ±åƒ¹åŸºæº–æ™‚è–ª (å«å¹´çµ‚)</span>
                                </div>
                                <span class="text-3xl font-black" id="displayHourlyRate">$0</span>
                            </div>
                            
                            <!-- åŠ ç­è¨ˆç®—åŸºæº– -->
                            <div class="flex items-center justify-between text-slate-400 border-t border-slate-800/50 pt-4">
                                <div class="flex flex-col">
                                    <span class="text-[10px] font-black uppercase tracking-widest uppercase">åŠ ç­è²»æ ¸ç®—åŸºæº– (1.0x)</span>
                                    <span class="text-[9px] text-slate-500 font-bold italic">â€» ç‘å…¨å…¬å¼: è–ªè³‡ Ã· 240</span>
                                </div>
                                <span class="text-xl font-bold text-slate-300" id="displayHourlyBaseText">$0.0</span>
                            </div>

                            <div class="flex items-center justify-between text-slate-400">
                                <span class="text-[10px] font-black uppercase tracking-widest uppercase">æ¯æœˆç¸½æŠ•å…¥å·¥æ™‚</span>
                                <span class="text-xl font-bold text-slate-300" id="displayTotalHours">0 hr</span>
                            </div>
                        </div>

                        <div class="space-y-4 text-slate-300">
                            <div class="bg-white/5 p-5 rounded-[1.5rem] border border-white/10 flex justify-between items-center transition-all hover:bg-white/10">
                                <span class="text-orange-400 text-[10px] font-black tracking-widest uppercase">æ¯æœˆåŠ ç­è²»</span>
                                <span class="text-xl font-black text-orange-500" id="displayTotalOT">$0</span>
                            </div>
                            <div class="bg-white/5 p-5 rounded-[1.5rem] border border-white/10 flex justify-between items-center transition-all hover:bg-white/10">
                                <span class="text-blue-400 text-[10px] font-black tracking-widest uppercase">æ¯æœˆè¦è²»ç¸½è¨ˆ</span>
                                <span class="text-xl font-black text-blue-500" id="displayTotalFees">$0</span>
                            </div>
                        </div>

                        <div id="statusIndicator" class="mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] text-center shadow-inner transition-all duration-500 bg-slate-800 border border-slate-700">
                            ç‘å…¨ç‡Ÿé‹æ±ºç­–å‹•æ…‹åˆ†æ
                        </div>
                    </div>
                </div>

                <!-- Alert Box -->
                <div id="alertBox" class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm hidden transition-all duration-300 shadow-xl shadow-slate-100">
                    <div class="flex items-center mb-4">
                        <div class="w-1.5 h-6 bg-blue-600 rounded-full mr-3"></div>
                        <h4 class="font-black text-slate-800 text-sm italic" id="alertTitle">é¡§å•ç¶“ç‡Ÿå»ºè­°</h4>
                    </div>
                    <p class="text-xs text-slate-500 leading-relaxed font-bold italic" id="alertDesc"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStaffType = 'migrant';

        function initInsuranceOptions() {
            const select = document.getElementById('insuranceGrade');
            const grades = [0, 29500, 30300, 31800, 33300, 34800, 36300, 38200, 40100, 42000, 43900, 45800];
            
            grades.forEach(val => {
                const opt = document.createElement('option');
                opt.value = val;
                if (val === 0) {
                    opt.innerText = "ä¸è¨ˆç®—å‹å¥ä¿/è¦è²» (0)";
                } else {
                    opt.innerText = `æŠ•ä¿ç´šè·ï¼šNT$ ${val.toLocaleString()}`;
                    if(val === 29500) opt.innerText += " (2026 æœ€ä½åŸºæº–)";
                }
                select.appendChild(opt);
            });
            select.value = 29500;
        }

        function setStaffType(type) {
            currentStaffType = type;
            const btnMigrant = document.getElementById('btnMigrant');
            const btnLocal = document.getElementById('btnLocal');

            if (type === 'migrant') {
                btnMigrant.classList.add('tab-active');
                btnMigrant.classList.remove('text-slate-500');
                btnLocal.classList.remove('tab-active');
                btnLocal.classList.add('text-slate-500');
            } else {
                btnLocal.classList.add('tab-active');
                btnLocal.classList.remove('text-slate-500');
                btnMigrant.classList.remove('tab-active');
                btnMigrant.classList.add('text-slate-500');
            }
            updateInsuranceCosts();
        }

        function updateInsuranceCosts() {
            const grade = parseFloat(document.getElementById('insuranceGrade').value);
            const isMigrant = (currentStaffType === 'migrant');
            
            const pc = document.getElementById('pensionContainer');
            const sc = document.getElementById('stabilityContainer');
            const pl = document.getElementById('pensionLabel');
            const sl = document.getElementById('stabilityLabel');

            if (grade === 0) {
                ["feeLabor", "feeHealth", "feePension", "feeStability", "feeAccident"].forEach(id => document.getElementById(id).value = 0);
            } else {
                const laborRate = isMigrant ? 0.0805 : 0.0875;
                document.getElementById('displayLaborRate').innerText = `~${(laborRate * 100).toFixed(2)}%`;
                
                document.getElementById('feeLabor').value = Math.round(grade * laborRate);
                document.getElementById('feeHealth').value = Math.round(grade * 0.0484);
                document.getElementById('feeAccident').value = Math.round(grade * 0.0024);
                
                if (isMigrant) {
                    document.getElementById('feePension').value = 0;
                    document.getElementById('feeStability').value = 5000;
                    sc.className = "p-5 rounded-2xl bg-blue-50 border-2 border-blue-500 ring-4 ring-blue-500/5 shadow-inner";
                    sl.className = "block text-[10px] font-black text-blue-600 uppercase mb-1";
                    pc.className = "p-5 rounded-2xl bg-slate-50 border border-slate-100 opacity-50";
                    pl.className = "block text-[10px] font-black text-slate-400 uppercase mb-1";
                } else {
                    document.getElementById('feePension').value = Math.round(grade * 0.06);
                    document.getElementById('feeStability').value = 0;
                    pc.className = "p-5 rounded-2xl bg-blue-50 border-2 border-blue-500 ring-4 ring-blue-500/5 shadow-inner";
                    pl.className = "block text-[10px] font-black text-blue-600 uppercase mb-1";
                    sc.className = "p-5 rounded-2xl bg-slate-50 border border-slate-100 opacity-50";
                    sl.className = "block text-[10px] font-black text-slate-400 uppercase mb-1";
                }
            }
            calculateAll();
        }

        function calculateAll() {
            const actualSalary = parseFloat(document.getElementById('actualSalary').value) || 0;
            const bonusAmount = parseFloat(document.getElementById('bonusAmount').value) || 0;
            const feeLabor = parseFloat(document.getElementById('feeLabor').value) || 0;
            const feeHealth = parseFloat(document.getElementById('feeHealth').value) || 0;
            const feePension = parseFloat(document.getElementById('feePension').value) || 0;
            const feeStability = parseFloat(document.getElementById('feeStability').value) || 0;
            const feeAccident = parseFloat(document.getElementById('feeAccident').value) || 0;
            
            // æ¯æœˆè¦è²»
            const totalMonthlyFees = feeLabor + feeHealth + feePension + feeStability + feeAccident;
            document.getElementById('displayTotalFees').innerText = '$' + totalMonthlyFees.toLocaleString();

            const otDays = parseFloat(document.getElementById('otDays').value) || 0;
            const otHours = parseFloat(document.getElementById('otHours').value) || 0;
            const holidayDays = parseFloat(document.getElementById('holidayDays').value) || 0;
            const holidayHours = parseFloat(document.getElementById('holidayHours').value) || 0;

            // åŠ ç­è²»æ ¸ç®—åŸºæº– (æ³•å¾‹åŸºæº–ä¸å«å¹´çµ‚)
            const hourlyBase = actualSalary / 240;
            document.getElementById('displayHourlyBaseText').innerText = `$ ${hourlyBase.toFixed(1)} / hr`;

            // æ¯æœˆåŠ ç­è²» (æ›´æ–°å…¬å¼: 1.33 / 1.66)
            let dailyOT = 0;
            if (otHours <= 2) {
                dailyOT = otHours * hourlyBase * 1.33;
            } else {
                dailyOT = (2 * hourlyBase * 1.33) + ((otHours - 2) * hourlyBase * 1.66);
            }
            const totalOTPay = dailyOT * otDays;
            
            // å‡æ—¥åŠ ç­è²»è¨ˆç®— (ä¿®æ­£é‚è¼¯: ç¢ºä¿æ™‚æ•¸å°‘æ–¼2å°æ™‚ä¹Ÿèƒ½æ­£ç¢ºè¨ˆç®—)
            let dailyHolidayPay = 0;
            if (holidayHours <= 2) {
                dailyHolidayPay = holidayHours * hourlyBase * 1.33;
            } else {
                dailyHolidayPay = (2 * hourlyBase * 1.33) + (Math.min(holidayHours - 2, 6) * hourlyBase * 1.66);
                if (holidayHours > 8) {
                    dailyHolidayPay += (holidayHours - 8) * hourlyBase * 2.66; // æ¨¡æ“¬æ³•è¦8å°æ™‚å¾ŒåŠ æˆ
                }
            }
            const totalHolidayPay = dailyHolidayPay * holidayDays;

            // æ¯æœˆç¸½æ”¯å‡º
            const monthlyTotalCost = actualSalary + totalOTPay + totalHolidayPay + totalMonthlyFees;
            document.getElementById('displayTotalCost').innerText = Math.round(monthlyTotalCost).toLocaleString();
            document.getElementById('displayTotalOT').innerText = '$' + Math.round(totalOTPay + totalHolidayPay).toLocaleString();
            
            // å¹´åº¦ç¸½æ”¯å‡ºèˆ‡å¹´çµ‚
            const annualTotalCost = (monthlyTotalCost * 12) + bonusAmount;
            
            document.getElementById('displayAnnualCost').innerText = Math.round(annualTotalCost).toLocaleString();
            document.getElementById('displayYearEndAmount').innerText = '$' + Math.round(bonusAmount).toLocaleString();

            // å ±åƒ¹åŸºæº–æ™‚è–ª (å«å¹´çµ‚æ”¤æ)
            const totalHoursPerMonth = 176 + (otDays * otHours) + (holidayDays * holidayHours);
            const totalHoursPerYear = totalHoursPerMonth * 12;
            const trueHourlyRate = totalHoursPerYear > 0 ? annualTotalCost / totalHoursPerYear : 0;

            document.getElementById('displayHourlyRate').innerText = '$' + Math.round(trueHourlyRate);
            document.getElementById('displayTotalHours').innerText = totalHoursPerMonth + ' hr';

            const status = document.getElementById('statusIndicator');
            const alertBox = document.getElementById('alertBox');
            const alertTitle = document.getElementById('alertTitle');
            const alertDesc = document.getElementById('alertDesc');
            
            alertBox.classList.remove('hidden');
            const threshold = (currentStaffType === 'migrant') ? 220 : 215;

            if (trueHourlyRate <= threshold) {
                status.innerText = 'æˆæœ¬æ§åˆ¶ï¼šå„ªç•°';
                status.className = 'mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] text-center bg-emerald-500/20 text-emerald-400 ring-1 ring-emerald-500/50 shadow-emerald-500/20 shadow-lg';
                alertTitle.innerText = 'âœ… å¹´åº¦çµæ§‹ç²åˆ©';
                alertDesc.innerText = 'ä½¿ç”¨ 1.33/1.66 å€ç‡æ ¸ç®—å¾Œï¼Œå°æ™‚æˆæœ¬ç¬¦åˆé æœŸã€‚æ­¤é…ç½®èƒ½ç¢ºä¿å…¬å¸åœ¨æ”¯ä»˜å®Œæ‰€æœ‰çé‡‘å¾Œä»æœ‰åˆ©æ½¤ç©ºé–“ã€‚';
            } else if (trueHourlyRate <= threshold + 25) {
                status.innerText = 'æˆæœ¬æ§åˆ¶ï¼šé è­¦';
                status.className = 'mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] text-center bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/50 shadow-amber-500/20 shadow-lg';
                alertTitle.innerText = 'âš ï¸ å¹´çµ‚ä¾µè•é è­¦';
                alertDesc.innerText = 'æ™‚è–ªæˆæœ¬å·²æ˜é¡¯æ”€å‡ã€‚è«‹æ³¨æ„ï¼Œå¦‚æœç”¢é€Ÿä¸å¤ å¿«ï¼Œå¹´åº•ç™¼æ”¾é€™ç­†å¹´çµ‚æ™‚ï¼Œå¯¦éš›ä¸ŠæœƒèŠ±æ‰å‰ä¸‰å­£æ‰€æœ‰çš„åˆ©æ½¤ç´¯ç©ã€‚';
            } else {
                status.innerText = 'æˆæœ¬æ§åˆ¶ï¼šä½è½';
                status.className = 'text-center mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] bg-rose-500/20 text-rose-400 ring-1 ring-rose-500/50 shadow-rose-500/20 shadow-lg';
                alertTitle.innerText = 'âŒ ç¶“ç‡Ÿåš´é‡è™§æ';
                alertDesc.innerText = 'å¹´åº¦å°æ™‚æˆæœ¬ï¼ˆå«å¹´çµ‚ï¼‰åš´é‡è¶…æ¨™ï¼ç›®å‰çš„é…ç½®ä¸‹ï¼Œæ¯ç”¢å‡ºä¸€å°æ™‚éƒ½åœ¨è™§æã€‚å»ºè­°ç«‹å³æª¢è¨ç”¢ç·šé…ç½®èˆ‡çé‡‘é ç®—ã€‚';
            }
        }

        window.onload = function() {
            initInsuranceOptions();
            updateInsuranceCosts();
        };
    </script>
</body>
</html>
    </textarea>

    <!-- 5. è³‡æå…¬å¼ -->
    <textarea id="code-4" class="source-code">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å…·èˆ‡å¡‘è† è¢‹è‡ªå‹•è¨ˆç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto+Sans+TC', sans-serif;
            background-color: #f3f4f6;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">è£½é€ æ¥­è‡ªå‹•è¨ˆç®—å·¥å…·</h1>
            <p class="text-gray-600">æ ¹æ“šæ‚¨çš„ç­†è¨˜å…¬å¼è‡ªå‹•æ›ç®—é‡é‡ã€æ•¸é‡èˆ‡æˆæœ¬</p>
        </header>

        <!-- æ¨¡å…·é‡é‡è¨ˆç®— -->
        <section class="card">
            <div class="flex items-center mb-6 border-l-4 border-blue-500 pl-4">
                <h2 class="text-xl font-bold text-gray-800">1. æ¨¡å…·é‡é‡è¨ˆç®—</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">é•· (cm)</label>
                    <input type="number" id="mold_l" class="w-full border border-gray-300 rounded-lg p-3" placeholder="è¼¸å…¥é•·åº¦" oninput="calcMold()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">å¯¬ (cm)</label>
                    <input type="number" id="mold_w" class="w-full border border-gray-300 rounded-lg p-3" placeholder="è¼¸å…¥å¯¬åº¦" oninput="calcMold()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">é«˜ (cm)</label>
                    <input type="number" id="mold_h" class="w-full border border-gray-300 rounded-lg p-3" placeholder="è¼¸å…¥é«˜åº¦" oninput="calcMold()">
                </div>
            </div>
            
            <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                <div class="text-center md:text-left">
                    <span class="block text-blue-800 font-medium text-sm mb-1">é‡é‡çµæœ (å…¬æ–¤)ï¼š</span>
                    <span class="text-3xl font-bold text-blue-600"><span id="mold_res">0.000</span> <small class="text-lg font-normal text-blue-400">kg</small></span>
                </div>
                <div class="text-center md:text-right border-t md:border-t-0 md:border-l border-blue-200 pt-4 md:pt-0 md:pl-6">
                    <span class="block text-indigo-800 font-medium text-sm mb-1">æ›ç®—å™¸æ•¸ (å…¬å™¸)ï¼š</span>
                    <span class="text-3xl font-bold text-indigo-600"><span id="mold_tons_res">0.000</span> <small class="text-lg font-normal text-indigo-400">t</small></span>
                </div>
            </div>
            
            <p class="text-xs text-gray-400 mt-3 italic">* å…¬å¼ï¼šé•· Ã— å¯¬ Ã— é«˜ Ã— 0.0079 | 1 å…¬å™¸ (t) = 1000 å…¬æ–¤ (kg)</p>
        </section>

        <!-- å¡‘è† è¢‹è¨ˆç®— -->
        <section class="card">
            <div class="flex items-center mb-6 border-l-4 border-green-500 pl-4">
                <h2 class="text-xl font-bold text-gray-800">2. å¡‘è† è¢‹è¦æ ¼ã€æ•¸é‡èˆ‡æˆæœ¬è¨ˆç®—</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">åšåº¦</label>
                    <input type="number" id="bag_t" class="w-full border border-gray-300 rounded-lg p-3" placeholder="ä¾‹å¦‚: 0.03" oninput="calcBag()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">å¯¬åº¦ (cm)</label>
                    <input type="number" id="bag_w" class="w-full border border-gray-300 rounded-lg p-3" placeholder="ä¾‹å¦‚: 30" oninput="calcBag()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">é•·åº¦ (cm)</label>
                    <input type="number" id="bag_l" class="w-full border border-gray-300 rounded-lg p-3" placeholder="ä¾‹å¦‚: 70" oninput="calcBag()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ä¸€åŒ…ç¸½é‡é‡ (kg)</label>
                    <input type="number" id="bag_total_w" class="w-full border border-gray-300 rounded-lg p-3" placeholder="ä¾‹å¦‚: 25.5" oninput="calcBag()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 text-red-600 font-bold">æ¯å…¬æ–¤åƒ¹æ ¼ (å…ƒ/kg)</label>
                    <input type="number" id="bag_price_kg" class="w-full border border-red-200 bg-red-50 rounded-lg p-3" placeholder="ä¾‹å¦‚: 80" oninput="calcBag()">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-green-50 p-4 rounded-xl border border-green-100 flex flex-col items-center">
                    <span class="text-green-800 font-medium text-sm">å–®å€‹é‡é‡ (kg)</span>
                    <span class="text-2xl font-bold text-green-600"><span id="bag_single_res">0.00000</span></span>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border border-red-100 flex flex-col items-center">
                    <span class="text-red-800 font-medium text-sm">å–®å€‹æˆæœ¬ (å…ƒ)</span>
                    <span class="text-2xl font-bold text-red-600"><small class="text-lg">$</small><span id="bag_cost_res">0.00</span></span>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 flex flex-col items-center">
                    <span class="text-orange-800 font-medium text-sm">é ä¼°ç¸½æ•¸é‡ (pcs)</span>
                    <span class="text-2xl font-bold text-orange-600"><span id="bag_qty_res">0</span></span>
                </div>
            </div>
            <div class="text-xs text-gray-400 mt-4 space-y-1">
                <p>* å–®é‡å…¬å¼ï¼šåšåº¦ Ã— å¯¬ Ã— é•· Ã— 0.19 Ã· 1000</p>
                <p>* å–®å€‹æˆæœ¬ï¼šå–®é‡ Ã— æ¯å…¬æ–¤åƒ¹æ ¼</p>
                <p>* æ•¸é‡å…¬å¼ï¼šç¸½é‡é‡ Ã· å››æ¨äº”å…¥å¾Œçš„å–®é‡ (ä¾ç­†è¨˜ç¯„ä¾‹)</p>
            </div>
        </section>

        <footer class="text-center text-gray-400 text-sm mt-8">
            &copy; æ¨¡å…·èˆ‡åŒ…æå¿«é€Ÿè¨ˆç®—ç³»çµ±
        </footer>
    </div>

    <script>
        function calcMold() {
            const l = parseFloat(document.getElementById('mold_l').value) || 0;
            const w = parseFloat(document.getElementById('mold_w').value) || 0;
            const h = parseFloat(document.getElementById('mold_h').value) || 0;
            const kg = l * w * h * 0.0079;
            const tons = kg / 1000;
            
            document.getElementById('mold_res').innerText = kg.toLocaleString(undefined, { minimumFractionDigits: 3, maximumFractionDigits: 3 });
            document.getElementById('mold_tons_res').innerText = tons.toLocaleString(undefined, { minimumFractionDigits: 3, maximumFractionDigits: 5 });
        }

        function calcBag() {
            const t = parseFloat(document.getElementById('bag_t').value) || 0;
            const w = parseFloat(document.getElementById('bag_w').value) || 0;
            const l = parseFloat(document.getElementById('bag_l').value) || 0;
            const totalW = parseFloat(document.getElementById('bag_total_w').value) || 0;
            const priceKg = parseFloat(document.getElementById('bag_price_kg').value) || 0;

            // 1. å–®å€‹é‡é‡åŸå§‹å€¼ (kg)
            const singleWRaw = (t * w * l * 0.19) / 1000;
            document.getElementById('bag_single_res').innerText = singleWRaw.toFixed(5);

            // 2. è¨ˆç®—å–®å€‹æˆæœ¬
            const costPerBag = singleWRaw * priceKg;
            document.getElementById('bag_cost_res').innerText = costPerBag.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 4 });

            // 3. æ¨¡æ“¬ç­†è¨˜æœ¬çš„å››æ¨äº”å…¥è¨ˆç®—æ•¸é‡
            if (singleWRaw > 0 && totalW > 0) {
                // ç­†è¨˜ç¯„ä¾‹ï¼š0.01197 -> å– 0.012 å†ç›¸é™¤
                const roundedSingleW = parseFloat(singleWRaw.toFixed(3)); 
                const qty = Math.floor(totalW / roundedSingleW);
                document.getElementById('bag_qty_res').innerText = qty.toLocaleString();
            } else {
                document.getElementById('bag_qty_res').innerText = "0";
            }
        }
    </script>
</body>
</html>
    </textarea>

    <!-- ä¸»æ§è…³æœ¬ -->
    <script>
        function init() {
            const container = document.getElementById('main-container');
            const totalTabs = 5;

            // éæ­· 5 å€‹å€å¡Š
            for (let i = 0; i < totalTabs; i++) {
                // å‰µå»º iframe
                const iframe = document.createElement('iframe');
                iframe.id = 'frame-' + i;
                
                // é è¨­æ¿€æ´»ç¬¬ä¸€å€‹ tab
                if (i === 0) iframe.classList.add('active');
                
                container.appendChild(iframe);
                
                // ç²å–åŸå§‹ HTML å…§å®¹
                const rawContent = document.getElementById('code-' + i).value;
                
                // æ³¨å…¥å…§å®¹åˆ° Iframe
                const doc = iframe.contentWindow.document;
                doc.open();
                doc.write(rawContent);
                doc.close();
            }
        }

        function switchTab(index) {
            // åˆ‡æ›å°èˆªæ¨£å¼
            document.querySelectorAll('.nav-item').forEach((t, i) => {
                if (i === index) {
                    t.classList.add('active');
                } else {
                    t.classList.remove('active');
                }
            });

            // åˆ‡æ› Iframe é¡¯ç¤º
            document.querySelectorAll('iframe').forEach((f, i) => {
                if (i === index) {
                    f.classList.add('active');
                } else {
                    f.classList.remove('active');
                }
            });
        }

        // å•Ÿå‹•åˆå§‹åŒ–
        init();
    </script>

</body>
</html>