<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>瑞全企業綜合決策系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Dependencies (For View 4) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Vue.js 3 (For View 5) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- FontAwesome (For View 5) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* === Styles from digitaltools.html === */
        body { 
            font-family: 'Noto Sans TC', 'Inter', sans-serif; 
            background-color: #f1f5f9; 
            padding-bottom: 90px; /* Space for bottom nav */
            overscroll-behavior-y: none; /* Prevent pull-to-refresh on mobile */
        }

        /* Combined Styles */
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .tab-active { background-color: #2563eb; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Form Element Fixes */
        select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1.2rem; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Shared Card Styles */
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Navigation Styles */
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            font-size: 10px; /* Adjusted size for 5 buttons */
            font-weight: 700;
            padding: 8px 0;
            transition: all 0.2s;
            border-top: 3px solid transparent;
        }
        .nav-btn.active {
            color: #2563eb;
            border-top-color: #2563eb;
            background: linear-gradient(to bottom, #eff6ff, transparent);
        }
        .nav-btn svg, .nav-btn i {
            margin-bottom: 4px;
            transition: all 0.2s;
            font-size: 18px;
        }
        .nav-btn.active svg, .nav-btn.active i {
            transform: translateY(-2px);
            filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.3));
        }

        /* Visibility Control */
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Input Focus Ring Fix & Mobile Friendly */
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        /* Specific Styles from original files */
        .production-input {
            width: 100%; 
            padding: 1rem 0.5rem; 
            border: 2px solid #cbd5e1; 
            border-radius: 10px; 
            font-size: 1.25rem; 
            font-weight: 700; 
            color: #1e293b; 
            text-align: center;
        }
        .production-input:focus { border-color: #3b82f6; outline: none; background-color: #eff6ff; }

        /* === Styles from 機台產能評估.html === */
        /* 針對觸控優化的輸入框樣式 */
        .touch-input {
            font-size: 1.125rem; /* text-lg */
            padding: 0.75rem;     /* p-3 */
            height: 3rem;         /* h-12 */
        }

        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem; /* 加大點擊區域 */
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: #fff;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            font-size: 1rem; /* 防止 iOS 自動縮放 */
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px; /* 加粗滑桿 */
            background: #e5e7eb;
            border-radius: 5px;
            outline: none;
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px; /* 加大滑塊 */
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Table styles optimized for space */
        .product-table th { 
            font-size: 0.875rem; 
            font-weight: 700;
            color: #374151; 
            background-color: #f3f4f6; 
            padding: 1rem; 
            text-align: left; 
            white-space: nowrap;
        }
        .product-table td { 
            padding: 0.75rem; 
            border-bottom: 1px solid #e5e7eb; 
            vertical-align: middle; 
        }
        .product-table tr:last-child td { border-bottom: none; }
    </style>
</head>
<body>

    <!-- ================= VIEW 1: 人力成本計算 ================= -->
    <div id="view-1" class="view-section active p-4 md:p-10 text-slate-800">
        <div class="max-w-6xl mx-auto">
            <!-- Header Section -->
            <header class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div>
                    <h1 class="text-3xl font-black text-slate-900 tracking-tight italic">2026 瑞全人力成本模擬器</h1>
                    <p class="text-blue-600 font-medium mt-1">二代接班專用：含自訂年終之「真實小時成本」精算</p>
                </div>
                <!-- Staff Type Switcher -->
                <div class="inline-flex p-1.5 bg-slate-200 rounded-2xl shadow-inner w-full md:w-auto">
                    <button id="btnMigrant" onclick="setStaffType('migrant')" class="flex-1 md:px-8 py-3 rounded-xl text-sm font-bold transition-all duration-200 tab-active">外籍移工</button>
                    <button id="btnLocal" onclick="setStaffType('local')" class="flex-1 md:px-8 py-3 rounded-xl text-sm font-bold transition-all duration-200 text-slate-500">本籍勞工</button>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Left Side: Inputs -->
                <div class="lg:col-span-7 space-y-6">
                    
                    <!-- 1. 薪資與獎金設定 -->
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-2 h-full bg-blue-600"></div>
                        <h2 class="text-lg font-bold mb-6 flex items-center text-slate-700">
                            <span class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mr-3 text-sm italic font-black">01</span>
                            薪資與年終設定
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase mb-2 tracking-widest">每月實發薪資 (加班基準)</label>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                                    <input type="number" inputmode="decimal" id="actualSalary" value="29500" oninput="calculateAll()" class="w-full pl-10 pr-4 py-4 bg-slate-50 border-2 border-transparent rounded-2xl text-2xl font-black text-slate-900 focus:bg-white focus:border-blue-500 transition-all outline-none">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase mb-2 tracking-widest text-orange-600">年終獎金 (直接填入金額)</label>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-orange-400 font-bold">$</span>
                                    <input type="number" inputmode="decimal" id="bonusAmount" value="29500" oninput="calculateAll()" class="w-full pl-10 pr-4 py-4 bg-orange-50/30 border-2 border-orange-100 rounded-2xl text-2xl font-black text-orange-600 focus:bg-white focus:border-orange-500 transition-all outline-none">
                                </div>
                                <p class="text-[10px] text-orange-400 mt-2 italic">※ 此金額將攤提到年度時薪中</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-xs font-black text-slate-400 uppercase mb-2 tracking-widest">投保級距 (影響法定規費)</label>
                                <select id="insuranceGrade" onchange="updateInsuranceCosts()" class="w-full p-4 bg-slate-50 border-2 border-transparent rounded-2xl text-lg font-bold text-slate-700 focus:bg-white focus:border-blue-500 transition-all outline-none cursor-pointer shadow-inner">
                                    <!-- JS Populated -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 企業負擔明細 -->
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                        <h2 class="text-lg font-bold mb-6 flex items-center text-slate-700">
                            <span class="w-8 h-8 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center mr-3 text-sm italic font-black">02</span>
                            企業法定負擔 (每月)
                        </h2>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-slate-600 text-sm">
                            <div class="p-5 rounded-2xl bg-slate-50 border border-slate-100 shadow-sm">
                                <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">勞保費 (雇主)</label>
                                <p class="text-[10px] font-bold text-blue-500 mb-2" id="displayLaborRate">~8.05%</p>
                                <div class="flex items-baseline font-black">
                                    <span class="text-xs text-slate-400 mr-1">$</span>
                                    <input type="number" inputmode="decimal" id="feeLabor" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none text-slate-700">
                                </div>
                            </div>
                            <div class="p-5 rounded-2xl bg-slate-50 border border-slate-100 shadow-sm">
                                <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">健保費 (雇主)</label>
                                <p class="text-[10px] font-bold text-slate-400 mb-2">~4.84%</p>
                                <div class="flex items-baseline font-black">
                                    <span class="text-xs text-slate-400 mr-1">$</span>
                                    <input type="number" inputmode="decimal" id="feeHealth" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none text-slate-700">
                                </div>
                            </div>
                            <div id="pensionContainer" class="p-5 rounded-2xl border transition-all duration-300">
                                <label class="block text-[10px] font-black uppercase mb-1" id="pensionLabel">勞退金 (6%)</label>
                                <p class="text-[10px] font-bold mb-2" id="pensionDesc">僅本籍適用</p>
                                <div class="flex items-baseline font-black">
                                    <span class="text-xs mr-1 opacity-50">$</span>
                                    <input type="number" inputmode="decimal" id="feePension" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none">
                                </div>
                            </div>
                            <div id="stabilityContainer" class="p-5 rounded-2xl border transition-all duration-300 shadow-sm">
                                <label class="block text-[10px] font-black uppercase mb-1" id="stabilityLabel">就業安定費</label>
                                <p class="text-[10px] font-bold mb-2" id="stabilityDesc">外勞專用</p>
                                <div class="flex items-baseline font-black">
                                    <span class="text-xs mr-1 opacity-50">$</span>
                                    <input type="number" inputmode="decimal" id="feeStability" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none text-slate-700">
                                </div>
                            </div>
                            <div class="p-5 rounded-2xl bg-blue-50/50 border border-blue-100 shadow-sm">
                                <label class="block text-[10px] font-black text-blue-600 uppercase mb-1 font-black">職災保險 (動態)</label>
                                <p class="text-[10px] font-bold text-blue-400 mb-2">費率 ~0.24%</p>
                                <div class="flex items-baseline font-black text-blue-700">
                                    <span class="text-xs mr-1 opacity-50">$</span>
                                    <input type="number" inputmode="decimal" id="feeAccident" oninput="calculateAll()" class="w-full font-black text-xl bg-transparent outline-none">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. 加班設定 -->
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                        <h2 class="text-lg font-bold mb-6 flex items-center text-slate-700">
                            <span class="w-8 h-8 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center mr-3 text-sm italic font-black">03</span>
                            出勤與加班配置 (瑞全公式: 1.33 / 1.66)
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-orange-50/50 p-6 rounded-2xl border border-orange-100 shadow-sm">
                                <label class="block text-xs font-black text-orange-600 uppercase mb-4 tracking-widest">平日加班 (月基準 22天)</label>
                                <div class="flex items-center space-x-4">
                                    <div class="flex-1">
                                        <span class="text-[10px] text-orange-400 font-bold uppercase">天數</span>
                                        <input type="number" inputmode="decimal" id="otDays" value="22" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-orange-200 font-bold outline-none text-center">
                                    </div>
                                    <div class="flex-1">
                                        <span class="text-[10px] text-orange-400 font-bold uppercase">每日小時</span>
                                        <input type="number" inputmode="decimal" id="otHours" value="1" step="0.5" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-orange-200 font-bold outline-none text-center">
                                    </div>
                                </div>
                            </div>
                            <div class="bg-red-50/50 p-6 rounded-2xl border border-red-100 shadow-sm">
                                <label class="block text-xs font-black text-red-600 uppercase mb-4 tracking-widest">假日加班 (8小時/日)</label>
                                <div class="flex items-center space-x-4">
                                    <div class="flex-1">
                                        <span class="text-[10px] text-red-400 font-bold uppercase">天數</span>
                                        <input type="number" inputmode="decimal" id="holidayDays" value="0" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-red-200 font-bold outline-none text-center">
                                    </div>
                                    <div class="flex-1">
                                        <span class="text-[10px] text-red-400 font-bold uppercase">時數</span>
                                        <input type="number" inputmode="decimal" id="holidayHours" value="8" oninput="calculateAll()" class="w-full bg-white p-3 rounded-xl border border-red-200 font-bold outline-none text-center">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Result Dashboard -->
                <div class="lg:col-span-5 space-y-6">
                    <!-- Annual Dashboard -->
                    <div class="bg-blue-600 rounded-[2.5rem] p-10 text-white shadow-2xl relative overflow-hidden group">
                        <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl transition-all duration-700"></div>
                        <div class="relative z-10 text-center">
                            <p class="text-blue-100 text-[10px] font-black uppercase tracking-[0.4em] mb-4 underline decoration-blue-400 underline-offset-4">Annual Enterprise Total (一整年)</p>
                            <div class="flex items-baseline justify-center">
                                <span class="text-2xl font-bold text-blue-200 mr-2">$</span>
                                <div class="text-6xl font-black tracking-tighter" id="displayAnnualCost">0</div>
                            </div>
                            <div class="mt-6 flex justify-between items-center text-xs text-blue-100 bg-white/10 p-4 rounded-2xl border border-white/20">
                                 <span class="font-bold uppercase tracking-widest">年終獎金總額：</span>
                                 <span class="font-black text-2xl text-white" id="displayYearEndAmount">$0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Dashboard -->
                    <div class="bg-slate-900 rounded-[2.5rem] p-10 text-white shadow-2xl sticky top-10 border border-slate-800 overflow-hidden relative">
                        <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-600/10 rounded-full blur-3xl"></div>
                        
                        <div class="relative z-10">
                            <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.4em] mb-4 tracking-[0.2em]">Management Decision Board</p>
                            <div class="flex items-baseline mb-8">
                                <span class="text-3xl font-bold text-slate-600 mr-2">$</span>
                                <div class="text-5xl font-black tracking-tighter" id="displayTotalCost">0</div>
                            </div>

                            <div class="grid grid-cols-1 gap-6 mb-8 pt-8 border-t border-slate-800">
                                <!-- 真實報價基準 -->
                                <div class="flex items-center justify-between text-blue-400 group">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 rounded-full bg-blue-500 mr-3 animate-pulse"></div>
                                        <span class="text-sm font-black">報價基準時薪 (含年終)</span>
                                    </div>
                                    <span class="text-3xl font-black" id="displayHourlyRate">$0</span>
                                </div>
                                
                                <!-- 加班計算基準 -->
                                <div class="flex items-center justify-between text-slate-400 border-t border-slate-800/50 pt-4">
                                    <div class="flex flex-col">
                                        <span class="text-[10px] font-black uppercase tracking-widest uppercase">加班費核算基準 (1.0x)</span>
                                        <span class="text-[9px] text-slate-500 font-bold italic">※ 瑞全公式: 薪資 ÷ 240</span>
                                    </div>
                                    <span class="text-xl font-bold text-slate-300" id="displayHourlyBaseText">$0.0</span>
                                </div>

                                <div class="flex items-center justify-between text-slate-400">
                                    <span class="text-[10px] font-black uppercase tracking-widest uppercase">每月總投入工時</span>
                                    <span class="text-xl font-bold text-slate-300" id="displayTotalHours">0 hr</span>
                                </div>
                            </div>

                            <div class="space-y-4 text-slate-300">
                                <div class="bg-white/5 p-5 rounded-[1.5rem] border border-white/10 flex justify-between items-center transition-all hover:bg-white/10">
                                    <span class="text-orange-400 text-[10px] font-black tracking-widest uppercase">每月加班費</span>
                                    <span class="text-xl font-black text-orange-500" id="displayTotalOT">$0</span>
                                </div>
                                <div class="bg-white/5 p-5 rounded-[1.5rem] border border-white/10 flex justify-between items-center transition-all hover:bg-white/10">
                                    <span class="text-blue-400 text-[10px] font-black tracking-widest uppercase">每月規費總計</span>
                                    <span class="text-xl font-black text-blue-500" id="displayTotalFees">$0</span>
                                </div>
                            </div>

                            <div id="statusIndicator" class="mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] text-center shadow-inner transition-all duration-500 bg-slate-800 border border-slate-700">
                                瑞全營運決策動態分析
                            </div>
                        </div>
                    </div>

                    <!-- Alert Box -->
                    <div id="alertBox" class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm hidden transition-all duration-300 shadow-xl shadow-slate-100">
                        <div class="flex items-center mb-4">
                            <div class="w-1.5 h-6 bg-blue-600 rounded-full mr-3"></div>
                            <h4 class="font-black text-slate-800 text-sm italic" id="alertTitle">顧問經營建議</h4>
                        </div>
                        <p class="text-xs text-slate-500 leading-relaxed font-bold italic" id="alertDesc"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= VIEW 2: 資材公式 ================= -->
    <div id="view-2" class="view-section p-4 md:p-8">
        <div class="max-w-4xl mx-auto">
            <header class="text-center mb-10">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">製造業自動計算工具</h1>
                <p class="text-gray-600">根據您的筆記公式自動換算重量、數量與成本</p>
            </header>

            <!-- 模具重量計算 -->
            <section class="card p-8 mb-8">
                <div class="flex items-center mb-6 border-l-4 border-blue-500 pl-4">
                    <h2 class="text-xl font-bold text-gray-800">1. 模具重量計算</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">長 (cm)</label>
                        <input type="number" inputmode="decimal" id="mold_l" class="w-full border border-gray-300 rounded-lg p-3" placeholder="輸入長度" oninput="calcMold()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">寬 (cm)</label>
                        <input type="number" inputmode="decimal" id="mold_w" class="w-full border border-gray-300 rounded-lg p-3" placeholder="輸入寬度" oninput="calcMold()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">高 (cm)</label>
                        <input type="number" inputmode="decimal" id="mold_h" class="w-full border border-gray-300 rounded-lg p-3" placeholder="輸入高度" oninput="calcMold()">
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                    <div class="text-center md:text-left">
                        <span class="block text-blue-800 font-medium text-sm mb-1">重量結果 (公斤)：</span>
                        <span class="text-3xl font-bold text-blue-600"><span id="mold_res">0.000</span> <small class="text-lg font-normal text-blue-400">kg</small></span>
                    </div>
                    <div class="text-center md:text-right border-t md:border-t-0 md:border-l border-blue-200 pt-4 md:pt-0 md:pl-6">
                        <span class="block text-indigo-800 font-medium text-sm mb-1">換算噸數 (公噸)：</span>
                        <span class="text-3xl font-bold text-indigo-600"><span id="mold_tons_res">0.000</span> <small class="text-lg font-normal text-indigo-400">t</small></span>
                    </div>
                </div>
                
                <p class="text-xs text-gray-400 mt-3 italic">* 公式：長 × 寬 × 高 × 0.0079 | 1 公噸 (t) = 1000 公斤 (kg)</p>
            </section>

            <!-- 塑膠袋計算 -->
            <section class="card p-8 mb-8">
                <div class="flex items-center mb-6 border-l-4 border-green-500 pl-4">
                    <h2 class="text-xl font-bold text-gray-800">2. 塑膠袋規格、數量與成本計算</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">厚度</label>
                        <input type="number" inputmode="decimal" id="bag_t" class="w-full border border-gray-300 rounded-lg p-3" placeholder="例如: 0.03" oninput="calcBag()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">寬度 (cm)</label>
                        <input type="number" inputmode="decimal" id="bag_w" class="w-full border border-gray-300 rounded-lg p-3" placeholder="例如: 30" oninput="calcBag()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">長度 (cm)</label>
                        <input type="number" inputmode="decimal" id="bag_l" class="w-full border border-gray-300 rounded-lg p-3" placeholder="例如: 70" oninput="calcBag()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">一包總重量 (kg)</label>
                        <input type="number" inputmode="decimal" id="bag_total_w" class="w-full border border-gray-300 rounded-lg p-3" placeholder="例如: 25.5" oninput="calcBag()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 text-red-600 font-bold">每公斤價格 (元/kg)</label>
                        <input type="number" inputmode="decimal" id="bag_price_kg" class="w-full border border-red-200 bg-red-50 rounded-lg p-3" placeholder="例如: 80" oninput="calcBag()">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100 flex flex-col items-center">
                        <span class="text-green-800 font-medium text-sm">單個重量 (kg)</span>
                        <span class="text-2xl font-bold text-green-600"><span id="bag_single_res">0.00000</span></span>
                    </div>
                    <div class="bg-red-50 p-4 rounded-xl border border-red-100 flex flex-col items-center">
                        <span class="text-red-800 font-medium text-sm">單個成本 (元)</span>
                        <span class="text-2xl font-bold text-red-600"><small class="text-lg">$</small><span id="bag_cost_res">0.00</span></span>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 flex flex-col items-center">
                        <span class="text-orange-800 font-medium text-sm">預估總數量 (pcs)</span>
                        <span class="text-2xl font-bold text-orange-600"><span id="bag_qty_res">0</span></span>
                    </div>
                </div>
                <div class="text-xs text-gray-400 mt-4 space-y-1">
                    <p>* 單重公式：厚度 × 寬 × 長 × 0.19 ÷ 1000</p>
                    <p>* 單個成本：單重 × 每公斤價格</p>
                    <p>* 數量公式：總重量 ÷ 四捨五入後的單重 (依筆記範例)</p>
                </div>
            </section>

            <footer class="text-center text-gray-400 text-sm mt-8">
                &copy; 模具與包材快速計算系統
            </footer>
        </div>
    </div>

    <!-- ================= VIEW 3: 生產預估 ================= -->
    <div id="view-3" class="view-section p-4 md:p-8">
        <div class="max-w-xl mx-auto">
            <!-- Header -->
            <div class="mb-6 text-center">
                <h1 class="text-2xl font-black text-slate-800 tracking-tight">生產進度快算 - 大字版</h1>
                <p class="text-sm text-slate-500 font-bold">瑞全企業智慧幕僚工具</p>
            </div>

            <!-- 1. 基本參數 -->
            <div class="card p-5 mb-5 border-l-8 border-slate-800">
                <h2 class="text-sm font-black text-slate-400 uppercase mb-3">機台與模具設定</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-extrabold text-slate-700 mb-2">模次秒數 (CT)</label>
                        <input type="number" inputmode="decimal" id="cycleTime" value="60" step="0.1" class="production-input">
                    </div>
                    <div>
                        <label class="block text-sm font-extrabold text-slate-700 mb-2">每模穴數 (Cav)</label>
                        <input type="number" inputmode="decimal" id="cavities" value="1" class="production-input">
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-extrabold text-slate-700 mb-2">扣除休息/停機 (分鐘)</label>
                    <input type="number" inputmode="decimal" id="breakMinutes" value="60" class="production-input">
                </div>
            </div>

            <!-- 2. 功能切換 -->
            <div class="flex bg-slate-200 rounded-t-xl overflow-hidden">
                <button id="tabA" onclick="switchMode('A')" class="flex-1 p-4 font-extrabold border-b-4 border-blue-500 text-blue-600 bg-white transition-all">功能 A: 算產量</button>
                <button id="tabB" onclick="switchMode('B')" class="flex-1 p-4 font-extrabold border-b-4 border-transparent transition-all">功能 B: 算交期</button>
            </div>

            <!-- 3. 輸入區域 -->
            <div class="card p-6 rounded-t-none mb-6 rounded-b-xl">
                
                <!-- 通用：開始時間輸入 -->
                <div class="mb-6 pb-6 border-b border-dashed border-slate-200">
                    <div class="flex justify-between items-center mb-2">
                        <label class="!mb-0 font-extrabold text-slate-700">【開始生產時間】</label>
                        <button onclick="setNow()" class="bg-blue-100 text-blue-700 px-3 py-1.5 rounded-lg text-sm font-extrabold">填入現在</button>
                    </div>
                    <div class="grid grid-cols-12 gap-2">
                        <div class="col-span-6">
                            <label class="text-[10px] text-slate-400">日期</label>
                            <input type="date" id="startDate" class="production-input !text-base">
                        </div>
                        <div class="col-span-3">
                            <label class="text-[10px] text-slate-400">時</label>
                            <select id="startH" class="production-input !text-base"></select>
                        </div>
                        <div class="col-span-3">
                            <label class="text-[10px] text-slate-400">分</label>
                            <select id="startM" class="production-input !text-base"></select>
                        </div>
                    </div>
                </div>

                <!-- Panel A: 算產量 -->
                <div id="panelA" class="space-y-4">
                    <label class="font-extrabold text-slate-700">【預計結束時間】</label>
                    <div class="grid grid-cols-12 gap-2">
                        <div class="col-span-6">
                            <label class="text-[10px] text-slate-400">日期</label>
                            <input type="date" id="endDate" class="production-input !text-base">
                        </div>
                        <div class="col-span-3">
                            <label class="text-[10px] text-slate-400">時</label>
                            <select id="endH" class="production-input !text-base"></select>
                        </div>
                        <div class="col-span-3">
                            <label class="text-[10px] text-slate-400">分</label>
                            <select id="endM" class="production-input !text-base"></select>
                        </div>
                    </div>
                    <button onclick="calculateA()" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black text-xl shadow-xl shadow-blue-200 active:scale-95 transition mt-4">計算預估產量</button>
                </div>

                <!-- Panel B: 算交期 -->
                <div id="panelB" class="hidden space-y-4">
                    <label class="font-extrabold text-slate-700">【目標生產數量】</label>
                    <input type="number" inputmode="decimal" id="targetQty" value="160" class="w-full p-4 border-2 border-emerald-200 rounded-xl text-3xl font-bold text-center text-emerald-700 outline-none focus:bg-emerald-50 focus:border-emerald-400">
                    <p class="text-xs text-slate-400 font-bold text-center">※ 以 753D 專案為例，基本日需求為 160 PCS</p>
                    <button onclick="calculateB()" class="w-full bg-emerald-600 text-white py-5 rounded-2xl font-black text-xl shadow-xl shadow-emerald-200 active:scale-95 transition">推算完工交期</button>
                </div>
            </div>

            <!-- 4. 結果儀表板 -->
            <div id="resultArea" class="hidden space-y-4 animate-in fade-in duration-500">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-blue-50 border border-blue-200 p-4 rounded-xl text-center">
                        <span class="text-xs font-black text-blue-500 uppercase">預估總產出</span>
                        <div class="text-3xl font-black text-blue-700" id="resQty">0</div>
                        <span class="text-xs font-bold text-blue-400">PCS</span>
                    </div>
                    <div class="bg-emerald-50 border border-emerald-200 p-4 rounded-xl text-center">
                        <span class="text-xs font-black text-emerald-500 uppercase">預計完工時間</span>
                        <div class="text-xl font-black text-emerald-700 mt-1" id="resTime">--:--</div>
                        <div class="text-[10px] font-bold text-emerald-400" id="resDate">--</div>
                    </div>
                    <div class="bg-slate-50 border border-slate-200 p-4 rounded-xl text-center">
                        <span class="text-xs font-black text-slate-500 uppercase">總投入工時</span>
                        <div class="text-2xl font-black text-slate-700" id="resTotalDur">0</div>
                        <span class="text-xs font-bold text-slate-400">小時</span>
                    </div>
                    <div class="bg-amber-50 border border-amber-200 p-4 rounded-xl text-center">
                        <span class="text-xs font-black text-amber-500 uppercase">純生產時數</span>
                        <div class="text-2xl font-black text-amber-700" id="resEffDur">0</div>
                        <span class="text-xs font-bold text-amber-400">小時</span>
                    </div>
                </div>

                <div class="card p-4 border-l-8 border-amber-500 bg-amber-50">
                    <p class="text-sm font-bold text-amber-900 leading-relaxed" id="resNote"></p>
                </div>
            </div>

            <p class="text-[10px] text-center text-slate-400 my-8 font-bold">瑞全企業專屬數位工具 · 數據驅動決策</p>
        </div>
    </div>

    <!-- ================= VIEW 4: 報價單計算 (React) ================= -->
    <div id="view-4" class="view-section">
        <div id="react-root"></div>
    </div>

    <!-- ================= VIEW 5: 機台產能評估 (Vue) ================= -->
    <div id="view-5" class="view-section bg-gray-100 text-gray-800 pb-10">
        <!-- Vue App Root from File 2 -->
        <div id="app" class="min-h-screen flex flex-col">
            
            <!-- Header -->
            <header class="bg-slate-800 text-white shadow-lg sticky top-0 z-40">
                <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-server text-2xl text-teal-400"></i>
                        <div>
                            <h1 class="text-lg font-bold tracking-wide">瑞全企業 | 單一射出機模擬</h1>
                            <p class="text-xs text-slate-400 hidden md:block">單機產能負荷分析 (Single Machine Loading)</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs md:text-sm bg-slate-700 px-3 py-1 rounded-full"><i class="fa-solid fa-cogs text-teal-300"></i> {{ scenarioText }}</p>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-grow container mx-auto px-2 md:px-4 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <!-- Left Panel: Settings & Products -->
                <div class="lg:col-span-5 space-y-6">
                    
                    <!-- Section 1: Machine & Shift Settings -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <h2 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2 flex justify-between items-center">
                            <span><i class="fa-solid fa-industry mr-2 text-teal-600"></i>工廠體制設定</span>
                        </h2>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="input-group">
                                <label>班別體制</label>
                                <select v-model.number="global.shifts">
                                    <option :value="1">單班制 (8H)</option>
                                    <option :value="2">兩班制 (16H)</option>
                                    <option :value="3" class="text-red-500">三班制 (24H)</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>工作天數 (不含假日)</label>
                                <input type="number" inputmode="decimal" v-model.number="global.workingDays" min="15" max="31">
                            </div>
                        </div>

                        <!-- Batch & Mold Change Settings -->
                        <div class="grid grid-cols-2 gap-4 mb-4 bg-orange-50 p-4 rounded-lg border border-orange-100">
                            <div class="input-group">
                                <label class="text-orange-900">生產批量 (PCS)</label>
                                <input type="number" inputmode="decimal" v-model.number="global.batchSize" step="100" class="border-orange-300 focus:border-orange-500 font-bold text-orange-800">
                            </div>
                            <div class="input-group">
                                <label class="text-orange-900">換模時間 (分)</label>
                                <input type="number" inputmode="decimal" v-model.number="global.moldChangeMins" step="1" class="border-orange-300 focus:border-orange-500 font-bold text-orange-800">
                            </div>
                        </div>

                        <div class="mb-4 pt-2">
                            <label class="text-sm font-bold text-gray-700 mb-2 block">全廠平均不良率 (Defect Rate)</label>
                            <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-lg border">
                                <input type="range" v-model.number="global.defectRate" min="0" max="10" step="0.1" class="slider-thumb flex-grow">
                                <span class="w-20 text-center font-bold text-teal-600 text-lg bg-white py-1 rounded border">{{ global.defectRate }}%</span>
                            </div>
                        </div>

                        <!-- Overtime & Extra Days -->
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 space-y-4">
                            <h3 class="text-blue-900 font-bold text-base border-b border-blue-200 pb-2 mb-2">
                                <i class="fa-solid fa-business-time mr-1"></i> 產能擴充應變
                            </h3>
                            
                            <!-- Daily Overtime Slider -->
                            <div>
                                <div class="flex justify-between mb-2">
                                    <label class="text-sm font-bold text-blue-800">1. 每日延長工時</label>
                                    <span class="text-sm font-bold text-white bg-blue-600 px-3 py-1 rounded-full shadow-sm">+ {{ global.overtime }} H</span>
                                </div>
                                <input type="range" v-model.number="global.overtime" min="0" max="4" step="0.5" class="slider-thumb w-full">
                                <div class="flex justify-between text-xs text-blue-400 mt-1 font-mono">
                                    <span>0H</span>
                                    <span>2H</span>
                                    <span>4H</span>
                                </div>
                            </div>

                            <!-- Extra Days Slider -->
                            <div class="pt-2">
                                <div class="flex justify-between mb-2">
                                    <label class="text-sm font-bold text-blue-800">2. 假日加班天數</label>
                                    <span class="text-sm font-bold text-white bg-indigo-500 px-3 py-1 rounded-full shadow-sm">+ {{ global.extraWorkDays }} 天</span>
                                </div>
                                <input type="range" v-model.number="global.extraWorkDays" min="0" max="8" step="1" class="slider-thumb w-full">
                                <div class="flex justify-between text-xs text-blue-400 mt-1 font-mono">
                                    <span>0天</span>
                                    <span>4天</span>
                                    <span>8天</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2: Product Mix (Enlarged & Widened) -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden">
                        <div class="p-5 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                            <h2 class="text-xl font-bold text-slate-800"><i class="fa-solid fa-list-check mr-2 text-teal-600"></i>生產排程清單</h2>
                            <button @click="addProduct" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg shadow-md transition flex items-center gap-2 font-bold active:scale-95">
                                <i class="fa-solid fa-plus"></i> 新增產品
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <!-- Added min-w-[700px] to force horizontal scroll instead of squeezing -->
                            <table class="w-full product-table min-w-[700px]">
                                <thead>
                                    <tr>
                                        <th class="w-12 text-center">#</th>
                                        <th class="min-w-[160px]">產品名稱</th>
                                        <th class="w-32 text-right">月需求(PCS)</th>
                                        <th class="w-20 text-center text-xs text-gray-500">換模</th>
                                        <th class="w-28 text-right">週期(秒)</th>
                                        <th class="w-16"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(prod, index) in products" :key="index" class="group hover:bg-teal-50 transition-colors duration-150">
                                        <td class="text-center text-gray-400 font-bold text-lg">{{ index + 1 }}</td>
                                        <td>
                                            <input type="text" v-model="prod.name" class="w-full bg-transparent border-b-2 border-transparent focus:border-teal-500 outline-none transition px-2 py-3 text-lg font-medium text-gray-700 placeholder-gray-300" placeholder="輸入名稱">
                                        </td>
                                        <td>
                                            <input type="number" inputmode="decimal" v-model.number="prod.quantity" class="touch-input w-full border border-gray-300 rounded-lg text-right focus:border-teal-500 focus:ring-2 focus:ring-teal-200 outline-none font-mono font-bold text-blue-600 shadow-sm" placeholder="0">
                                        </td>
                                        <td class="text-center text-gray-500 font-mono text-sm">
                                            {{ prod.quantity > 0 ? Math.ceil(prod.quantity / global.batchSize) : 0 }}次
                                        </td>
                                        <td>
                                            <input type="number" inputmode="decimal" v-model.number="prod.cycleTime" class="touch-input w-full border border-gray-300 rounded-lg text-right focus:border-teal-500 focus:ring-2 focus:ring-teal-200 outline-none font-mono font-bold text-gray-700 shadow-sm" placeholder="0">
                                        </td>
                                        <td class="text-center">
                                            <button @click="removeProduct(index)" class="p-3 text-gray-300 hover:text-red-500 transition rounded-full hover:bg-red-50 active:bg-red-100">
                                                <i class="fa-solid fa-trash-can text-xl"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr v-if="products.length === 0">
                                        <td colspan="6" class="text-center py-12 text-gray-400 italic">
                                            <div class="flex flex-col items-center gap-2">
                                                <i class="fa-regular fa-folder-open text-4xl mb-2 opacity-50"></i>
                                                <span>清單是空的</span>
                                                <span class="text-sm opacity-75">點擊右上方「新增產品」按鈕開始</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="p-4 bg-gray-50 text-right text-sm text-gray-600 border-t flex justify-between items-center font-medium">
                             <span><i class="fa-solid fa-box mr-1"></i>批量設定: {{ global.batchSize }} pcs</span>
                             <span>共 {{ products.length }} 項 | 預估換模: <strong class="text-orange-600 text-lg mx-1">{{ results.totalMoldChanges }}</strong> 次</span>
                        </div>
                    </div>

                </div>

                <!-- Right Panel: Analysis Dashboard -->
                <div class="lg:col-span-7 flex flex-col gap-6">
                    
                    <!-- Main KPI: Loading Rate -->
                    <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg border border-gray-200 p-6 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-6 opacity-5 pointer-events-none">
                            <i class="fa-solid fa-chart-pie text-9xl text-black"></i>
                        </div>

                        <h3 class="text-gray-500 font-bold mb-2 uppercase tracking-widest text-sm">機台總負荷率 (Total Loading)</h3>
                        <div class="flex items-baseline gap-4 mb-6">
                            <span class="text-6xl md:text-7xl font-extrabold tracking-tight drop-shadow-sm" :class="loadingColor">{{ results.loadingPercentage }}<span class="text-3xl text-gray-400">%</span></span>
                            
                            <div class="flex flex-col">
                                <span class="px-3 py-1.5 rounded-lg font-bold text-sm shadow-sm inline-flex items-center gap-2 transition-colors" 
                                    :class="results.isOverloaded ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'">
                                    <i class="fa-solid" :class="results.isOverloaded ? 'fa-triangle-exclamation' : 'fa-check-circle'"></i>
                                    {{ results.isOverloaded ? '產能不足' : '產能充足' }}
                                </span>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-200 rounded-full h-6 mb-2 overflow-hidden shadow-inner">
                            <div class="h-full rounded-full transition-all duration-700 ease-out shadow-sm relative overflow-hidden" 
                                 :class="loadingBarColor" 
                                 :style="{ width: Math.min(results.loadingPercentage, 100) + '%' }">
                                 <div class="absolute inset-0 bg-white opacity-20" style="background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent); background-size: 1rem 1rem;"></div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between text-xs font-bold text-gray-400 mt-2 px-1">
                            <span>0% (閒置)</span>
                            <span>85% (理想上限)</span>
                            <span>100% (極限)</span>
                        </div>
                    </div>

                    <!-- Detailed Time Analysis Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-blue-500 hover:shadow-md transition">
                            <p class="text-xs text-gray-500 font-bold mb-1 uppercase">總可用工時</p>
                            <p class="text-3xl font-bold text-gray-800">{{ formatNumber(results.availableHours) }} <span class="text-sm font-normal text-gray-400">Hrs</span></p>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-teal-500 hover:shadow-md transition">
                            <p class="text-xs text-gray-500 font-bold mb-1 uppercase">生產運轉需</p>
                            <p class="text-3xl font-bold text-gray-800">{{ formatNumber(results.productionHours) }} <span class="text-sm font-normal text-gray-400">Hrs</span></p>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-orange-500 hover:shadow-md transition relative group">
                            <p class="text-xs text-gray-500 font-bold mb-1 uppercase">換模總損耗</p>
                            <p class="text-3xl font-bold text-gray-800">{{ formatNumber(results.setupHours) }} <span class="text-sm font-normal text-gray-400">Hrs</span></p>
                             <div class="absolute top-2 right-2 text-xs font-bold bg-orange-100 text-orange-600 px-2 py-1 rounded">
                                {{ results.totalMoldChanges }} 次
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 hover:shadow-md transition" :class="results.remainingHours >= 0 ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'">
                            <p class="text-xs font-bold mb-1 uppercase" :class="results.remainingHours >= 0 ? 'text-green-600' : 'text-red-600'">剩餘 / 透支</p>
                            <p class="text-3xl font-bold" :class="results.remainingHours >= 0 ? 'text-green-700' : 'text-red-700'">
                                {{ results.remainingHours >= 0 ? '+' : '' }}{{ formatNumber(results.remainingHours) }}
                            </p>
                        </div>
                    </div>

                    <!-- Strategy Advice Panel -->
                    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 flex-grow">
                        <h3 class="font-bold text-slate-800 mb-5 flex items-center text-lg border-b pb-3">
                            <i class="fa-solid fa-user-tie text-slate-600 mr-3 text-xl"></i> 顧問分析與建議
                        </h3>
                        
                        <div v-if="results.loadingPercentage > 100" class="space-y-4 animate-pulse-slow">
                            <div class="p-4 bg-red-50 border-l-4 border-red-500 text-red-900 rounded-r-lg shadow-sm">
                                <div class="flex items-start gap-3">
                                    <i class="fa-solid fa-circle-exclamation text-xl mt-1"></i>
                                    <div>
                                        <strong class="text-lg block mb-1">產能嚴重爆表 (Overload)</strong>
                                        目前的訂單需求已超過機台極限，即使加班也無法完成。
                                    </div>
                                </div>
                            </div>
                            <ul class="list-disc pl-6 text-base text-slate-700 space-y-2 marker:text-red-500">
                                <li><strong>換模影響：</strong> 由於每 <span class="font-mono bg-gray-100 px-1 rounded font-bold">{{ global.batchSize }}</span> PCS 就換一次模，本月共需換模 <strong>{{ results.totalMoldChanges }}</strong> 次，消耗了 {{ results.setupHours }} 小時。</li>
                                <li><strong>改善對策 1：</strong> 請嘗試將「生產批量」調高至 800 或 1000 PCS，觀察換模損耗是否降低。</li>
                                <li><strong>改善對策 2：</strong> 若無法增加批量（因庫存空間不足），則必須開啟假日加班或考慮外包。</li>
                            </ul>
                        </div>

                        <div v-else-if="results.loadingPercentage > 85" class="space-y-4">
                            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-900 rounded-r-lg shadow-sm">
                                <div class="flex items-start gap-3">
                                    <i class="fa-solid fa-triangle-exclamation text-xl mt-1"></i>
                                    <div>
                                        <strong class="text-lg block mb-1">高風險警戒區 (High Risk)</strong>
                                        機台幾乎滿載 ({{ results.loadingPercentage }}%)。任何異常都會導致交期延遲。
                                    </div>
                                </div>
                            </div>
                            <ul class="list-disc pl-6 text-base text-slate-700 space-y-2 marker:text-yellow-500">
                                <li><strong>換模頻率：</strong> 本月預計換模 <strong>{{ results.totalMoldChanges }}</strong> 次。頻繁換模是產能殺手。</li>
                                <li><strong>SMED 建議：</strong> 若能將單次換模時間從 {{ global.moldChangeMins }} 分鐘縮短至 {{ (global.moldChangeMins * 0.75).toFixed(0) }} 分鐘，即可釋放更多緩衝。</li>
                            </ul>
                        </div>

                        <div v-else class="space-y-4">
                            <div class="p-4 bg-green-50 border-l-4 border-green-500 text-green-900 rounded-r-lg shadow-sm">
                                <div class="flex items-start gap-3">
                                    <i class="fa-solid fa-thumbs-up text-xl mt-1"></i>
                                    <div>
                                        <strong class="text-lg block mb-1">產能健康 (Healthy)</strong>
                                        即使考慮了頻繁換模的損耗，目前的配置仍然游刃有餘。
                                    </div>
                                </div>
                            </div>
                            <ul class="list-disc pl-6 text-base text-slate-700 space-y-2 marker:text-green-500">
                                <li><strong>狀態：</strong> 本月預計換模 {{ results.totalMoldChanges }} 次，消耗 {{ results.setupHours }} 小時，但仍有 {{ results.remainingHours }} 小時的空檔。</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>


    <!-- ================= NAVIGATION BAR ================= -->
    <nav class="fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur-md border-t border-slate-200 flex justify-around pb-safe safe-area-bottom z-50 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
        <button class="nav-btn active w-full" onclick="switchView(1)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            人力成本
        </button>
        <button class="nav-btn w-full" onclick="switchView(2)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
            資材公式
        </button>
        <button class="nav-btn w-full" onclick="switchView(3)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
            生產預估
        </button>
        <button class="nav-btn w-full" onclick="switchView(4)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
            報價分析
        </button>
        <button class="nav-btn w-full" onclick="switchView(5)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
            機台評估
        </button>
    </nav>


    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script>
        // --- Navigation Logic ---
        function switchView(viewId) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            // Show selected view
            document.getElementById('view-' + viewId).classList.add('active');
            
            // Update Nav Buttons
            document.querySelectorAll('.nav-btn').forEach((btn, index) => {
                if (index + 1 === viewId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            window.scrollTo(0, 0);
        }

        // ================= FILE 1: 人力成本計算 Logic =================
        let currentStaffType = 'migrant';

        function initLabor() {
            initInsuranceOptions();
            updateInsuranceCosts();
        }

        function initInsuranceOptions() {
            const select = document.getElementById('insuranceGrade');
            const grades = [0, 29500, 30300, 31800, 33300, 34800, 36300, 38200, 40100, 42000, 43900, 45800];
            
            grades.forEach(val => {
                const opt = document.createElement('option');
                opt.value = val;
                if (val === 0) {
                    opt.innerText = "不計算勞健保/規費 (0)";
                } else {
                    opt.innerText = `投保級距：NT$ ${val.toLocaleString()}`;
                    if(val === 29500) opt.innerText += " (2026 最低基準)";
                }
                select.appendChild(opt);
            });
            select.value = 29500;
        }

        function setStaffType(type) {
            currentStaffType = type;
            const btnMigrant = document.getElementById('btnMigrant');
            const btnLocal = document.getElementById('btnLocal');

            if (type === 'migrant') {
                btnMigrant.classList.add('tab-active');
                btnMigrant.classList.remove('text-slate-500');
                btnLocal.classList.remove('tab-active');
                btnLocal.classList.add('text-slate-500');
            } else {
                btnLocal.classList.add('tab-active');
                btnLocal.classList.remove('text-slate-500');
                btnMigrant.classList.remove('tab-active');
                btnMigrant.classList.add('text-slate-500');
            }
            updateInsuranceCosts();
        }

        function updateInsuranceCosts() {
            const grade = parseFloat(document.getElementById('insuranceGrade').value);
            const isMigrant = (currentStaffType === 'migrant');
            
            const pc = document.getElementById('pensionContainer');
            const sc = document.getElementById('stabilityContainer');
            const pl = document.getElementById('pensionLabel');
            const sl = document.getElementById('stabilityLabel');

            if (grade === 0) {
                ["feeLabor", "feeHealth", "feePension", "feeStability", "feeAccident"].forEach(id => document.getElementById(id).value = 0);
            } else {
                const laborRate = isMigrant ? 0.0805 : 0.0875;
                document.getElementById('displayLaborRate').innerText = `~${(laborRate * 100).toFixed(2)}%`;
                
                document.getElementById('feeLabor').value = Math.round(grade * laborRate);
                document.getElementById('feeHealth').value = Math.round(grade * 0.0484);
                document.getElementById('feeAccident').value = Math.round(grade * 0.0024);
                
                if (isMigrant) {
                    document.getElementById('feePension').value = 0;
                    document.getElementById('feeStability').value = 5000;
                    sc.className = "p-5 rounded-2xl bg-blue-50 border-2 border-blue-500 ring-4 ring-blue-500/5 shadow-inner";
                    sl.className = "block text-[10px] font-black text-blue-600 uppercase mb-1";
                    pc.className = "p-5 rounded-2xl bg-slate-50 border border-slate-100 opacity-50";
                    pl.className = "block text-[10px] font-black text-slate-400 uppercase mb-1";
                } else {
                    document.getElementById('feePension').value = Math.round(grade * 0.06);
                    document.getElementById('feeStability').value = 0;
                    pc.className = "p-5 rounded-2xl bg-blue-50 border-2 border-blue-500 ring-4 ring-blue-500/5 shadow-inner";
                    pl.className = "block text-[10px] font-black text-blue-600 uppercase mb-1";
                    sc.className = "p-5 rounded-2xl bg-slate-50 border border-slate-100 opacity-50";
                    sl.className = "block text-[10px] font-black text-slate-400 uppercase mb-1";
                }
            }
            calculateAll();
        }

        function calculateAll() {
            const actualSalary = parseFloat(document.getElementById('actualSalary').value) || 0;
            const bonusAmount = parseFloat(document.getElementById('bonusAmount').value) || 0;
            const feeLabor = parseFloat(document.getElementById('feeLabor').value) || 0;
            const feeHealth = parseFloat(document.getElementById('feeHealth').value) || 0;
            const feePension = parseFloat(document.getElementById('feePension').value) || 0;
            const feeStability = parseFloat(document.getElementById('feeStability').value) || 0;
            const feeAccident = parseFloat(document.getElementById('feeAccident').value) || 0;
            
            // 每月規費
            const totalMonthlyFees = feeLabor + feeHealth + feePension + feeStability + feeAccident;
            document.getElementById('displayTotalFees').innerText = '$' + totalMonthlyFees.toLocaleString();

            const otDays = parseFloat(document.getElementById('otDays').value) || 0;
            const otHours = parseFloat(document.getElementById('otHours').value) || 0;
            const holidayDays = parseFloat(document.getElementById('holidayDays').value) || 0;
            const holidayHours = parseFloat(document.getElementById('holidayHours').value) || 0;

            // 加班費核算基準 (法律基準不含年終)
            const hourlyBase = actualSalary / 240;
            document.getElementById('displayHourlyBaseText').innerText = `$ ${hourlyBase.toFixed(1)} / hr`;

            // 每月加班費 (更新公式: 1.33 / 1.66)
            let dailyOT = 0;
            if (otHours <= 2) {
                dailyOT = otHours * hourlyBase * 1.33;
            } else {
                dailyOT = (2 * hourlyBase * 1.33) + ((otHours - 2) * hourlyBase * 1.66);
            }
            const totalOTPay = dailyOT * otDays;
            
            // 假日加班費計算 (修正邏輯: 確保時數少於2小時也能正確計算)
            let dailyHolidayPay = 0;
            if (holidayHours <= 2) {
                dailyHolidayPay = holidayHours * hourlyBase * 1.33;
            } else {
                dailyHolidayPay = (2 * hourlyBase * 1.33) + (Math.min(holidayHours - 2, 6) * hourlyBase * 1.66);
                if (holidayHours > 8) {
                    dailyHolidayPay += (holidayHours - 8) * hourlyBase * 2.66; // 模擬法規8小時後加成
                }
            }
            const totalHolidayPay = dailyHolidayPay * holidayDays;

            // 每月總支出
            const monthlyTotalCost = actualSalary + totalOTPay + totalHolidayPay + totalMonthlyFees;
            document.getElementById('displayTotalCost').innerText = Math.round(monthlyTotalCost).toLocaleString();
            document.getElementById('displayTotalOT').innerText = '$' + Math.round(totalOTPay + totalHolidayPay).toLocaleString();
            
            // 年度總支出與年終
            const annualTotalCost = (monthlyTotalCost * 12) + bonusAmount;
            
            document.getElementById('displayAnnualCost').innerText = Math.round(annualTotalCost).toLocaleString();
            document.getElementById('displayYearEndAmount').innerText = '$' + Math.round(bonusAmount).toLocaleString();

            // 報價基準時薪 (含年終攤提)
            const totalHoursPerMonth = 176 + (otDays * otHours) + (holidayDays * holidayHours);
            const totalHoursPerYear = totalHoursPerMonth * 12;
            const trueHourlyRate = totalHoursPerYear > 0 ? annualTotalCost / totalHoursPerYear : 0;

            document.getElementById('displayHourlyRate').innerText = '$' + Math.round(trueHourlyRate);
            document.getElementById('displayTotalHours').innerText = totalHoursPerMonth + ' hr';

            const status = document.getElementById('statusIndicator');
            const alertBox = document.getElementById('alertBox');
            const alertTitle = document.getElementById('alertTitle');
            const alertDesc = document.getElementById('alertDesc');
            
            alertBox.classList.remove('hidden');
            const threshold = (currentStaffType === 'migrant') ? 220 : 215;

            if (trueHourlyRate <= threshold) {
                status.innerText = '成本控制：優異';
                status.className = 'mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] text-center bg-emerald-500/20 text-emerald-400 ring-1 ring-emerald-500/50 shadow-emerald-500/20 shadow-lg';
                alertTitle.innerText = '✅ 年度結構獲利';
                alertDesc.innerText = '使用 1.33/1.66 倍率核算後，小時成本符合預期。此配置能確保公司在支付完所有獎金後仍有利潤空間。';
            } else if (trueHourlyRate <= threshold + 25) {
                status.innerText = '成本控制：預警';
                status.className = 'mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] text-center bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/50 shadow-amber-500/20 shadow-lg';
                alertTitle.innerText = '⚠️ 年終侵蝕預警';
                alertDesc.innerText = '時薪成本已明顯攀升。請注意，如果產速不夠快，年底發放這筆年終時，實際上會花掉前三季所有的利潤累積。';
            } else {
                status.innerText = '成本控制：低落';
                status.className = 'text-center mt-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] bg-rose-500/20 text-rose-400 ring-1 ring-rose-500/50 shadow-rose-500/20 shadow-lg';
                alertTitle.innerText = '❌ 經營嚴重虧損';
                alertDesc.innerText = '年度小時成本（含年終）嚴重超標！目前的配置下，每產出一小時都在虧損。建議立即檢討產線配置與獎金預算。';
            }
        }

        // ================= FILE 2: 資材公式 Logic =================
        function calcMold() {
            const l = parseFloat(document.getElementById('mold_l').value) || 0;
            const w = parseFloat(document.getElementById('mold_w').value) || 0;
            const h = parseFloat(document.getElementById('mold_h').value) || 0;
            const kg = l * w * h * 0.0079;
            const tons = kg / 1000;
            
            document.getElementById('mold_res').innerText = kg.toLocaleString(undefined, { minimumFractionDigits: 3, maximumFractionDigits: 3 });
            document.getElementById('mold_tons_res').innerText = tons.toLocaleString(undefined, { minimumFractionDigits: 3, maximumFractionDigits: 5 });
        }

        function calcBag() {
            const t = parseFloat(document.getElementById('bag_t').value) || 0;
            const w = parseFloat(document.getElementById('bag_w').value) || 0;
            const l = parseFloat(document.getElementById('bag_l').value) || 0;
            const totalW = parseFloat(document.getElementById('bag_total_w').value) || 0;
            const priceKg = parseFloat(document.getElementById('bag_price_kg').value) || 0;

            // 1. 單個重量原始值 (kg)
            const singleWRaw = (t * w * l * 0.19) / 1000;
            document.getElementById('bag_single_res').innerText = singleWRaw.toFixed(5);

            // 2. 計算單個成本
            const costPerBag = singleWRaw * priceKg;
            document.getElementById('bag_cost_res').innerText = costPerBag.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 4 });

            // 3. 模擬筆記本的四捨五入計算數量
            if (singleWRaw > 0 && totalW > 0) {
                // 筆記範例：0.01197 -> 取 0.012 再相除
                const roundedSingleW = parseFloat(singleWRaw.toFixed(3)); 
                const qty = Math.floor(totalW / roundedSingleW);
                document.getElementById('bag_qty_res').innerText = qty.toLocaleString();
            } else {
                document.getElementById('bag_qty_res').innerText = "0";
            }
        }

        // ================= FILE 3: 生產預估 Logic =================
        function initProd() {
            populateSelects();
            setNow();
            quickSetEnd(8); // 初始化預設 8H 後
        }

        // 生成 00-23 小時與 00-59 分鐘的下拉選項
        function populateSelects() {
            const hSelects = [document.getElementById('startH'), document.getElementById('endH')];
            const mSelects = [document.getElementById('startM'), document.getElementById('endM')];
            
            hSelects.forEach(s => {
                s.innerHTML = '';
                for(let i=0; i<24; i++) {
                    let opt = document.createElement('option');
                    opt.value = i;
                    opt.text = i.toString().padStart(2, '0');
                    s.add(opt);
                }
            });
            
            mSelects.forEach(s => {
                s.innerHTML = '';
                for(let i=0; i<60; i+=1) { 
                    let opt = document.createElement('option');
                    opt.value = i;
                    opt.text = i.toString().padStart(2, '0');
                    s.add(opt);
                }
            });
        }

        function setNow() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            
            document.getElementById('startDate').value = `${year}-${month}-${day}`;
            document.getElementById('startH').value = now.getHours();
            document.getElementById('startM').value = now.getMinutes();
            
            // 預設結束日期也設為今天
            document.getElementById('endDate').value = `${year}-${month}-${day}`;
            document.getElementById('endH').value = now.getHours();
            document.getElementById('endM').value = now.getMinutes();
        }

        function quickSetEnd(hours) {
            const start = getSelectedDate('start');
            const end = new Date(start.getTime() + hours * 60 * 60 * 1000);
            
            const year = end.getFullYear();
            const month = (end.getMonth() + 1).toString().padStart(2, '0');
            const day = end.getDate().toString().padStart(2, '0');
            
            document.getElementById('endDate').value = `${year}-${month}-${day}`;
            document.getElementById('endH').value = end.getHours();
            document.getElementById('endM').value = end.getMinutes();
        }

        function getSelectedDate(prefix) {
            const dateStr = document.getElementById(prefix + 'Date').value;
            if(!dateStr) return new Date();
            const h = parseInt(document.getElementById(prefix + 'H').value);
            const m = parseInt(document.getElementById(prefix + 'M').value);
            const d = new Date(dateStr);
            d.setHours(h, m, 0, 0);
            return d;
        }

        function switchMode(mode) {
            document.getElementById('panelA').classList.toggle('hidden', mode !== 'A');
            document.getElementById('panelB').classList.toggle('hidden', mode !== 'B');
            
            const tabA = document.getElementById('tabA');
            const tabB = document.getElementById('tabB');

            if (mode === 'A') {
                tabA.className = "flex-1 p-4 font-extrabold border-b-4 border-blue-500 text-blue-600 bg-white transition-all";
                tabB.className = "flex-1 p-4 font-extrabold border-b-4 border-transparent transition-all";
            } else {
                tabB.className = "flex-1 p-4 font-extrabold border-b-4 border-emerald-500 text-emerald-600 bg-white transition-all";
                tabA.className = "flex-1 p-4 font-extrabold border-b-4 border-transparent transition-all";
            }
            
            document.getElementById('resultArea').classList.add('hidden');
        }

        function calculateA() {
            const start = getSelectedDate('start');
            const end = getSelectedDate('end');
            const ct = parseFloat(document.getElementById('cycleTime').value) || 60;
            const cav = parseInt(document.getElementById('cavities').value) || 1;
            const breaks = parseFloat(document.getElementById('breakMinutes').value) || 0;

            if (end <= start) {
                alert("錯誤：結束時間不能早於開始時間！");
                return;
            }

            const totalMin = (end - start) / 1000 / 60;
            const effMin = Math.max(0, totalMin - breaks);
            const qty = Math.floor((effMin * 60) / ct) * cav;

            showResults(qty, end, totalMin, effMin);
        }

        function calculateB() {
            const start = getSelectedDate('start');
            const targetQty = parseInt(document.getElementById('targetQty').value) || 0;
            const ct = parseFloat(document.getElementById('cycleTime').value) || 60;
            const cav = parseInt(document.getElementById('cavities').value) || 1;
            const breaks = parseFloat(document.getElementById('breakMinutes').value) || 0;

            const prodSec = Math.ceil(targetQty / cav) * ct;
            const prodMin = prodSec / 60;
            const totalMin = prodMin + breaks;
            const end = new Date(start.getTime() + totalMin * 60 * 1000);

            showResults(targetQty, end, totalMin, prodMin);
        }

        function showResults(qty, endTime, totalMin, effMin) {
            document.getElementById('resQty').innerText = Math.round(qty).toLocaleString();
            document.getElementById('resTime').innerText = endTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false});
            document.getElementById('resDate').innerText = (endTime.getMonth()+1) + "/" + endTime.getDate();
            document.getElementById('resTotalDur').innerText = (totalMin / 60).toFixed(2);
            document.getElementById('resEffDur').innerText = (effMin / 60).toFixed(2);

            const dayRate = (qty / 160).toFixed(1);
            document.getElementById('resNote').innerText = `💡 幕僚建議：此任務總投入 ${(totalMin/60).toFixed(1)} 小時。產量約為 753D 日產量之 ${dayRate} 倍。若總投入超過 8.5 小時，請注意人員加班費成本控管。`;
            
            document.getElementById('resultArea').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // ================= Global Init =================
        window.onload = function() {
            initLabor();
            initProd();
        };
    </script>

    <!-- ================= FILE 4: 報價單計算 (React) Logic ================= -->
    <script type="text/babel">
        const { useState, useMemo, Fragment } = React;

        const MACHINE_RATES_REF = [
            { id: 'none', tonnage: '自定義', rate: 0 },
            { id: '351', tonnage: '100T', rate: 3.00 },
            { id: '012', tonnage: '210T', rate: 5.13 },
            { id: '011', tonnage: '250T', rate: 6.00 },
            { id: '401', tonnage: '400T', rate: 7.20 },
            { id: '502a', tonnage: '450T', rate: 8.00 },
            { id: '501', tonnage: '550T', rate: 8.60 },
            { id: '601', tonnage: '600T', rate: 11.00 },
            { id: '102', tonnage: '800T', rate: 13.00 },
            { id: '121', tonnage: '1300T', rate: 18.00 },
            { id: '151', tonnage: '1500T', rate: 20.00 },
            { id: '221', tonnage: '2200T', rate: 33.00 },
            { id: '312', tonnage: '2700T', rate: 43.66 },
            { id: '321', tonnage: '3200T', rate: 51.04 },
        ];

        const generateId = () => Math.random().toString(36).substring(2, 9);

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Calculator: <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 4v4h4V6H6zm6 0v4h4V6h-4zm-6 6v4h4v-4H6zm6 0v4h4v-4h-4zm-6 6v2h10v-2H6z"/>,
                Plus: <path d="M12 5v14M5 12h14"/>,
                Trash2: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6"/>,
                TrendingUp: <path d="m22 7-8.5 8.5-5-5L2 17M16 7h6v6"/>,
                Layers: <path d="M12 2 2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>,
                Users: <Fragment><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /></Fragment>,
                Cpu: <path d="M4 4h16v16H4zM9 9h6v6H9zM15 2v2M9 2v2M20 15h2M20 9h2M15 20v2M9 20v2M2 15h2M2 9h2"/>,
                Table: <path d="M3 3h18v18H3zM3 9h18M3 15h18M9 3v18"/>,
                Info: <Fragment><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></Fragment>,
                Zap: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />,
                ArrowRight: <path d="M5 12h14M12 5l7 7-7 7" />
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const ComparisonInput = ({ originalValue, improvedValue, unit, onChangeOriginal, onChangeImproved }) => {
            const diff = originalValue && improvedValue ? ((improvedValue - originalValue) / originalValue * 100).toFixed(1) : 0;
            return (
                <div className="grid grid-cols-2 gap-2 mt-2" onClick={(e) => e.stopPropagation()}>
                    <div className="bg-slate-50 p-2 rounded-xl border border-slate-100 shadow-sm">
                        <label className="text-[9px] font-bold text-slate-400 block mb-1 uppercase tracking-tighter">原本 ({unit})</label>
                        <input 
                            type="number" 
                            inputMode="decimal"
                            className="w-full font-mono text-slate-500 bg-transparent text-sm font-semibold outline-none" 
                            value={originalValue} 
                            onChange={(e) => onChangeOriginal(e.target.value)} 
                        />
                    </div>
                    <div className={`p-2 rounded-xl border shadow-sm ${diff < 0 ? 'bg-emerald-50 border-emerald-200' : 'bg-slate-50 border-slate-100'}`}>
                        <label className={`text-[9px] font-bold block mb-1 uppercase tracking-tighter ${diff < 0 ? 'text-emerald-600' : 'text-slate-400'}`}>改善 ({unit})</label>
                        <div className="flex items-center gap-1">
                            <input 
                                type="number" 
                                inputMode="decimal"
                                className={`w-full font-mono bg-transparent text-sm font-bold outline-none ${diff < 0 ? 'text-emerald-700' : 'text-slate-700'}`} 
                                value={improvedValue} 
                                onChange={(e) => onChangeImproved(e.target.value)} 
                            />
                            {diff < 0 && <span className="text-[8px] font-black text-emerald-500 whitespace-nowrap">{diff}%</span>}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [monthlyQty, setMonthlyQty] = useState(3520);

            const [materialConfigs, setMaterialConfigs] = useState([{ id: 'm1', label: '主要材料', weight: 123, improvedWeight: 115, unitPrice: 85 }]);
            const [components, setComponents] = useState([{ id: 'b1', name: '子品番 A', price: 15, improvedPrice: 14 }]);
            const [machineConfigs, setMachineConfigs] = useState([{ id: 'c1', tonnage: '600T', label: '一號機台', rate: 11.00, cavities: 1, cycleTime: 65, improvedCycleTime: 60 }]);
            const [assyConfigs, setAssyConfigs] = useState([{ id: 'a1', label: '組裝流水線', peopleCount: 1, secPerPerson: 60, improvedSecPerPerson: 50, ratePerSec: 0.05 }]);

            const [selectedMatId, setSelectedMatId] = useState('m1');
            const [selectedMchId, setSelectedMchId] = useState('c1');
            const [selectedAsyId, setSelectedAsyId] = useState('a1');

            const calculateDetails = (mat, mch, asy, comps, isImproved = false) => {
                if (!mat || !mch || !asy) return null;
                const weight = parseFloat(isImproved ? mat.improvedWeight : mat.weight) || 0;
                const rawCompSum = comps.reduce((sum, c) => sum + (parseFloat(isImproved ? c.improvedPrice : c.price) || 0), 0);
                const cycleTime = parseFloat(isImproved ? mch.improvedCycleTime : mch.cycleTime) || 0;
                const assySec = parseFloat(isImproved ? asy.improvedSecPerPerson : asy.secPerPerson) || 0;
                const cavityFactor = parseFloat(mch.cavities) || 1;

                const matBase = (weight / 1000) * parseFloat(mat.unitPrice);
                const totalA = matBase * 1.03 * 1.05;
                const totalB = rawCompSum * 1.03;
                const injBase = (parseFloat(mch.rate) / cavityFactor) * (cycleTime / 60);
                const assyBase = (parseFloat(asy.peopleCount) * assySec) * parseFloat(asy.ratePerSec);
                const totalC = (injBase + assyBase) * 1.03 * 1.07;

                return { A: totalA, B: totalB, C: totalC, total: totalA + totalB + totalC };
            };

            const comparison = useMemo(() => {
                const mat = materialConfigs.find(m => m.id === selectedMatId) || materialConfigs[0];
                const mch = machineConfigs.find(m => m.id === selectedMchId) || machineConfigs[0];
                const asy = assyConfigs.find(a => a.id === selectedAsyId) || assyConfigs[0];

                const current = calculateDetails(mat, mch, asy, components, false);
                const improved = calculateDetails(mat, mch, asy, components, true);

                return {
                    current, improved,
                    savingPerUnit: (current?.total || 0) - (improved?.total || 0),
                    monthlySaving: ((current?.total || 0) - (improved?.total || 0)) * monthlyQty,
                    configNames: { mat: mat?.label, mch: `${mch?.tonnage} ${mch?.label}`, asy: asy?.label }
                };
            }, [materialConfigs, components, machineConfigs, assyConfigs, selectedMatId, selectedMchId, selectedAsyId, monthlyQty]);

            const updateField = (setter, id, field, value) => {
                setter(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };

            return (
                <div className="min-h-screen bg-[#f8fafc] p-4 lg:p-10 font-sans text-slate-900 pb-20">
                    <div className="max-w-7xl mx-auto">
                        
                        <header className="mb-10 flex flex-col md:flex-row justify-between items-center gap-6 border-b border-slate-200 pb-8 text-center md:text-left">
                            <div>
                                <div className="inline-flex items-center gap-2 mb-3 text-blue-600 font-extrabold uppercase tracking-[0.2em] text-[10px] bg-blue-50 px-3 py-1 rounded-full">
                                    <Icon name="Calculator" size={16} /> <span>Jian-Shang Improvement Analysis System</span>
                                </div>
                                <h1 className="text-4xl md:text-5xl font-black text-slate-900 tracking-tighter uppercase">瑞全企業<span className="text-blue-600">。</span>報價改善分析</h1>
                            </div>
                            <div className="bg-white p-6 rounded-[2rem] shadow-xl shadow-slate-200/50 border border-slate-100 flex items-center gap-6 min-w-[300px]">
                                <div>
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1 text-right">每月預估量</label>
                                    <div className="flex items-center gap-2">
                                        <input type="number" inputMode="decimal" className="w-24 text-4xl font-mono font-black text-blue-600 outline-none bg-transparent" value={monthlyQty} onChange={(e) => setMonthlyQty(parseFloat(e.target.value) || 0)} />
                                        <span className="text-slate-300 font-black text-sm uppercase">Pcs</span>
                                    </div>
                                </div>
                                <div className="h-10 w-[1px] bg-slate-100"></div>
                                <Icon name="TrendingUp" className="text-blue-200" size={40} />
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-16 items-start">
                            
                            {/* A. 材料優化 */}
                            <section>
                                <div className="flex justify-between items-center mb-5 px-2">
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                        <div className="w-1.5 h-4 bg-emerald-500 rounded-full"></div> A. 重量優化 (Materials)
                                    </h2>
                                    <button onClick={() => setMaterialConfigs([...materialConfigs, { id: generateId(), label: `新材料`, weight: 0, improvedWeight: 0, unitPrice: 0 }])} className="text-[10px] bg-white border border-slate-200 text-slate-600 hover:text-blue-600 px-4 py-1.5 rounded-full font-bold shadow-sm transition-all">+ Add New</button>
                                </div>
                                <div className="space-y-4">
                                    {materialConfigs.map((m) => (
                                        <div key={m.id} onClick={() => setSelectedMatId(m.id)} className={`group p-5 rounded-[2rem] border-2 transition-all cursor-pointer relative ${selectedMatId === m.id ? 'border-emerald-500 bg-white shadow-2xl shadow-emerald-100 scale-[1.02]' : 'bg-white/50 border-slate-100 hover:border-slate-300'}`}>
                                            <div className="flex justify-between items-start mb-4 pr-10">
                                                <input type="text" className="bg-transparent font-extrabold text-sm outline-none text-slate-800 border-b-2 border-transparent focus:border-emerald-300 w-full" onClick={(e)=>e.stopPropagation()} value={m.label} onChange={(e) => updateField(setMaterialConfigs, m.id, 'label', e.target.value)} />
                                                <div className="flex items-center gap-1 bg-slate-100 px-2 py-0.5 rounded-lg ml-2 shrink-0" onClick={(e)=>e.stopPropagation()}>
                                                    <span className="text-[9px] font-bold text-slate-400">NT$</span>
                                                    <input type="number" inputMode="decimal" className="w-10 bg-transparent text-center font-mono font-bold text-xs" value={m.unitPrice} onChange={(e) => updateField(setMaterialConfigs, m.id, 'unitPrice', e.target.value)} />
                                                    <span className="text-[9px] font-bold text-slate-400">/kg</span>
                                                </div>
                                            </div>
                                            <ComparisonInput originalValue={m.weight} improvedValue={m.improvedWeight} unit="g" onChangeOriginal={(v)=>updateField(setMaterialConfigs, m.id, 'weight', v)} onChangeImproved={(v)=>updateField(setMaterialConfigs, m.id, 'improvedWeight', v)} />
                                            <button onClick={(e) => { e.stopPropagation(); setMaterialConfigs(prev => prev.filter(x => x.id !== m.id)); }} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 transition-all p-1"><Icon name="Trash2" size={14}/></button>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            {/* B. BOM 供應商議價 */}
                            <section>
                                <div className="flex justify-between items-center mb-5 px-2">
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                        <div className="w-1.5 h-4 bg-blue-500 rounded-full"></div> B. 供應商議價 (BOM)
                                    </h2>
                                    <button onClick={() => setComponents([...components, { id: generateId(), name: '子品番', price: 0, improvedPrice: 0 }])} className="text-[10px] bg-white border border-slate-200 text-slate-600 px-4 py-1.5 rounded-full font-bold shadow-sm">+ Add</button>
                                </div>
                                <div className="bg-white rounded-[2rem] p-6 border border-slate-100 shadow-xl shadow-slate-200/30">
                                    <div className="space-y-4 mb-4">
                                        {components.map((c) => (
                                            <div key={c.id} className="group p-4 bg-slate-50 rounded-[1.5rem] border border-slate-100 relative pr-12">
                                                <input type="text" className="bg-transparent font-bold text-xs mb-2 block outline-none text-slate-600 w-full" value={c.name} onChange={(e) => updateField(setComponents, c.id, 'name', e.target.value)} />
                                                <div className="flex items-center gap-2 overflow-hidden">
                                                    <input type="number" inputMode="decimal" className="w-1/2 p-1.5 bg-white border border-slate-100 rounded-lg font-mono text-xs text-slate-400 min-w-0" value={c.price} onChange={(e) => updateField(setComponents, c.id, 'price', e.target.value)} title="原本" />
                                                    <Icon name="ArrowRight" size={12} className="text-slate-300 shrink-0" />
                                                    <input type="number" inputMode="decimal" className="w-1/2 p-1.5 bg-emerald-50 border border-emerald-100 rounded-lg font-mono text-xs font-bold text-emerald-700 min-w-0" value={c.improvedPrice} onChange={(e) => updateField(setComponents, c.id, 'improvedPrice', e.target.value)} title="改善" />
                                                </div>
                                                <button onClick={() => setComponents(prev => prev.filter(x => x.id !== c.id))} className="absolute top-1/2 -translate-y-1/2 right-3 text-slate-300 hover:text-red-500 p-2"><Icon name="Trash2" size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="pt-4 border-t border-slate-100 flex justify-between items-center text-[10px] font-black text-slate-400 uppercase">
                                        <span>總計 (Total)</span>
                                        <div className="text-right">
                                            <div className="text-[9px] font-mono">Ori: {components.reduce((s,c)=>s+(parseFloat(c.price)||0),0).toFixed(1)}</div>
                                            <div className="text-sm text-emerald-600">Imp: {components.reduce((s,c)=>s+(parseFloat(c.improvedPrice)||0),0).toFixed(1)}元</div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            {/* C. 加工優化 */}
                            <section>
                                <div className="flex justify-between items-center mb-5 px-2">
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                        <div className="w-1.5 h-4 bg-orange-500 rounded-full"></div> C. 加工與工時 (Process)
                                    </h2>
                                    <button onClick={() => setMachineConfigs([...machineConfigs, { id: generateId(), tonnage: '自定義', label: `機台`, rate: 0, cavities: 1, cycleTime: 0, improvedCycleTime: 0 }])} className="text-[10px] bg-white border border-slate-200 text-slate-600 px-4 py-1.5 rounded-full font-bold shadow-sm">+ Machine</button>
                                </div>
                                <div className="space-y-6">
                                    {machineConfigs.map((m) => (
                                        <div key={m.id} onClick={()=>setSelectedMchId(m.id)} className={`group p-5 rounded-[2rem] border-2 transition-all cursor-pointer relative overflow-hidden ${selectedMchId === m.id ? 'border-orange-500 bg-white shadow-2xl shadow-orange-100 scale-[1.02]' : 'bg-white/50 border-slate-100 hover:border-slate-300'}`}>
                                            <div className="flex flex-wrap items-center gap-2 mb-4 pr-10" onClick={(e)=>e.stopPropagation()}>
                                                <select className="font-black text-orange-600 bg-orange-50 border-none rounded-lg px-2 py-1 outline-none text-[10px] h-7 shrink-0" value={m.tonnage} onChange={(e) => { const ref = MACHINE_RATES_REF.find(r => r.tonnage === e.target.value); updateField(setMachineConfigs, m.id, 'tonnage', ref.tonnage); updateField(setMachineConfigs, m.id, 'rate', ref.rate); }}>
                                                    {MACHINE_RATES_REF.map(ref => <option key={ref.id} value={ref.tonnage}>{ref.tonnage}</option>)}
                                                </select>
                                                <input type="text" className="bg-transparent font-extrabold text-sm outline-none text-slate-700 flex-1 min-w-[60px]" value={m.label} onChange={(e) => updateField(setMachineConfigs, m.id, 'label', e.target.value)}/>
                                                <div className="flex items-center gap-1 bg-slate-100 px-2 py-0.5 rounded-lg shrink-0">
                                                    <span className="text-[8px] font-bold text-slate-400">NT$</span>
                                                    <input type="number" inputMode="decimal" className="w-8 bg-transparent text-center font-mono font-bold text-[10px] text-orange-600" value={m.rate} onChange={(e) => updateField(setMachineConfigs, m.id, 'rate', e.target.value)} />
                                                    <span className="text-[8px] font-bold text-slate-400">/分</span>
                                                </div>
                                                <div className="flex items-center gap-1 bg-blue-50 px-2 py-0.5 rounded-lg shrink-0">
                                                    <span className="text-[8px] font-black text-blue-400">Cav</span>
                                                    <input type="number" inputMode="decimal" className="w-6 bg-transparent text-center font-bold text-blue-600 text-[10px]" value={m.cavities} onChange={(e)=>updateField(setMachineConfigs, m.id, 'cavities', e.target.value)} />
                                                </div>
                                            </div>
                                            <ComparisonInput originalValue={m.cycleTime} improvedValue={m.improvedCycleTime} unit="S" onChangeOriginal={(v)=>updateField(setMachineConfigs, m.id, 'cycleTime', v)} onChangeImproved={(v)=>updateField(setMachineConfigs, m.id, 'improvedCycleTime', v)} />
                                            <button onClick={(e) => { e.stopPropagation(); setMachineConfigs(prev => prev.filter(x => x.id !== m.id)); }} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 p-1"><Icon name="Trash2" size={14}/></button>
                                        </div>
                                    ))}

                                    <div className="border-t border-slate-200 pt-6">
                                        <div className="flex justify-between items-center mb-4 px-2">
                                            <h3 className="text-[10px] font-black text-purple-600 uppercase tracking-widest flex items-center gap-2"><Icon name="Users" size={14}/> 組裝工時改善</h3>
                                            <button onClick={() => setAssyConfigs([...assyConfigs, { id: generateId(), label: `組裝線`, peopleCount: 1, secPerPerson: 0, improvedSecPerPerson: 0, ratePerSec: 0.05 }])} className="text-[9px] text-slate-400 hover:text-purple-600">+ 新增</button>
                                        </div>
                                        {assyConfigs.map((a) => (
                                            <div key={a.id} onClick={()=>setSelectedAsyId(a.id)} className={`group p-5 rounded-[2rem] border-2 transition-all cursor-pointer relative mb-4 ${selectedAsyId === a.id ? 'border-purple-500 bg-white shadow-2xl shadow-purple-100 scale-[1.02]' : 'bg-white/50 border-slate-100 hover:border-slate-300'}`}>
                                                <div className="flex flex-wrap items-center justify-between gap-3 mb-4 pr-10" onClick={(e)=>e.stopPropagation()}>
                                                    <input type="text" className="bg-transparent font-extrabold text-sm outline-none text-slate-700 flex-1" value={a.label} onChange={(e) => updateField(setAssyConfigs, a.id, 'label', e.target.value)}/>
                                                    <div className="flex gap-2 shrink-0">
                                                        <div className="flex items-center gap-1 bg-purple-50 px-2 py-0.5 rounded-lg">
                                                            <span className="text-[8px] font-black text-purple-400">P:</span>
                                                            <input type="number" inputMode="decimal" className="w-5 bg-transparent text-center font-bold text-purple-700 text-[10px]" value={a.peopleCount} onChange={(e)=>updateField(setAssyConfigs, a.id, 'peopleCount', e.target.value)}/>
                                                        </div>
                                                        <div className="flex items-center gap-1 bg-slate-100 px-2 py-0.5 rounded-lg">
                                                            <span className="text-[8px] font-bold text-slate-400">NT$</span>
                                                            <input type="number" step="0.01" inputMode="decimal" className="w-8 bg-transparent text-center font-mono font-bold text-[10px] text-blue-600" value={a.ratePerSec} onChange={(e) => updateField(setAssyConfigs, a.id, 'ratePerSec', e.target.value)} />
                                                            <span className="text-[8px] font-bold text-slate-400">/秒</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <ComparisonInput originalValue={a.secPerPerson} improvedValue={a.improvedSecPerPerson} unit="S" onChangeOriginal={(v)=>updateField(setAssyConfigs, a.id, 'secPerPerson', v)} onChangeImproved={(v)=>updateField(setAssyConfigs, a.id, 'improvedSecPerPerson', v)} />
                                                <button onClick={(e) => { e.stopPropagation(); setAssyConfigs(prev => prev.filter(x => x.id !== a.id)); }} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 p-1"><Icon name="Trash2" size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </section>
                        </div>

                        {/* 報價與效益分析成果 */}
                        {comparison.current && (
                            <div className="bg-slate-900 rounded-[3rem] shadow-[0_40px_100px_-20px_rgba(15,23,42,0.5)] overflow-hidden border border-slate-800">
                                <div className="p-10 bg-gradient-to-br from-slate-800 to-slate-900 border-b border-slate-800 flex flex-col md:flex-row justify-between items-center gap-8 text-center md:text-left">
                                    <div className="flex flex-col md:flex-row items-center gap-6">
                                        <div className="bg-blue-500/10 p-5 rounded-[2rem] border border-blue-500/20">
                                            <Icon name="Zap" size={40} className="text-blue-400 drop-shadow-[0_0_10px_rgba(96,165,250,0.5)]" />
                                        </div>
                                        <div>
                                            <h2 className="text-3xl font-black text-white tracking-tighter uppercase mb-2">改善報價核算分析</h2>
                                            <div className="flex flex-wrap justify-center md:justify-start gap-2">
                                                <div className="text-[9px] font-black text-slate-400 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700 uppercase">{comparison.configNames.mat}</div>
                                                <div className="text-[9px] font-black text-slate-400 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700 uppercase">{comparison.configNames.mch}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="text-center md:text-right">
                                        <div className="text-[10px] font-black text-green-400 uppercase tracking-widest mb-1 leading-none">Monthly Saving Potential</div>
                                        <div className="text-5xl md:text-6xl font-mono font-black text-green-400 tracking-tighter drop-shadow-[0_0_15px_rgba(74,222,128,0.5)]">
                                            NT$ {comparison.monthlySaving.toLocaleString(undefined, {maximumFractionDigits:0})}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="overflow-x-auto">
                                    <table className="w-full text-right border-collapse min-w-[900px]">
                                        <thead>
                                            <tr className="bg-slate-900/50 text-[10px] text-slate-500 font-black uppercase border-b border-slate-800 tracking-widest">
                                                <th className="p-8 text-left">成本結構 (Jian-Shang Formula)</th>
                                                <th className="p-8">基準報價 (Original)</th>
                                                <th className="p-8 text-green-400 bg-green-500/5 italic underline decoration-green-500/30 underline-offset-8 font-bold">改善成果 (Improved)</th>
                                                <th className="p-8 text-blue-400">單件節省 (Saving)</th>
                                            </tr>
                                        </thead>
                                        <tbody className="text-sm divide-y divide-slate-800 font-mono">
                                            <tr className="hover:bg-slate-800/20">
                                                <td className="p-8 text-left">
                                                    <div className="font-extrabold text-slate-400">A. 材料費成本</div>
                                                    <div className="text-[10px] text-slate-600 mt-1 italic">[(W/1000*P) * 1.03 * 1.05]</div>
                                                </td>
                                                <td className="p-8 text-slate-500 font-bold">NT$ {comparison.current.A.toFixed(2)}</td>
                                                <td className="p-8 text-green-300 font-black bg-green-500/5 italic">NT$ {comparison.improved.A.toFixed(2)}</td>
                                                <td className="p-8 text-blue-400 font-bold">{(comparison.current.A - comparison.improved.A).toFixed(2)}</td>
                                            </tr>
                                            <tr className="hover:bg-slate-800/20">
                                                <td className="p-8 text-left">
                                                    <div className="font-extrabold text-slate-400">B. 子部品成本</div>
                                                    <div className="text-[10px] text-slate-600 mt-1 italic">[BOM * 1.03]</div>
                                                </td>
                                                <td className="p-8 text-slate-500 font-bold">NT$ {comparison.current.B.toFixed(2)}</td>
                                                <td className="p-8 text-green-300 font-black bg-green-500/5 italic">NT$ {comparison.improved.B.toFixed(2)}</td>
                                                <td className="p-8 text-blue-400 font-bold">{(comparison.current.B - comparison.improved.B).toFixed(2)}</td>
                                            </tr>
                                            <tr className="hover:bg-slate-800/20">
                                                <td className="p-8 text-left">
                                                    <div className="font-extrabold text-slate-400">C. 加工組裝費</div>
                                                    <div className="text-[10px] text-slate-600 mt-1 italic">[(射+組) * 1.03 * 1.07]</div>
                                                </td>
                                                <td className="p-8 text-slate-500 font-bold">NT$ {comparison.current.C.toFixed(2)}</td>
                                                <td className="p-8 text-green-300 font-black bg-green-500/5 italic">NT$ {comparison.improved.C.toFixed(2)}</td>
                                                <td className="p-8 text-blue-400 font-bold">{(comparison.current.C - comparison.improved.C).toFixed(2)}</td>
                                            </tr>
                                            <tr className="bg-blue-500/5">
                                                <td className="p-10 text-left border-t-2 border-slate-700">
                                                    <div className="font-black text-white text-2xl tracking-tighter uppercase leading-none">報價比較 (Unit Price)</div>
                                                </td>
                                                <td className="p-10 text-slate-400 font-black text-xl border-t-2 border-slate-700">NT$ {comparison.current.total.toFixed(2)}</td>
                                                <td className="p-10 text-green-400 font-black text-4xl md:text-5xl italic bg-green-400/10 border-t-2 border-slate-700">NT$ {comparison.improved.total.toFixed(2)}</td>
                                                <td className="p-10 text-blue-400 font-black text-3xl md:text-4xl underline decoration-4 border-t-2 border-slate-700">-{comparison.savingPerUnit.toFixed(2)}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* 公式說明區塊 */}
                        <div className="mt-12 p-8 bg-white rounded-[2.5rem] border border-slate-100 text-[11px] text-slate-400 grid grid-cols-1 md:grid-cols-2 gap-12 shadow-sm text-left">
                             <div>
                                <h4 className="font-black text-slate-800 mb-4 flex items-center gap-2 uppercase tracking-widest"><Icon name="Info" size={16} className="text-blue-500"/> 核算邏輯說明</h4>
                                <ul className="space-y-2 list-none leading-relaxed">
                                    <li className="flex gap-2"><strong>材料：</strong> <span>[(重量/1000 × 單價) × 1.03] × 1.05</span></li>
                                    <li className="flex gap-2"><strong>部品：</strong> <span>(BOM單價總和) × 1.03 (不計利潤)</span></li>
                                    <li className="flex gap-2"><strong>加工：</strong> <span>[(射出單價 + 組裝單價) × 1.03] × 1.07</span></li>
                                </ul>
                             </div>
                             <div className="bg-slate-50 p-6 rounded-[2rem] border border-slate-100 flex items-center italic text-slate-500 leading-loose">
                                 <p className="text-[10px]">
                                     手機端優化：已修正輸入數字時鍵盤跳出的問題。請使用數字小鍵盤快速輸入參數。<br/>
                                     提示：透過減輕重量、縮短成型秒數或優化組裝效率，可立即於下方看見利潤貢獻。
                                 </p>
                             </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('react-root'));
        root.render(<App />);
    </script>

    <!-- ================= FILE 5: 機台產能評估 (Vue) Logic ================= -->
    <script>
        const { createApp, reactive, computed } = Vue;

        createApp({
            setup() {
                // Global Machine/Factory Settings
                const global = reactive({
                    shifts: 1,           // Default to 1 shift (USER REQUEST)
                    workingDays: 22,
                    hoursPerShift: 8,    // Fixed standard
                    overtime: 0,         // Overtime per shift
                    extraWorkDays: 0,    // Extra work days
                    moldChangeMins: 40,  // User specified default
                    batchSize: 400,      // New: Batch size constraint
                    defectRate: 3.0      // Global defect rate
                });

                // Product List - DEFAULT 3 EMPTY SLOTS (USER REQUEST)
                const products = reactive([
                    { name: '', quantity: null, cycleTime: null },
                    { name: '', quantity: null, cycleTime: null },
                    { name: '', quantity: null, cycleTime: null }
                ]);

                // Methods
                const addProduct = () => {
                    products.push({ name: '', quantity: null, cycleTime: null });
                };

                const removeProduct = (index) => {
                    products.splice(index, 1);
                };

                // Computed Logic
                const results = computed(() => {
                    // 1. Available Time (Hours)
                    const totalDays = global.workingDays + global.extraWorkDays;
                    const dailyHours = global.shifts * (global.hoursPerShift + global.overtime);
                    const availableHours = totalDays * dailyHours;

                    // 2. Production Time & Setup Logic
                    let totalRunSeconds = 0;
                    let totalMoldChanges = 0;

                    products.forEach(p => {
                        if (p.quantity > 0) {
                            // Run Time
                            if (p.cycleTime > 0) {
                                const requiredInputQty = p.quantity / (1 - (global.defectRate / 100));
                                totalRunSeconds += requiredInputQty * p.cycleTime;
                            }
                            
                            // Setup Time Logic (Based on Batch Size)
                            // If quantity is 3520 and batch is 400:
                            // runs = ceil(3520 / 400) = 9 runs
                            const runs = Math.ceil(p.quantity / global.batchSize);
                            totalMoldChanges += runs;
                        }
                    });

                    const productionHours = totalRunSeconds / 3600;
                    
                    // Total Setup Hours = Total Changes * Mins per change
                    const setupMinutes = totalMoldChanges * global.moldChangeMins;
                    const setupHours = setupMinutes / 60;

                    // 4. Total Required
                    const totalRequiredHours = productionHours + setupHours;

                    // 5. Loading %
                    const loadingPercentage = availableHours > 0 
                        ? (totalRequiredHours / availableHours) * 100 
                        : 0;

                    return {
                        availableHours: parseFloat(availableHours.toFixed(1)),
                        productionHours: parseFloat(productionHours.toFixed(1)),
                        setupHours: parseFloat(setupHours.toFixed(1)),
                        totalRequiredHours: parseFloat(totalRequiredHours.toFixed(1)),
                        loadingPercentage: parseFloat(loadingPercentage.toFixed(1)),
                        remainingHours: parseFloat((availableHours - totalRequiredHours).toFixed(1)),
                        isOverloaded: totalRequiredHours > availableHours,
                        totalMoldChanges // Expose for UI
                    };
                });

                // Helper for advice
                const longestCycleProduct = computed(() => {
                    if (products.length === 0) return null;
                    return [...products].sort((a,b) => b.cycleTime - a.cycleTime)[0];
                });

                // UI Classes
                const loadingColor = computed(() => {
                    if (results.value.loadingPercentage > 100) return 'text-red-600';
                    if (results.value.loadingPercentage > 85) return 'text-orange-500';
                    return 'text-teal-600';
                });

                const loadingBarColor = computed(() => {
                    if (results.value.loadingPercentage > 100) return 'bg-red-500';
                    if (results.value.loadingPercentage > 85) return 'bg-orange-400';
                    return 'bg-teal-500';
                });

                const scenarioText = computed(() => {
                    const totalD = global.workingDays + global.extraWorkDays;
                    const dailyH = (global.hoursPerShift + global.overtime) * global.shifts;
                    return `${global.shifts}班制 / 日做 ${dailyH}H / 月做 ${totalD}天`;
                });

                const formatNumber = (num) => new Intl.NumberFormat('en-US').format(num);

                return {
                    global,
                    products,
                    addProduct,
                    removeProduct,
                    results,
                    loadingColor,
                    loadingBarColor,
                    scenarioText,
                    longestCycleProduct,
                    formatNumber
                };
            }
        }).mount('#app');
    </script>
</body>
</html>